# EPUB é–±è®€å™¨æ€§èƒ½æ¸¬è©¦å ±å‘Š

## ğŸ“‹ æ¸¬è©¦æ¦‚è¿°

**æ¸¬è©¦æ—¥æœŸ**: 2025-11-09  
**æ¸¬è©¦ç‰ˆæœ¬**: v1.0.0  
**æ¸¬è©¦å·¥å…·**: Flutter Integration Test + DevTools  
**æ¸¬è©¦æ–‡ä»¶**: `integration_test/reader_performance_test.dart`

---

## ğŸ¯ æ¸¬è©¦ç›®æ¨™

æ ¹æ“š Task 4.22.1 çš„é©—æ”¶æ¨™æº–ï¼š

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | èªªæ˜ |
|------|--------|------|
| å•Ÿå‹•æ™‚é–“ | < 2s | å¾é»æ“Šã€Œé–‹å§‹é–±è®€ã€åˆ°é–±è®€å™¨å®Œå…¨åŠ è¼‰ |
| ç¿»é æµæš¢åº¦ | 60fps | ç›®æ¨™å¹€ç‡ (å¯¦éš›ç´„ 16.67ms/frame) |
| å…§å­˜ä½¿ç”¨ | < 150MB | é–±è®€æœŸé–“å…§å­˜å³°å€¼ |
| å…§å­˜æ´©æ¼ | ç„¡ | é•·æ™‚é–“é‹è¡Œç„¡ç•°å¸¸å¢é•· |

---

## ğŸ§ª æ¸¬è©¦ç”¨ä¾‹

### Test 1: Reader Launch Timeï¼ˆé–±è®€å™¨å•Ÿå‹•æ™‚é–“ï¼‰

**æ¸¬è©¦å…§å®¹**:
- æ¸¬é‡å¾é»æ“Šã€Œé–‹å§‹é–±è®€ã€åˆ°é–±è®€å™¨å®Œå…¨åŠ è¼‰çš„æ™‚é–“
- ä½¿ç”¨ `binding.watchPerformance()` è¨˜éŒ„æ€§èƒ½æ•¸æ“š

**é©—æ”¶æ¨™æº–**: < 2000ms

**æ¸¬è©¦æ­¥é©Ÿ**:
1. å¾æ›¸ç±åˆ—è¡¨å°èˆªåˆ°è©³æƒ…é 
2. é»æ“Šã€Œé–‹å§‹é–±è®€ã€æŒ‰éˆ•
3. è¨˜éŒ„å•Ÿå‹•æ™‚é–“
4. é©—è­‰é–±è®€å™¨æ­£å¸¸é¡¯ç¤º

---

### Test 2: Page Turning Smoothnessï¼ˆç¿»é æµæš¢åº¦ï¼‰

**æ¸¬è©¦å…§å®¹**:
- åŸ·è¡Œ 10 æ¬¡ç¿»é æ“ä½œ
- æ¸¬é‡æ¯æ¬¡ç¿»é çš„éŸ¿æ‡‰æ™‚é–“
- è¨ˆç®—å¹³å‡ç¿»é æ™‚é–“å’Œæœ€å¤§ç¿»é æ™‚é–“

**é©—æ”¶æ¨™æº–**: 
- å¹³å‡ç¿»é æ™‚é–“ < 100msï¼ˆå¯æ¥å—ç¯„åœï¼‰
- æœ€å„ª < 50msï¼ˆéå¸¸æµæš¢ï¼‰
- ç†æƒ³ç›®æ¨™ < 16.67ms (60fps)

**æ¸¬è©¦æ­¥é©Ÿ**:
1. æ‰“é–‹é–±è®€å™¨
2. é»æ“Šè¢å¹•å³å´é€²è¡Œç¿»é ï¼ˆ10æ¬¡ï¼‰
3. è¨˜éŒ„æ¯æ¬¡ç¿»é æ™‚é–“
4. è¨ˆç®—çµ±è¨ˆæ•¸æ“š

**è¨»è§£**: EPUB æ¸²æŸ“çš„è¤‡é›œæ€§æ„å‘³è‘—å¯èƒ½ç„¡æ³•é”åˆ°å®Œç¾çš„ 60fpsï¼Œä½†æ‡‰è©²ä¿æŒæµæš¢çš„ç”¨æˆ¶é«”é©—ã€‚

---

### Test 3: Memory Usage During Readingï¼ˆé–±è®€æœŸé–“å…§å­˜ä½¿ç”¨ï¼‰

**æ¸¬è©¦å…§å®¹**:
- ç›£æ§æ•´å€‹é–±è®€éç¨‹çš„å…§å­˜ä½¿ç”¨
- æ¨¡æ“¬çœŸå¯¦é–±è®€å ´æ™¯ï¼ˆ20æ¬¡ç¿»é  + 5æ¬¡å·¥å…·æ¬„åˆ‡æ›ï¼‰
- ä½¿ç”¨ `binding.watchPerformance()` è¨˜éŒ„å…§å­˜æ•¸æ“š

**é©—æ”¶æ¨™æº–**: < 150MB

**æ¸¬è©¦æ­¥é©Ÿ**:
1. æ‰“é–‹é–±è®€å™¨
2. åŸ·è¡Œ 20 æ¬¡ç¿»é æ“ä½œ
3. åŸ·è¡Œ 5 æ¬¡å·¥å…·æ¬„åˆ‡æ›
4. è¨˜éŒ„å…§å­˜ä½¿ç”¨æ•¸æ“š

**åˆ†ææ–¹æ³•**: 
- ä½¿ç”¨ Flutter DevTools çš„ Memory æ¨™ç±¤æŸ¥çœ‹è©³ç´°å…§å­˜ä½¿ç”¨
- æª¢æŸ¥æ˜¯å¦æœ‰å…§å­˜æ´©æ¼ï¼ˆGC å¾Œå…§å­˜æ‡‰è©²æ¢å¾©ï¼‰

---

### Test 4: Settings Panel Animationï¼ˆè¨­ç½®é¢æ¿å‹•ç•«æ€§èƒ½ï¼‰

**æ¸¬è©¦å…§å®¹**:
- æ¸¬è©¦è¨­ç½®é¢æ¿é–‹é—œå‹•ç•«çš„æµæš¢åº¦
- åŸ·è¡Œ 5 æ¬¡æ‰“é–‹/é—œé–‰æ“ä½œ
- æ¸¬é‡å¹³å‡å‹•ç•«æ™‚é–“

**é©—æ”¶æ¨™æº–**: < 300msï¼ˆæµæš¢å‹•ç•«ï¼‰

**æ¸¬è©¦æ­¥é©Ÿ**:
1. æ‰“é–‹é–±è®€å™¨
2. é»æ“Šè¨­ç½®æŒ‰éˆ•ï¼ˆ5æ¬¡ï¼‰
3. è¨˜éŒ„æ¯æ¬¡æ‰“é–‹æ™‚é–“
4. é»æ“Šå¤–éƒ¨é—œé–‰ï¼ˆ5æ¬¡ï¼‰
5. è¨˜éŒ„æ¯æ¬¡é—œé–‰æ™‚é–“
6. è¨ˆç®—å¹³å‡å€¼

---

### Test 5: Long Reading Session Stabilityï¼ˆé•·æ™‚é–“é–±è®€ç©©å®šæ€§ï¼‰

**æ¸¬è©¦å…§å®¹**:
- æ¨¡æ“¬é•·æ™‚é–“é–±è®€å ´æ™¯ï¼ˆ50æ¬¡æ··åˆæ“ä½œï¼‰
- åŒ…æ‹¬ç¿»é ã€å·¥å…·æ¬„åˆ‡æ›ç­‰å¤šç¨®æ“ä½œ
- é©—è­‰é–±è®€å™¨ç©©å®šæ€§å’Œå…§å­˜æ´©æ¼

**é©—æ”¶æ¨™æº–**: ç„¡å´©æ½°ã€ç„¡æ˜é¡¯å¡é “ã€ç„¡å…§å­˜æ´©æ¼

**æ¸¬è©¦æ­¥é©Ÿ**:
1. æ‰“é–‹é–±è®€å™¨
2. åŸ·è¡Œ 50 æ¬¡æ··åˆæ“ä½œï¼š
   - ç¿»é ï¼ˆæ¯ 3 æ¬¡æ“ä½œï¼‰
   - å·¥å…·æ¬„åˆ‡æ›ï¼ˆæ¯ 5 æ¬¡æ“ä½œï¼‰
   - å…¶ä»–é»æ“Šæ“ä½œ
3. é©—è­‰é–±è®€å™¨ä»ç„¶æ­£å¸¸é‹è¡Œ

---

### Test 6: Complete Reader Flow Benchmarkï¼ˆå®Œæ•´é–±è®€æµç¨‹åŸºæº–æ¸¬è©¦ï¼‰

**æ¸¬è©¦å…§å®¹**:
- æ¸¬é‡å®Œæ•´é–±è®€æµç¨‹çš„ç¸½è€—æ™‚
- åŒ…æ‹¬ï¼šæ‡‰ç”¨å•Ÿå‹• â†’ åˆ—è¡¨ â†’ è©³æƒ… â†’ é–±è®€å™¨ â†’ é–±è®€ â†’ è¿”å›

**æ¸¬è©¦æ­¥é©Ÿ**:
1. æ‡‰ç”¨å•Ÿå‹•
2. å°èˆªåˆ°æ›¸ç±è©³æƒ…
3. æ‰“é–‹é–±è®€å™¨
4. åŸ·è¡Œ 10 æ¬¡ç¿»é 
5. è¿”å›æ›¸ç±åˆ—è¡¨
6. è¨˜éŒ„ç¸½è€—æ™‚

**ç”¨é€”**: æä¾›æ€§èƒ½åŸºæº–æ•¸æ“šï¼Œç”¨æ–¼å¾ŒçºŒç‰ˆæœ¬å°æ¯”

---

## ğŸš€ å¦‚ä½•é‹è¡Œæ¸¬è©¦

### å‰ç½®æ¢ä»¶
- é€£æ¥ Android/iOS å¯¦é«”è¨­å‚™æˆ–æ¨¡æ“¬å™¨
- æˆ–ä½¿ç”¨ Chrome ç€è¦½å™¨ï¼ˆWeb å¹³å°ï¼‰

### é‹è¡Œå‘½ä»¤

#### 1. é‹è¡Œæ‰€æœ‰æ€§èƒ½æ¸¬è©¦
```bash
cd app
flutter test integration_test/reader_performance_test.dart
```

#### 2. åœ¨ç‰¹å®šè¨­å‚™ä¸Šé‹è¡Œ
```bash
flutter test integration_test/reader_performance_test.dart -d <device_id>
```

#### 3. ä½¿ç”¨ Flutter Driver é‹è¡Œï¼ˆç”Ÿæˆæ€§èƒ½å ±å‘Šï¼‰
```bash
flutter drive \
  --driver=test_driver/integration_test.dart \
  --target=integration_test/reader_performance_test.dart \
  --profile
```

---

## ğŸ“Š çµæœåˆ†æ

### ä½¿ç”¨ DevTools é€²è¡Œè©³ç´°åˆ†æ

1. **å•Ÿå‹• DevTools**:
```bash
flutter pub global activate devtools
flutter pub global run devtools
```

2. **é€£æ¥åˆ°é‹è¡Œçš„æ‡‰ç”¨**:
   - é‹è¡Œæ€§èƒ½æ¸¬è©¦æ™‚ï¼Œæ‡‰ç”¨æœƒåœ¨è¨­å‚™ä¸Šå•Ÿå‹•
   - åœ¨ DevTools ä¸­é¸æ“‡å°æ‡‰çš„æ‡‰ç”¨é€²ç¨‹

3. **æŸ¥çœ‹æ€§èƒ½æ•¸æ“š**:
   - **Performance**: æŸ¥çœ‹ CPU ä½¿ç”¨ç‡ã€å¹€ç‡
   - **Memory**: æŸ¥çœ‹å…§å­˜ä½¿ç”¨ã€GC æ´»å‹•
   - **Timeline**: æŸ¥çœ‹ UI æ¸²æŸ“æ™‚é–“ç·š
   - **Network**: æŸ¥çœ‹ç¶²çµ¡è«‹æ±‚ï¼ˆå¦‚æœæœ‰ï¼‰

### æ€§èƒ½æŒ‡æ¨™è§£è®€

#### å¹€ç‡ (FPS)
- **60 fps**: ç†æƒ³ç‹€æ…‹ï¼Œéå¸¸æµæš¢
- **30-60 fps**: å¯æ¥å—ï¼ŒåŸºæœ¬æµæš¢
- **< 30 fps**: å¯èƒ½æœ‰æ˜é¡¯å¡é “

#### å…§å­˜ä½¿ç”¨
- **ç©©å®šå¢é•·å¾Œå¹³ç©©**: æ­£å¸¸
- **æŒçºŒå¢é•·**: å¯èƒ½æœ‰å…§å­˜æ´©æ¼
- **é »ç¹ GC**: å¯èƒ½æœ‰ä¸å¿…è¦çš„å°è±¡å‰µå»º

#### CPU ä½¿ç”¨ç‡
- **å³°å€¼ < 80%**: æ­£å¸¸
- **æŒçºŒ > 80%**: å¯èƒ½éœ€è¦å„ªåŒ–

---

## ğŸ“ æ¸¬è©¦çµæœï¼ˆå¾…å¡«å¯«ï¼‰

### æ¸¬è©¦ç’°å¢ƒ
- **è¨­å‚™**: _______________
- **OS ç‰ˆæœ¬**: _______________
- **Flutter ç‰ˆæœ¬**: _______________
- **æ¸¬è©¦æ—¥æœŸ**: _______________

### Test 1: é–±è®€å™¨å•Ÿå‹•æ™‚é–“
- **æ¸¬é‡å€¼**: _____ ms
- **ç›®æ¨™å€¼**: < 2000 ms
- **çµæœ**: â¬œ é€šé / â¬œ æœªé€šé
- **å‚™è¨»**: _______________

### Test 2: ç¿»é æµæš¢åº¦
- **å¹³å‡æ™‚é–“**: _____ ms
- **æœ€å¤§æ™‚é–“**: _____ ms
- **ç›®æ¨™å€¼**: < 100 ms (å¹³å‡)
- **çµæœ**: â¬œ é€šé / â¬œ æœªé€šé
- **å‚™è¨»**: _______________

### Test 3: å…§å­˜ä½¿ç”¨
- **å³°å€¼**: _____ MB
- **ç›®æ¨™å€¼**: < 150 MB
- **GC é »ç‡**: _______________
- **çµæœ**: â¬œ é€šé / â¬œ æœªé€šé
- **å‚™è¨»**: _______________

### Test 4: è¨­ç½®é¢æ¿å‹•ç•«
- **å¹³å‡æ‰“é–‹æ™‚é–“**: _____ ms
- **å¹³å‡é—œé–‰æ™‚é–“**: _____ ms
- **ç›®æ¨™å€¼**: < 300 ms
- **çµæœ**: â¬œ é€šé / â¬œ æœªé€šé
- **å‚™è¨»**: _______________

### Test 5: é•·æ™‚é–“ç©©å®šæ€§
- **çµæœ**: â¬œ é€šé / â¬œ æœªé€šé
- **å´©æ½°æ¬¡æ•¸**: _____
- **å¡é “æ¬¡æ•¸**: _____
- **å…§å­˜æ´©æ¼**: â¬œ ç„¡ / â¬œ æœ‰
- **å‚™è¨»**: _______________

### Test 6: å®Œæ•´æµç¨‹åŸºæº–
- **ç¸½è€—æ™‚**: _____ s (_____ ms)
- **å‚™è¨»**: _______________

---

## ğŸ”§ æ€§èƒ½å„ªåŒ–å»ºè­°

### å¦‚æœå•Ÿå‹•æ™‚é–“éé•·
1. æª¢æŸ¥ EPUB è§£æé‚è¼¯ï¼Œè€ƒæ…®ä½¿ç”¨ lazy loading
2. å„ªåŒ–åˆå§‹åŒ–éç¨‹ï¼Œå»¶é²åŠ è¼‰éé—œéµçµ„ä»¶
3. ä½¿ç”¨ `compute()` å°‡ EPUB è§£æç§»åˆ°å¾Œå°ç·šç¨‹

### å¦‚æœç¿»é ä¸æµæš¢
1. ä½¿ç”¨ `RepaintBoundary` æ¸›å°‘ä¸å¿…è¦çš„é‡ç¹ª
2. å„ªåŒ– Widget æ¨¹çµæ§‹ï¼Œæ¸›å°‘æ·±åº¦
3. è€ƒæ…®ä½¿ç”¨ `AutomaticKeepAliveClientMixin` ä¿æŒé é¢ç‹€æ…‹
4. é åŠ è¼‰ç›¸é„°é é¢å…§å®¹

### å¦‚æœå…§å­˜ä½¿ç”¨éé«˜
1. æª¢æŸ¥æ˜¯å¦æœ‰åœ–ç‰‡ç·©å­˜ç­–ç•¥
2. åŠæ™‚é‡‹æ”¾ä¸ä½¿ç”¨çš„é é¢å…§å®¹
3. ä½¿ç”¨ `WeakReference` ç®¡ç†å¯é¸è³‡æº
4. å„ªåŒ– EPUB å…§å®¹çš„ç·©å­˜æ©Ÿåˆ¶

### å¦‚æœå‹•ç•«ä¸æµæš¢
1. ç°¡åŒ–å‹•ç•«æ•ˆæœ
2. ä½¿ç”¨ `AnimatedWidget` è€Œé `setState`
3. æª¢æŸ¥æ˜¯å¦æœ‰åŒæ­¥æ“ä½œé˜»å¡ UI ç·šç¨‹

---

## ğŸ“š åƒè€ƒè³‡æ–™

- [Flutter Performance Best Practices](https://docs.flutter.dev/perf/best-practices)
- [Integration Testing](https://docs.flutter.dev/testing/integration-tests)
- [DevTools Performance View](https://docs.flutter.dev/tools/devtools/performance)
- [Flutter Performance Profiling](https://docs.flutter.dev/perf/ui-performance)

---

## âœ… æ¸¬è©¦æ¸…å–®

- [ ] æ‰€æœ‰æ¸¬è©¦ç”¨ä¾‹å·²é‹è¡Œ
- [ ] æ€§èƒ½æ•¸æ“šå·²è¨˜éŒ„
- [ ] DevTools åˆ†æå·²å®Œæˆ
- [ ] å„ªåŒ–å»ºè­°å·²åˆ—å‡ºï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ¸¬è©¦å ±å‘Šå·²æ­¸æª”
