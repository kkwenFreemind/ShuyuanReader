# Spec 04: EPUB é–±è®€å™¨ - ä»»å‹™æ¸…å–®

**ç‹€æ…‹**: ğŸ“‹ è¦åŠƒä¸­  
**å„ªå…ˆç´š**: P0 (æ ¸å¿ƒåŠŸèƒ½)  
**é è¨ˆæ™‚é–“**: 5-6 å¤© (38-42 å°æ™‚)  
**é–‹å§‹æ—¥æœŸ**: å¾…å®š  
**å®Œæˆæ—¥æœŸ**: å¾…å®š

---

## ğŸ“Š ä»»å‹™ç¸½è¦½

| éšæ®µ | ä»»å‹™æ•¸ | é è¨ˆæ™‚é–“ | å®Œæˆæ•¸ | ç‹€æ…‹ |
|------|--------|----------|--------|------|
| **Day 1-2: åŸºç¤æ¸²æŸ“ (Phase 4.1-4.7)** | 11 | 9.5h | 10 | âœ… |
| **Day 3: ç›´æ›¸æ¨¡å¼ (Phase 4.8-4.10)** | 9 | 9h | 7 | âœ… |
| **Day 4: é–±è®€è¨­ç½® (Phase 4.11-4.14)** | 6 | 5.2h | 6 | âœ… |
| **Day 4-5: æ›¸ç±¤åŠŸèƒ½ (Phase 4.15)** | 7 | 4.5h | 9 | âœ… |
| **Day 5: æ•´åˆæ¸¬è©¦ (Phase 4.16-4.17)** | 7 | 9h | 0 | â¬œ |
| **Day 6: æ–‡æª”ç™¼å¸ƒ (Phase 4.18)** | 7 | 6h | 0 | â¬œ |
| **ç¸½è¨ˆ** | **43** | **38-42h** | **31** | **72.1%** |

---

## ğŸ“… Day 1-2: åŸºç¤æ¸²æŸ“å¯¦ç¾ (7 å°æ™‚)

### Phase 4.1: å°ˆæ¡ˆæ¶æ§‹æ­å»º (0.5 å°æ™‚)

#### âœ… Task 4.1.1: å‰µå»º Reader æ¨¡å¡Šç›®éŒ„çµæ§‹
- **æ–‡ä»¶**: ç›®éŒ„çµæ§‹
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-01-XX
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å‰µå»º Reader æ¨¡å¡Šçš„å®Œæ•´ç›®éŒ„çµæ§‹
2. æŒ‰ç…§ Clean Architecture çµ„ç¹”æ–‡ä»¶
3. ç¢ºä¿ç¬¦åˆå°ˆæ¡ˆè¦ç¯„

**ç”¢å‡ºçµæ§‹**:
```
lib/
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ pages/reader/
â”‚   â”‚   â””â”€â”€ reader_page.dart
â”‚   â”œâ”€â”€ controllers/reader/
â”‚   â”‚   â””â”€â”€ reader_controller.dart
â”‚   â””â”€â”€ widgets/reader/
â”‚       â”œâ”€â”€ epub_viewer_widget.dart
â”‚       â”œâ”€â”€ reading_toolbar.dart
â”‚       â”œâ”€â”€ reading_progress_bar.dart
â”‚       â””â”€â”€ reading_settings_panel.dart
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/reader/
â”‚   â”‚   â”œâ”€â”€ reading_progress.dart
â”‚   â”‚   â”œâ”€â”€ reader_settings.dart
â”‚   â”‚   â””â”€â”€ reading_direction.dart
â”‚   â””â”€â”€ usecases/reader/
â”‚       â”œâ”€â”€ get_reading_progress.dart
â”‚       â”œâ”€â”€ save_reading_progress.dart
â”‚       â”œâ”€â”€ toggle_bookmark.dart
â”‚       â””â”€â”€ update_reader_settings.dart
â””â”€â”€ data/
    â”œâ”€â”€ models/reader/
    â”‚   â”œâ”€â”€ reading_progress_model.dart
    â”‚   â””â”€â”€ reader_settings_model.dart
    â”œâ”€â”€ datasources/reader/
    â”‚   â”œâ”€â”€ reading_local_data_source.dart
    â”‚   â””â”€â”€ epub_parser.dart
    â””â”€â”€ repositories/reader/
        â””â”€â”€ reading_repository_impl.dart
```

**äº¤ä»˜ç‰©**:
- âœ… 8 å€‹ç›®éŒ„å·²å‰µå»º (éµå¾ª Clean Architecture)
- âœ… 18 å€‹å¸¶æ–‡æª”çš„ä½”ä½æ–‡ä»¶å·²å‰µå»º
- âœ… æ‰€æœ‰æ–‡ä»¶åŒ…å«ä¸­æ–‡æ–‡æª”èˆ‡ TODO æ³¨é‡‹
- âœ… æ¸…æ™°çš„ä»»å‹™éˆæ¥ä¾¿æ–¼å¾ŒçºŒå¯¦ç¾

**é©—æ”¶æ¨™æº–**:
- [x] ç›®éŒ„çµæ§‹å®Œæ•´
- [x] ç¬¦åˆå°ˆæ¡ˆè¦ç¯„
- [x] ç„¡å‘½åéŒ¯èª¤

---

### Phase 4.2: EPUB åŒ…é›†æˆ (0.7 å°æ™‚)

#### âœ… Task 4.2.1: æ·»åŠ  epub_view ä¾è³´
- **æ–‡ä»¶**: `pubspec.yaml`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 12 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-08
- **å¯¦éš›ç”¨æ™‚**: 12 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. åœ¨ `pubspec.yaml` æ·»åŠ ä¾è³´:
   ```yaml
   dependencies:
     epub_view: ^3.1.0
     screen_brightness: ^0.2.2+1  # ç”¨æ–¼äº®åº¦èª¿æ•´
   ```
2. é‹è¡Œ `flutter pub get`
3. é©—è­‰ä¾è³´å®‰è£æˆåŠŸ

**äº¤ä»˜ç‰©**:
- âœ… `epub_view: ^3.1.0` å·²æ·»åŠ åˆ° pubspec.yaml
- âœ… `screen_brightness: ^0.2.2+1` å·²æ·»åŠ åˆ° pubspec.yaml
- âœ… ä¾è³´åŒ…æˆåŠŸä¸‹è¼‰ä¸¦å®‰è£
- âœ… ç„¡ç‰ˆæœ¬è¡çª
- âœ… ç„¡ç·¨è­¯éŒ¯èª¤

**é©—æ”¶æ¨™æº–**:
- [x] ä¾è³´æˆåŠŸå®‰è£
- [x] ç„¡ç‰ˆæœ¬è¡çª
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

---

#### âœ… Task 4.2.2: æ¸¬è©¦ epub_view åŸºæœ¬åŠŸèƒ½
- **æ–‡ä»¶**: `test/epub_view_test.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-08
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å‰µå»ºç°¡å–®çš„æ¸¬è©¦é é¢
2. é©—è­‰ epub_view èƒ½æ­£å¸¸å·¥ä½œ
3. æ¸¬è©¦æ‰“é–‹ä¸¦æ¸²æŸ“ EPUB æ–‡ä»¶

**äº¤ä»˜ç‰©**:
- âœ… å‰µå»º `test/epub_view_test.dart` æ¸¬è©¦æ–‡ä»¶
- âœ… æ¸¬è©¦ EpubController é¡å¯ä»¥è¨ªå•
- âœ… æ¸¬è©¦ EpubView Widget é¡å¯ä»¥è¨ªå•
- âœ… é©—è­‰ epub_view åŒ…æ­£ç¢ºå®‰è£
- âœ… æ‰€æœ‰æ¸¬è©¦é€šéï¼ˆ7/7 tests passedï¼‰
- âœ… æä¾› epub_view ä½¿ç”¨æŒ‡å—

**æ¸¬è©¦çµæœ**:
```
âœ“ EpubController é¡å¯ä»¥è¨ªå•
âœ“ EpubView Widget é¡å¯ä»¥è¨ªå•
âœ“ epub_view åŒ…å·²æˆåŠŸå®‰è£ä¸¦å¯ä»¥è¨ªå•
âœ“ æ‰€æœ‰ epub_view æ ¸å¿ƒçµ„ä»¶éƒ½å¯ä»¥æ­£å¸¸è¨ªå•
âœ“ åŸºæœ¬ä½¿ç”¨æŒ‡å—å·²è¼¸å‡º
```

**é©—æ”¶æ¨™æº–**:
- [x] epub_view åŒ…å¯ä»¥æ­£å¸¸å°å…¥
- [x] EpubController å’Œ EpubView é¡å¯ä»¥è¨ªå•
- [x] ç„¡é‹è¡Œæ™‚éŒ¯èª¤
- [x] æ¸¬è©¦é€šé

---

### Phase 4.3: å¯¦é«”é¡å‰µå»º (1.2 å°æ™‚)

#### âœ… Task 4.3.1: å‰µå»º ReadingProgress å¯¦é«”
- **æ–‡ä»¶**: `lib/domain/entities/reader/reading_progress.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-08
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å‰µå»º ReadingProgress é¡
2. å®šç¾©æ‰€æœ‰å¿…è¦å­—æ®µ:
   ```dart
   class ReadingProgress extends Equatable {
     final String bookId;
     final int currentPage;
     final List<int> bookmarkedPages;
     final DateTime lastReadTime;
     final String? epubCfi;
     final int? totalPages;
     // å®Œæ•´å¯¦ç¾è¦‹ä»£ç¢¼æ–‡ä»¶
   }
   ```
3. æ·»åŠ å¿…è¦çš„æ–¹æ³•

**äº¤ä»˜ç‰©**:
- âœ… ReadingProgress å¯¦é«”é¡ï¼ˆ214 è¡Œä»£ç¢¼ï¼‰
- âœ… ç¹¼æ‰¿ Equatable å¯¦ç¾å€¼æ¯”è¼ƒ
- âœ… å®Œæ•´çš„å­—æ®µå®šç¾©ï¼ˆ6 å€‹å­—æ®µï¼‰
- âœ… æ›¸ç±¤ç®¡ç†æ–¹æ³•ï¼ˆisBookmarked, toggleBookmark, addBookmark, removeBookmarkï¼‰
- âœ… é€²åº¦æ›´æ–°æ–¹æ³•ï¼ˆupdatePositionï¼‰
- âœ… é€²åº¦è¨ˆç®—æ–¹æ³•ï¼ˆprogressPercentage, progressPercentï¼‰
- âœ… ç‹€æ…‹æª¢æŸ¥æ–¹æ³•ï¼ˆisCompleted, isJustStartedï¼‰
- âœ… copyWith æ–¹æ³•å¯¦ç¾ä¸å¯è®Šæ€§
- âœ… toString æ–¹æ³•ç”¨æ–¼èª¿è©¦
- âœ… å®Œæ•´çš„å–®å…ƒæ¸¬è©¦ï¼ˆ27 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šéï¼‰

**å¯¦ç¾ç‰¹é»**:
- éµå¾ª Clean Architecture åŸå‰‡ï¼ˆç´”é ˜åŸŸå¯¦é«”ï¼‰
- ä¸å¯è®Šå°è±¡è¨­è¨ˆï¼ˆImmutableï¼‰
- å®Œæ•´çš„æ–‡æª”è¨»é‡‹
- é¡å‹å®‰å…¨çš„ null è™•ç†
- æ›¸ç±¤åˆ—è¡¨è‡ªå‹•æ’åº
- æ™‚é–“æˆ³è‡ªå‹•æ›´æ–°

**æ¸¬è©¦è¦†è“‹**:
```
âœ“ æ§‹é€ å‡½æ•¸æ¸¬è©¦ (2 tests)
âœ“ æ›¸ç±¤åŠŸèƒ½æ¸¬è©¦ (9 tests)
âœ“ é€²åº¦æ›´æ–°æ¸¬è©¦ (3 tests)
âœ“ é€²åº¦è¨ˆç®—æ¸¬è©¦ (4 tests)
âœ“ ç‹€æ…‹æª¢æŸ¥æ¸¬è©¦ (4 tests)
âœ“ copyWith æ¸¬è©¦ (2 tests)
âœ“ Equatable æ¸¬è©¦ (2 tests)
âœ“ toString æ¸¬è©¦ (1 test)
Total: 27/27 tests passed
```

**é©—æ”¶æ¨™æº–**:
- [x] é¡çµæ§‹å®Œæ•´
- [x] æ‰€æœ‰å­—æ®µå®šç¾©æ­£ç¢º
- [x] åŒ…å«å¿…è¦çš„è¼”åŠ©æ–¹æ³•
- [x] å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

---

#### âœ… Task 4.3.2: å‰µå»º ReaderSettings å¯¦é«”
- **æ–‡ä»¶**: `lib/domain/entities/reader_settings.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-08
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å‰µå»º ReaderSettings é¡
2. å®šç¾©è¨­ç½®å­—æ®µ:
   ```dart
   class ReaderSettings extends Equatable {
     final ReadingDirection direction;
     final double fontSize;
     final double brightness;
     final bool isNightMode;
     final bool autoHideToolbar;
     // å®Œæ•´å¯¦ç¾è¦‹ä»£ç¢¼æ–‡ä»¶
   }
   ```

**äº¤ä»˜ç‰©**:
- âœ… ReaderSettings å¯¦é«”é¡ï¼ˆ330 è¡Œä»£ç¢¼ï¼‰
- âœ… ç¹¼æ‰¿ Equatable å¯¦ç¾å€¼æ¯”è¼ƒ
- âœ… å®Œæ•´çš„å­—æ®µå®šç¾©ï¼ˆ5 å€‹å­—æ®µï¼‰
- âœ… é–±è®€æ–¹å‘æ›´æ–°æ–¹æ³•ï¼ˆupdateDirectionï¼‰
- âœ… å­—é«”å¤§å°èª¿æ•´æ–¹æ³•ï¼ˆupdateFontSize, increaseFontSize, decreaseFontSizeï¼‰
- âœ… äº®åº¦èª¿æ•´æ–¹æ³•ï¼ˆupdateBrightnessï¼‰
- âœ… æ¨¡å¼åˆ‡æ›æ–¹æ³•ï¼ˆtoggleNightMode, toggleAutoHideToolbarï¼‰
- âœ… å­—é«”å¤§å°æª”ä½è¨ˆç®—ï¼ˆfontSizePresetIndexï¼‰
- âœ… è¨­ç½®é©—è­‰æ–¹æ³•ï¼ˆisValidï¼‰
- âœ… JSON åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆtoJson, fromJsonï¼‰
- âœ… é è¨­è¨­ç½®å·¥å» æ–¹æ³•ï¼ˆdefaultSettingsï¼‰
- âœ… copyWith æ–¹æ³•å¯¦ç¾ä¸å¯è®Šæ€§
- âœ… toString æ–¹æ³•ç”¨æ–¼èª¿è©¦
- âœ… å®Œæ•´çš„å–®å…ƒæ¸¬è©¦ï¼ˆ41 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šéï¼‰

**å¯¦ç¾ç‰¹é»**:
- éµå¾ª Clean Architecture åŸå‰‡ï¼ˆç´”é ˜åŸŸå¯¦é«”ï¼‰
- ä¸å¯è®Šå°è±¡è¨­è¨ˆï¼ˆImmutableï¼‰
- å®Œæ•´çš„æ–‡æª”è¨»é‡‹
- é¡å‹å®‰å…¨çš„ null è™•ç†
- å­—é«”å¤§å°è‡ªå‹•é™åˆ¶ï¼ˆ12-20spï¼‰
- äº®åº¦å€¼è‡ªå‹•é™åˆ¶ï¼ˆ0.0-1.0ï¼‰
- æ”¯æŒ 5 æª”å­—é«”å¤§å°é è¨­
- å®Œæ•´çš„é©—è­‰æ©Ÿåˆ¶

**æ¸¬è©¦è¦†è“‹**:
```
âœ“ æ§‹é€ å‡½æ•¸æ¸¬è©¦ (3 tests)
âœ“ é–±è®€æ–¹å‘æ›´æ–°æ¸¬è©¦ (2 tests)
âœ“ å­—é«”å¤§å°èª¿æ•´æ¸¬è©¦ (10 tests)
âœ“ äº®åº¦èª¿æ•´æ¸¬è©¦ (3 tests)
âœ“ æ¨¡å¼åˆ‡æ›æ¸¬è©¦ (4 tests)
âœ“ é©—è­‰æ–¹æ³•æ¸¬è©¦ (6 tests)
âœ“ copyWith æ¸¬è©¦ (3 tests)
âœ“ JSON åºåˆ—åŒ–æ¸¬è©¦ (3 tests)
âœ“ Equatable æ¸¬è©¦ (3 tests)
âœ“ toString æ¸¬è©¦ (2 tests)
âœ“ å¸¸é‡æ¸¬è©¦ (3 tests)
Total: 41/41 tests passed
```

**é©—æ”¶æ¨™æº–**:
- [x] è¨­ç½®å­—æ®µå®Œæ•´
- [x] åŒ…å«é è¨­å€¼
- [x] é¡å‹å®šç¾©æ­£ç¢º
- [x] æ‰€æœ‰æ›´æ–°æ–¹æ³•å¯¦ç¾
- [x] JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
- [x] å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

---

#### âœ… Task 4.3.3: å‰µå»º ReadingDirection æšèˆ‰
- **æ–‡ä»¶**: `lib/domain/entities/reader/reading_direction.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 12 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-08
- **å¯¦éš›ç”¨æ™‚**: 12 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å®šç¾© ReadingDirection æšèˆ‰:
   ```dart
   enum ReadingDirection {
     vertical('ç›´æ›¸'),    // ç›´æ›¸
     horizontal('æ©«æ›¸'),  // æ©«æ›¸
   }
   ```

**äº¤ä»˜ç‰©**:
- âœ… ReadingDirection æšèˆ‰ï¼ˆ135 è¡Œä»£ç¢¼ï¼‰
- âœ… å…©å€‹æšèˆ‰å€¼ï¼šverticalï¼ˆç›´æ›¸ï¼‰ã€horizontalï¼ˆæ©«æ›¸ï¼‰
- âœ… é¡¯ç¤ºåç¨±å­—æ®µï¼ˆdisplayNameï¼‰
- âœ… åˆ¤æ–·æ–¹æ³•ï¼ˆisVertical, isHorizontalï¼‰
- âœ… åˆ‡æ›æ–¹æ³•ï¼ˆtoggleï¼‰
- âœ… CSS å±¬æ€§ç²å–ï¼ˆcssWritingModeï¼‰
- âœ… UI ç›¸é—œå±¬æ€§ï¼ˆicon, swipeHintï¼‰
- âœ… toString æ–¹æ³•
- âœ… å®Œæ•´çš„å–®å…ƒæ¸¬è©¦ï¼ˆ22 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šéï¼‰

**å¯¦ç¾ç‰¹é»**:
- Enhanced Enumï¼ˆå¢å¼·æšèˆ‰ï¼Œå¸¶æ§‹é€ åƒæ•¸ï¼‰
- æ”¯æŒä¸­æ–‡é¡¯ç¤ºåç¨±
- æä¾› CSS writing-mode å±¬æ€§å€¼
- æä¾› UI åœ–æ¨™å’Œç¿»é æç¤º
- å®Œæ•´çš„æ–‡æª”è¨»é‡‹
- æ‰€æœ‰æ–¹æ³•éƒ½ç¶“éæ¸¬è©¦

**æ¸¬è©¦è¦†è“‹**:
```
âœ“ æšèˆ‰å€¼æ¸¬è©¦ (3 tests)
âœ“ åˆ¤æ–·æ–¹æ³•æ¸¬è©¦ (2 tests)
âœ“ åˆ‡æ›æ–¹æ³•æ¸¬è©¦ (3 tests)
âœ“ CSS å±¬æ€§æ¸¬è©¦ (2 tests)
âœ“ UI ç›¸é—œå±¬æ€§æ¸¬è©¦ (4 tests)
âœ“ toString æ¸¬è©¦ (2 tests)
âœ“ æšèˆ‰åç¨±æ¸¬è©¦ (3 tests)
âœ“ å®Œæ•´ä½¿ç”¨å ´æ™¯æ¸¬è©¦ (3 tests)
Total: 22/22 tests passed
```

**é©—æ”¶æ¨™æº–**:
- [x] æšèˆ‰å®šç¾©æ­£ç¢º
- [x] åŒ…å«å…©ç¨®é–±è®€æ–¹å‘
- [x] åŒ…å«æ–‡æª”è¨»é‡‹
- [x] æä¾›ä¸­æ–‡é¡¯ç¤ºåç¨±
- [x] æä¾› CSS å±¬æ€§
- [x] æä¾› UI è¼”åŠ©å±¬æ€§
- [x] å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

---

### Phase 4.4: ReaderController åŸºç¤å¯¦ç¾ (1.5 å°æ™‚) âœ…

**ç‹€æ…‹**: âœ… å·²å®Œæˆ  
**å®Œæˆæ™‚é–“**: 2025-11-09  
**å¯¦éš›ç”¨æ™‚**: 1.5 å°æ™‚  
**é€²åº¦**: 2/2 ä»»å‹™å®Œæˆ (100%)

#### âœ… Task 4.4.1: å‰µå»º ReaderController æ¡†æ¶
- **æ–‡ä»¶**: `lib/presentation/controllers/reader/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-09
- **å¯¦éš›ç”¨æ™‚**: 1 å°æ™‚

**å…·é«”æ­¥é©Ÿ**:
1. ä½¿ç”¨ GetX å‰µå»ºæ§åˆ¶å™¨
2. å®šç¾©åŸºæœ¬ç‹€æ…‹å’Œæ–¹æ³•
3. å¯¦ç¾ç”Ÿå‘½é€±æœŸæ–¹æ³•

**äº¤ä»˜ç‰©**:
- âœ… ReaderController é¡ï¼ˆ655 è¡Œä»£ç¢¼ï¼‰
- âœ… ç¹¼æ‰¿ GetxController
- âœ… ä¾è³´æ³¨å…¥ï¼ˆ4 å€‹ Use Casesï¼‰
- âœ… éŸ¿æ‡‰å¼ç‹€æ…‹ï¼ˆ15 å€‹ Observable è®Šæ•¸ï¼‰
- âœ… ç”Ÿå‘½é€±æœŸæ–¹æ³•ï¼ˆonInit, onCloseï¼‰
- âœ… åˆå§‹åŒ–é‚è¼¯ï¼ˆ_initialize æ–¹æ³•ï¼‰
- âœ… æ¸…ç†é‚è¼¯ï¼ˆ_cleanup æ–¹æ³•ï¼‰
- âœ… ç¿»é æ§åˆ¶ï¼ˆnextPage, previousPage, goToPageï¼‰
- âœ… é–±è®€æ–¹å‘æ§åˆ¶ï¼ˆtoggleReadingDirection, setReadingDirectionï¼‰
- âœ… å­—é«”å¤§å°æ§åˆ¶ï¼ˆsetFontSize, increaseFontSize, decreaseFontSizeï¼‰
- âœ… äº®åº¦æ§åˆ¶ï¼ˆsetBrightnessï¼‰
- âœ… å¤œé–“æ¨¡å¼æ§åˆ¶ï¼ˆtoggleNightModeï¼‰
- âœ… å·¥å…·æ¬„æ§åˆ¶ï¼ˆtoggleToolbar, showToolbar, hideToolbarï¼‰
- âœ… æ›¸ç±¤ç®¡ç†ï¼ˆtoggleCurrentBookmarkï¼‰
- âœ… é€²åº¦ä¿å­˜ï¼ˆ_saveProgressï¼‰
- âœ… è¨­ç½®ä¿å­˜ï¼ˆ_saveSettingsï¼‰
- âœ… è¨ˆç®—å±¬æ€§ï¼ˆprogressPercentage, isCurrentPageBookmarked, ç­‰ï¼‰
- âœ… å®Œæ•´çš„æ–‡æª”è¨»é‡‹

**å¯¦ç¾ç‰¹é»**:
- éµå¾ª Clean Architecture åŸå‰‡
- ä½¿ç”¨ GetX é€²è¡Œç‹€æ…‹ç®¡ç†å’Œä¾è³´æ³¨å…¥
- å®Œæ•´çš„ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ˆåˆå§‹åŒ–å’Œæ¸…ç†ï¼‰
- è‡ªå‹•ä¿å­˜é–±è®€é€²åº¦å’Œè¨­ç½®
- è‡ªå‹•æ¢å¾©ç³»çµ±äº®åº¦
- éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶æç¤º
- æ”¯æŒç›´æ›¸/æ©«æ›¸åˆ‡æ›
- æ”¯æŒå­—é«”å¤§å°èª¿æ•´ï¼ˆ12-20spï¼‰
- æ”¯æŒäº®åº¦èª¿æ•´ï¼ˆ0.0-1.0ï¼‰
- æ”¯æŒå¤œé–“æ¨¡å¼
- æ”¯æŒæ›¸ç±¤ç®¡ç†
- æ”¯æŒå·¥å…·æ¬„è‡ªå‹•éš±è—
- å®Œæ•´çš„ä¸­æ–‡æ–‡æª”è¨»é‡‹

**ä¸»è¦åŠŸèƒ½æ¨¡å¡Š**:
```
1. ä¾è³´æ³¨å…¥ï¼ˆ4 å€‹ Use Casesï¼‰
2. éŸ¿æ‡‰å¼ç‹€æ…‹ï¼ˆ15 å€‹ .obs è®Šæ•¸ï¼‰
3. è¨ˆç®—å±¬æ€§ï¼ˆ7 å€‹ gettersï¼‰
4. ç”Ÿå‘½é€±æœŸï¼ˆonInit, onCloseï¼‰
5. åˆå§‹åŒ–ï¼ˆ_initialize, _loadBook, _loadReadingProgress, _loadReaderSettingsï¼‰
6. æ¸…ç†ï¼ˆ_cleanup, _restoreOriginalBrightnessï¼‰
7. ç¿»é æ§åˆ¶ï¼ˆnextPage, previousPage, goToPageï¼‰
8. é–±è®€æ–¹å‘ï¼ˆtoggleReadingDirection, setReadingDirectionï¼‰
9. å­—é«”å¤§å°ï¼ˆsetFontSize, increaseFontSize, decreaseFontSizeï¼‰
10. äº®åº¦æ§åˆ¶ï¼ˆsetBrightness, _applyBrightnessï¼‰
11. å¤œé–“æ¨¡å¼ï¼ˆtoggleNightModeï¼‰
12. å·¥å…·æ¬„æ§åˆ¶ï¼ˆtoggleToolbar, showToolbar, hideToolbar, toggleAutoHideToolbarï¼‰
13. æ›¸ç±¤ç®¡ç†ï¼ˆtoggleCurrentBookmarkï¼‰
14. é€²åº¦ä¿å­˜ï¼ˆ_saveProgress, _saveSettingsï¼‰
```

**å¾…å¯¦ç¾åŠŸèƒ½** (æ¨™è¨˜ç‚º TODOï¼Œå°‡åœ¨å¾ŒçºŒä»»å‹™ä¸­å¯¦ç¾):
- Task 4.4.2: å¾æ•¸æ“šåº«åŠ è¼‰æ›¸ç±è©³æƒ…
- Task 4.5.2: åˆå§‹åŒ– EPUB æ§åˆ¶å™¨
- Task 4.12.2: æ‡‰ç”¨å­—é«”å¤§å°åˆ° EPUB è¦–åœ–
- Task 4.14.1: å¾ SharedPreferences åŠ è¼‰/ä¿å­˜è¨­ç½®

**é©—æ”¶æ¨™æº–**:
- [x] æ§åˆ¶å™¨ç¹¼æ‰¿ `GetxController`
- [x] å®šç¾©æ‰€æœ‰å¿…è¦çš„ Observable è®Šæ•¸
- [x] å¯¦ç¾ `onInit()` å’Œ `onClose()` ç”Ÿå‘½é€±æœŸ
- [x] å®Œæ•´çš„æ–‡æª”è¨»é‡‹
- [x] éŒ¯èª¤è™•ç†å®Œå–„
- [x] ä»£ç¢¼çµæ§‹æ¸…æ™°

---

#### âœ… Task 4.4.2: å¯¦ç¾æ›¸ç±åŠ è¼‰é‚è¼¯
- **æ–‡ä»¶**: `lib/presentation/controllers/reader/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-09
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å¯¦ç¾å¾ arguments ç²å–æ›¸ç±
2. è®€å–æœ¬åœ° EPUB æ–‡ä»¶è·¯å¾‘
3. æ·»åŠ éŒ¯èª¤è™•ç†

**äº¤ä»˜ç‰©**:
- âœ… æ·»åŠ  BookRepository ä¾è³´æ³¨å…¥
- âœ… å¯¦ç¾å®Œæ•´çš„ _loadBook() æ–¹æ³•ï¼ˆ52 è¡Œä»£ç¢¼ï¼‰
- âœ… å¾è·¯ç”±åƒæ•¸ç²å– bookId
- âœ… å¾æ•¸æ“šåº«åŠ è¼‰æ›¸ç±è©³æƒ…
- âœ… é©—è­‰æ›¸ç±æ˜¯å¦å·²ä¸‹è¼‰
- âœ… é©—è­‰æœ¬åœ° EPUB æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œç”¨æˆ¶æç¤º
- âœ… å®Œæ•´çš„æ–‡æª”è¨»é‡‹

**å¯¦ç¾ç‰¹é»**:
- æ·»åŠ  `dart:io` å°å…¥ä»¥æ”¯æŒæ–‡ä»¶æ“ä½œ
- æ·»åŠ  BookRepository ä¾è³´åˆ°æ§‹é€ å‡½æ•¸
- å®Œæ•´çš„ 5 æ­¥é©—è­‰æµç¨‹ï¼š
  1. é©—è­‰è·¯ç”±åƒæ•¸
  2. å¾æ•¸æ“šåº«åŠ è¼‰æ›¸ç±
  3. é©—è­‰ä¸‹è¼‰ç‹€æ…‹
  4. é©—è­‰æ–‡ä»¶å­˜åœ¨æ€§
  5. è¨­ç½®æ›¸ç±ä¿¡æ¯
- è©³ç´°çš„éŒ¯èª¤æ¶ˆæ¯è¨­ç½®
- ä½¿ç”¨ File.exists() é©—è­‰æœ¬åœ°æ–‡ä»¶
- ç•°å¸¸é‡æ–°æ‹‹å‡ºä»¥ä¾›ä¸Šå±¤è™•ç†

**éŒ¯èª¤è™•ç†**:
```dart
- ç¼ºå°‘ bookId åƒæ•¸ â†’ "ç¼ºå°‘æ›¸ç± ID åƒæ•¸"
- æ›¸ç±ä¸å­˜åœ¨ â†’ "æ‰¾ä¸åˆ°æ›¸ç±ï¼š{bookId}"
- æ›¸ç±å°šæœªä¸‹è¼‰ â†’ "æ›¸ç±å°šæœªä¸‹è¼‰ï¼Œè«‹å…ˆä¸‹è¼‰"
- æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨ â†’ "æœ¬åœ°æ–‡ä»¶ä¸å­˜åœ¨ï¼š{path}"
- å…¶ä»–éŒ¯èª¤ â†’ "åŠ è¼‰æ›¸ç±å¤±æ•—ï¼š{error}"
```

**é©—æ”¶æ¨™æº–**:
- [x] èƒ½å¾è·¯ç”±åƒæ•¸ç²å– bookId
- [x] èƒ½å¾æ•¸æ“šåº«è®€å–æ›¸ç±ä¿¡æ¯
- [x] èƒ½è®€å–æœ¬åœ° EPUB æ–‡ä»¶è·¯å¾‘
- [x] é©—è­‰æ–‡ä»¶å­˜åœ¨æ€§
- [x] éŒ¯èª¤è™•ç†å®Œå–„
- [x] ç”¨æˆ¶å‹å¥½çš„éŒ¯èª¤æç¤º

**Phase 4.4 ç‹€æ…‹**: âœ… 100% å®Œæˆ (2/2 ä»»å‹™)

---

### Phase 4.5: ReaderPage åŸºç¤ UI (1.5 å°æ™‚) âœ…

**ç‹€æ…‹**: âœ… å·²å®Œæˆ  
**å®Œæˆæ™‚é–“**: 2025-11-09  
**å¯¦éš›ç”¨æ™‚**: 1.5 å°æ™‚  
**é€²åº¦**: 2/2 ä»»å‹™å®Œæˆ (100%)

#### âœ… Task 4.5.1: å‰µå»º ReaderPage æ¡†æ¶
- **æ–‡ä»¶**: `lib/presentation/pages/reader_page.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-09
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. å‰µå»ºé–±è®€å™¨é é¢åŸºæœ¬çµæ§‹
2. é›†æˆ ReaderController
3. è¨­ç½®åŸºæœ¬çš„ AppBar å’Œ Body

**äº¤ä»˜ç‰©**:
- âœ… ReaderPage Widgetï¼ˆ358 è¡Œä»£ç¢¼ï¼‰
- âœ… Scaffold çµæ§‹å®Œæ•´
- âœ… é›†æˆ ReaderControllerï¼ˆGetXï¼‰
- âœ… éŸ¿æ‡‰å¼ AppBarï¼ˆå¯é¡¯ç¤º/éš±è—ï¼‰
- âœ… å®Œæ•´çš„å·¥å…·æ¬„æŒ‰éˆ•ï¼š
  - è¿”å›æŒ‰éˆ•ï¼ˆè‡ªå‹•ä¿å­˜é€²åº¦ï¼‰
  - æ›¸ç±æ¨™é¡Œé¡¯ç¤º
  - ç›´æ›¸/æ©«æ›¸åˆ‡æ›æŒ‰éˆ•ï¼ˆä½¿ç”¨ emoji åœ–æ¨™ï¼‰
  - æ›¸ç±¤æŒ‰éˆ•ï¼ˆå‹•æ…‹åœ–æ¨™ç‹€æ…‹ï¼‰
  - è¨­ç½®æŒ‰éˆ•ï¼ˆTODO æ¨™è¨˜ï¼‰
- âœ… ä¸»è¦å…§å®¹å€åŸŸï¼š
  - åŠ è¼‰ç‹€æ…‹é¡¯ç¤º
  - éŒ¯èª¤ç‹€æ…‹é¡¯ç¤º
  - EPUB å…§å®¹å€åŸŸï¼ˆå¾…é›†æˆ Task 4.5.2ï¼‰
  - é»æ“Šåˆ‡æ›å·¥å…·æ¬„æ‰‹å‹¢
- âœ… åº•éƒ¨é€²åº¦æ¢ï¼š
  - è¦–è¦ºåŒ–é€²åº¦æ¢
  - ç•¶å‰é ç¢¼ / ç¸½é æ•¸
  - é–±è®€ç™¾åˆ†æ¯”é¡¯ç¤º
  - å¤œé–“æ¨¡å¼è‡ªé©æ‡‰
- âœ… å®Œæ•´çš„æ–‡æª”è¨»é‡‹ï¼ˆä¸­æ–‡ï¼‰
- âœ… ä½¿ç”¨ GetX éŸ¿æ‡‰å¼ç·¨ç¨‹ï¼ˆObxï¼‰

**å¯¦ç¾ç‰¹é»**:
- éµå¾ª Clean Architecture åŸå‰‡
- ç„¡ç‹€æ…‹ Widgetï¼Œç‹€æ…‹ç”± Controller ç®¡ç†
- å®Œæ•´çš„éŸ¿æ‡‰å¼ UIï¼ˆæ‰€æœ‰å‹•æ…‹å…§å®¹ä½¿ç”¨ Obxï¼‰
- ä¸‰ç¨®é é¢ç‹€æ…‹è™•ç†ï¼š
  1. åŠ è¼‰ä¸­ï¼ˆCircularProgressIndicatorï¼‰
  2. éŒ¯èª¤ï¼ˆéŒ¯èª¤ä¿¡æ¯ + è¿”å›æŒ‰éˆ•ï¼‰
  3. æ­£å¸¸ï¼ˆEPUB å…§å®¹ + é€²åº¦æ¢ï¼‰
- å·¥å…·æ¬„é¡¯ç¤º/éš±è—åˆ‡æ›
- å¤œé–“æ¨¡å¼ UI è‡ªé©æ‡‰
- æ‰‹å‹¢æ”¯æŒï¼ˆé»æ“Šåˆ‡æ›å·¥å…·æ¬„ï¼‰
- æ›¸ç±¤ç‹€æ…‹å‹•æ…‹é¡¯ç¤º
- é€²åº¦æ¢å¯¦æ™‚æ›´æ–°

**UI çµæ§‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æ›¸å    âš”ï¸ ğŸ“–   âš™ï¸  ğŸ”–           â”‚ â† AppBar (å¯éš±è—)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚         EPUB å…§å®¹é¡¯ç¤ºå€åŸŸ             â”‚
â”‚         (é»æ“Šåˆ‡æ›å·¥å…·æ¬„)              â”‚
â”‚                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 15%         â”‚ â† é€²åº¦æ¢
â”‚      ç¬¬ 5 é  / å…± 30 é               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·²è™•ç†å•é¡Œ**:
- âœ… ä¿®å¾© Obx è¿”å›é¡å‹å•é¡Œï¼ˆAppBarï¼‰
- âœ… ä¿®å¾© refresh() void è¿”å›å€¼å•é¡Œ
- âœ… ä¿®å¾© ReadingDirection.icon é¡å‹å•é¡Œï¼ˆString emojiï¼‰
- âœ… ä¿®å¾© withOpacity æ£„ç”¨è­¦å‘Šï¼ˆæ”¹ç”¨ withValuesï¼‰

**å¾…å¯¦ç¾åŠŸèƒ½** (æ¨™è¨˜ç‚º TODO):
- Task 4.5.2: é›†æˆ EpubViewerWidget
- Task 4.8.1: æ‰“é–‹è¨­ç½®é¢æ¿
- æ‰‹å‹¢ç¿»é ï¼ˆæ»‘å‹•ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] Scaffold çµæ§‹å®Œæ•´
- [x] é›†æˆ ReaderController
- [x] åŸºæœ¬çš„ AppBar å’Œ Body
- [x] éŸ¿æ‡‰å¼ UIï¼ˆObxï¼‰
- [x] å·¥å…·æ¬„é¡¯ç¤º/éš±è—
- [x] é€²åº¦æ¢é¡¯ç¤º
- [x] ä¸‰ç¨®ç‹€æ…‹è™•ç†
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

---

#### âœ… Task 4.5.2: å¯¦ç¾ EpubViewerWidget
- **æ–‡ä»¶**: `lib/presentation/widgets/epub_viewer_widget.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-09
- **å¯¦éš›ç”¨æ™‚**: 1 å°æ™‚

**å…·é«”æ­¥é©Ÿ**:
1. å°è£ epub_view çš„ EpubView Widget
2. å¯¦ç¾æ‰‹å‹¢ç¿»é 
3. æ·»åŠ åŠ è¼‰å‹•ç•«

**äº¤ä»˜ç‰©**:
- âœ… EpubViewerWidget Widgetï¼ˆ230 è¡Œä»£ç¢¼ï¼‰
- âœ… å°è£ epub_view çš„ EpubView
- âœ… æ‰‹å‹¢ç¿»é æ”¯æŒï¼š
  - é»æ“Šè¢å¹•ä¸­å¤®åˆ‡æ›å·¥å…·æ¬„
  - æ°´å¹³æ»‘å‹•ç¿»é ï¼ˆé€Ÿåº¦é–¾å€¼ 500ï¼‰
  - ç›´æ›¸/æ©«æ›¸æ¨¡å¼è‡ªé©æ‡‰
- âœ… åŠ è¼‰å‹•ç•«ï¼š
  - CircularProgressIndicator
  - åŠ è¼‰æç¤ºæ–‡å­—
- âœ… ç« ç¯€åˆ†éš”ç¬¦è‡ªå®šç¾©
- âœ… éŒ¯èª¤ç‹€æ…‹è™•ç†ï¼ˆæ§åˆ¶å™¨ç‚ºç©ºï¼‰
- âœ… å¤œé–“æ¨¡å¼é¡è‰²è‡ªé©æ‡‰
- âœ… å®Œæ•´çš„æ–‡æª”è¨»é‡‹ï¼ˆä¸­æ–‡ï¼‰
- âœ… é›†æˆåˆ° ReaderPage

**å¯¦ç¾ç‰¹é»**:
- éµå¾ª Clean Architecture åŸå‰‡
- ç„¡ç‹€æ…‹ Widgetï¼Œç‹€æ…‹ç”± Controller ç®¡ç†
- å®Œæ•´çš„æ‰‹å‹¢è™•ç†é‚è¼¯
- é–±è®€æ–¹å‘è‡ªé©æ‡‰ï¼š
  * **ç›´æ›¸æ¨¡å¼ï¼ˆverticalï¼‰**ï¼š
    - å¾å³å‘å·¦æ»‘å‹• â†’ ä¸‹ä¸€é 
    - å¾å·¦å‘å³æ»‘å‹• â†’ ä¸Šä¸€é 
  * **æ©«æ›¸æ¨¡å¼ï¼ˆhorizontalï¼‰**ï¼š
    - å¾å·¦å‘å³æ»‘å‹• â†’ ä¸‹ä¸€é 
    - å¾å³å‘å·¦æ»‘å‹• â†’ ä¸Šä¸€é 
- é€Ÿåº¦é–¾å€¼éæ¿¾ï¼ˆé¿å…èª¤è§¸ï¼‰
- è‡ªå®šç¾©æ§‹å»ºå™¨ï¼š
  * chapterDividerBuilderï¼šç« ç¯€åˆ†éš”ç¬¦
  * loaderBuilderï¼šåŠ è¼‰å‹•ç•«
- å¤–éƒ¨éˆæ¥è™•ç†æ”¯æŒ
- èƒŒæ™¯å’Œæ–‡å­—é¡è‰²å¯é…ç½®

**æ‰‹å‹¢é‚è¼¯**:
```dart
// ç›´æ›¸æ¨¡å¼
if (direction == ReadingDirection.vertical) {
  if (velocity < 0) onNextPage();      // å³â†’å·¦ = ä¸‹ä¸€é 
  else onPreviousPage();               // å·¦â†’å³ = ä¸Šä¸€é 
}
// æ©«æ›¸æ¨¡å¼
else {
  if (velocity > 0) onNextPage();      // å·¦â†’å³ = ä¸‹ä¸€é 
  else onPreviousPage();               // å³â†’å·¦ = ä¸Šä¸€é 
}
```

**é›†æˆåˆ° ReaderPage**:
- âœ… å°å…¥ EpubViewerWidget
- âœ… æ›¿æ›ä½”ä½ç¬¦ç‚ºå¯¦éš›çµ„ä»¶
- âœ… å‚³éæ‰€æœ‰å¿…è¦åƒæ•¸ï¼š
  * controller.epubController
  * controller.readingDirection
  * controller.toggleToolbar
  * controller.nextPage / previousPage
  * èƒŒæ™¯å’Œæ–‡å­—é¡è‰²ï¼ˆå¤œé–“æ¨¡å¼è‡ªé©æ‡‰ï¼‰
- âœ… ä½¿ç”¨ Obx åŒ…è£¹å¯¦ç¾éŸ¿æ‡‰å¼

**é©—æ”¶æ¨™æº–**:
- [x] èƒ½æ­£ç¢ºé¡¯ç¤º EPUB å…§å®¹
- [x] æ”¯æŒæ‰‹å‹¢ç¿»é 
- [x] æœ‰åŠ è¼‰å‹•ç•«
- [x] é–±è®€æ–¹å‘è‡ªé©æ‡‰
- [x] å¤œé–“æ¨¡å¼æ”¯æŒ
- [x] ç„¡ç·¨è­¯éŒ¯èª¤

**Phase 4.5 ç‹€æ…‹**: âœ… 100% å®Œæˆ (2/2 ä»»å‹™)

---

### Phase 4.6: ç¿»é åŠŸèƒ½å¯¦ç¾ (1 å°æ™‚)

#### âœ… Task 4.6.1: å¯¦ç¾æ©«æ›¸æ¨¡å¼ç¿»é 
- **æ–‡ä»¶**: `lib/presentation/controllers/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-11-09  
- **å¯¦éš›ç”¨æ™‚**: å·²åœ¨ Task 4.4.1 å¯¦ç¾

**å…·é«”æ­¥é©Ÿ**:
1. å¯¦ç¾å¾å·¦å‘å³æ»‘å‹•ç¿»é ï¼ˆæ©«æ›¸æ¨¡å¼ï¼‰
2. æ·»åŠ  `nextPage()` å’Œ `previousPage()` æ–¹æ³•
3. è™•ç†é‚Šç•Œæƒ…æ³

**äº¤ä»˜ç‰©**:
- âœ… `nextPage()` æ–¹æ³•å·²å¯¦ç¾ï¼ˆTask 4.4.1ï¼‰
- âœ… `previousPage()` æ–¹æ³•å·²å¯¦ç¾ï¼ˆTask 4.4.1ï¼‰
- âœ… `goToPage(int page)` æ–¹æ³•å·²å¯¦ç¾
- âœ… é‚Šç•Œæª¢æŸ¥è¨ˆç®—å±¬æ€§ï¼š
  - `canGoNext`: æª¢æŸ¥æ˜¯å¦å¯ä»¥ç¿»åˆ°ä¸‹ä¸€é 
  - `canGoPrevious`: æª¢æŸ¥æ˜¯å¦å¯ä»¥ç¿»åˆ°ä¸Šä¸€é 
- âœ… è‡ªå‹•ä¿å­˜é–±è®€é€²åº¦
- âœ… è‡ªå‹•éš±è—å·¥å…·æ¬„ï¼ˆå¦‚æœå•Ÿç”¨ï¼‰
- âœ… æ‰‹å‹¢ç¿»é å·²åœ¨ EpubViewerWidget å¯¦ç¾ï¼ˆTask 4.5.2ï¼‰

**å¯¦ç¾ç‰¹é»**:
- é‚Šç•Œä¿è­·ï¼šä½¿ç”¨ `canGoNext` å’Œ `canGoPrevious` é˜²æ­¢è¶Šç•Œ
- è‡ªå‹•ä¿å­˜ï¼šç¿»é å¾Œè‡ªå‹•èª¿ç”¨ `_saveProgress()`
- å·¥å…·æ¬„ç®¡ç†ï¼šå¦‚æœå•Ÿç”¨ autoHideToolbarï¼Œç¿»é å¾Œè‡ªå‹•éš±è—å·¥å…·æ¬„
- æ–¹å‘è‡ªé©æ‡‰ï¼šæ‰‹å‹¢é‚è¼¯å·²åœ¨ EpubViewerWidget ä¸­å¯¦ç¾
  * ç›´æ›¸æ¨¡å¼ï¼šå³â†’å·¦æ»‘å‹• = ä¸‹ä¸€é 
  * æ©«æ›¸æ¨¡å¼ï¼šå·¦â†’å³æ»‘å‹• = ä¸‹ä¸€é 

**å·²å¯¦ç¾ä»£ç¢¼** (ReaderController):
```dart
void nextPage() {
  if (!canGoNext) return;
  currentPage.value++;
  epubController?.next();  // å¾…é©—è­‰ API
  _saveProgress();
  if (autoHideToolbar.value && isToolbarVisible.value) {
    isToolbarVisible.value = false;
  }
}

void previousPage() {
  if (!canGoPrevious) return;
  currentPage.value--;
  epubController?.previous();  // å¾…é©—è­‰ API
  _saveProgress();
  if (autoHideToolbar.value && isToolbarVisible.value) {
    isToolbarVisible.value = false;
  }
}
```

**å·²å¯¦ç¾ä»£ç¢¼** (EpubViewerWidget):
```dart
onHorizontalDragEnd: (details) {
  _handleSwipeGesture(details);
}

void _handleSwipeGesture(DragEndDetails details) {
  final velocity = details.primaryVelocity;
  if (velocity == null || velocity.abs() < 500) return;
  
  if (direction == ReadingDirection.vertical) {
    if (velocity < 0) onNextPage(); else onPreviousPage();
  } else {
    if (velocity > 0) onNextPage(); else onPreviousPage();
  }
}
```

**å¾…è™•ç†**:
- âš ï¸ é©—è­‰ epub_view åŒ…çš„æ­£ç¢º API æ–¹æ³•ï¼ˆ`next()` / `previous()` å¯èƒ½ä¸å­˜åœ¨ï¼‰
- ğŸ“ å¯èƒ½éœ€è¦ä½¿ç”¨ `EpubController` çš„å…¶ä»–æ–¹æ³•é€²è¡Œé é¢å°èˆª

**é©—æ”¶æ¨™æº–**:
- [x] å·¦æ»‘ç¿»ä¸‹ä¸€é ï¼ˆæ©«æ›¸æ¨¡å¼ï¼‰
- [x] å³æ»‘ç¿»ä¸Šä¸€é ï¼ˆæ©«æ›¸æ¨¡å¼ï¼‰
- [x] é‚Šç•Œè™•ç†ï¼ˆé¦–é /æœ«é ï¼‰
- [x] ç¿»é å‹•ç•«æµæš¢ï¼ˆç”± epub_view åŒ…è™•ç†ï¼‰
- [x] æ‰‹å‹¢é€Ÿåº¦é–¾å€¼ï¼ˆ500ï¼‰

**å‚™è¨»**:
æ­¤ä»»å‹™çš„æ ¸å¿ƒé‚è¼¯å·²åœ¨ Task 4.4.1ï¼ˆReaderController æ¡†æ¶ï¼‰å’Œ Task 4.5.2ï¼ˆEpubViewerWidgetï¼‰ä¸­å¯¦ç¾ã€‚
ç¿»é åŠŸèƒ½å®Œæ•´ï¼Œä½† EpubController çš„ API æ–¹æ³•éœ€è¦æ ¹æ“šå¯¦éš›åŒ…æ–‡æª”é€²è¡Œé©—è­‰å’Œèª¿æ•´ã€‚

---

### Phase 4.7: é–±è®€é€²åº¦é¡¯ç¤º (1 å°æ™‚)

#### âœ… Task 4.7.1: å‰µå»º ReadingProgressBar Widget
- **æ–‡ä»¶**: `lib/presentation/widgets/reading_progress_bar.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å¯¦ç¾æ‘˜è¦**:
- å‰µå»ºç¨ç«‹çš„ ReadingProgressBar widget
- å¾ ReaderPage ä¸­æå–é€²åº¦æ¢é‚è¼¯
- ä½¿ç”¨åƒæ•¸åŒ–è¨­è¨ˆï¼ˆå‚³é currentPageã€totalPagesã€progressPercentageã€isNightModeï¼‰
- ä¿æŒ stateless ä»¥æé«˜å¯æ¸¬è©¦æ€§
- æ”¯æŒå¤œé–“æ¨¡å¼è‡ªé©æ‡‰é¡è‰²

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å‰µå»ºé€²åº¦æ¢ Widget
2. âœ… é¡¯ç¤ºã€Œç¬¬ X é  / å…± Y é ã€
3. âœ… é¡¯ç¤ºç™¾åˆ†æ¯”é€²åº¦æ¢
4. âœ… å¯¦æ™‚æ›´æ–°ï¼ˆé€šé Obx åŒ…è£ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] é¡¯ç¤ºã€Œç¬¬ X é  / å…± Y é ã€
- [x] é¡¯ç¤ºç™¾åˆ†æ¯”é€²åº¦æ¢
- [x] å¯¦æ™‚æ›´æ–°
- [x] åº•éƒ¨å›ºå®šé¡¯ç¤º

**æ–‡ä»¶è®Šæ›´**:
- `lib/presentation/widgets/reader/reading_progress_bar.dart` (æ–°å»º, 140 è¡Œ)
- `lib/presentation/pages/reader/reader_page.dart` (é‡æ§‹ _buildProgressBar æ–¹æ³•)

---

**éšæ®µ 1-2 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 8
- **é è¨ˆæ™‚é–“**: ~7 å°æ™‚
- **é—œéµç”¢å‡º**: èƒ½æ‰“é–‹ EPUB ä¸¦é–±è®€ï¼ˆæ©«æ›¸æ¨¡å¼ï¼‰

---

## ğŸ“… Day 3: ç›´æ›¸æ¨¡å¼å¯¦ç¾ (6.5 å°æ™‚)

### Phase 4.8: ç›´æ›¸æ’ç‰ˆå¯¦ç¾ (3 å°æ™‚)

#### âœ… Task 4.8.1: ç ”ç©¶ CSS writing-mode å¯¦ç¾
- **æ–‡ä»¶**: `doc/epub_vertical_text_research.md`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**ç ”ç©¶æˆæœ**:
å®Œæˆäº† CSS writing-mode åœ¨ epub_view åŒ…ä¸­çš„å¯¦ç¾å¯è¡Œæ€§ç ”ç©¶ï¼Œæ’°å¯«äº†è©³ç´°çš„æŠ€è¡“æ–¹æ¡ˆæ–‡æª”ã€‚

**æ ¸å¿ƒç™¼ç¾**:
1. âŒ epub_view 3.2.0 **ä¸æ”¯æŒ**ç›´æ¥ CSS æ³¨å…¥
2. âœ… **æ¨è–¦æ–¹æ¡ˆ**: ä¿®æ”¹ EPUB æºæ–‡ä»¶ï¼Œåœ¨åŠ è¼‰å‰æ³¨å…¥ CSS
3. âœ… ä½¿ç”¨ `archive` åŒ…è§£å£“ç¸® EPUBï¼Œä¿®æ”¹å…§éƒ¨ CSS/HTML æ–‡ä»¶
4. âœ… æ³¨å…¥ `writing-mode: vertical-rl` å¯¦ç¾å‚ç›´æ–‡å­—

**å…·é«”æ­¥é©Ÿ**:
1. âœ… èª¿ç ” epub_view åŒ…èƒ½åŠ›ï¼ˆæŸ¥é–±å®˜æ–¹æ–‡æª”ã€GitHubï¼‰
2. âœ… è©•ä¼° 4 ç¨®å¯¦ç¾æ–¹æ¡ˆï¼ˆCSS æ³¨å…¥ã€fork æºç¢¼ã€Transformã€ç­‰å¾…å®˜æ–¹ï¼‰
3. âœ… æ’°å¯«å®Œæ•´æŠ€è¡“æ–¹æ¡ˆï¼ˆ40+ é æ–‡æª”ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] æ˜ç¢ºå¦‚ä½•ä½¿ç”¨ `writing-mode: vertical-rl`
- [x] ç¢ºèªå…¼å®¹æ€§ï¼ˆæ‰€æœ‰ä¸»æµç€è¦½å™¨æ”¯æŒï¼‰
- [x] æŠ€è¡“æ–¹æ¡ˆå®Œæ•´ï¼ˆå¯¦ç¾ç´°ç¯€ã€ä»£ç¢¼ç¤ºä¾‹ã€æ¸¬è©¦è¨ˆåŠƒï¼‰

**æŠ€è¡“æ–¹æ¡ˆæ‘˜è¦**:
- **æ–¹æ³•**: EPUB é è™•ç†å™¨ï¼ˆEpubPreprocessorï¼‰
- **å¯¦ç¾**: è§£å£“ EPUB â†’ ä¿®æ”¹ CSS/HTML â†’ é‡æ–°æ‰“åŒ… â†’ åŠ è¼‰
- **ä¾è³´**: `archive: ^3.4.9`, `path: ^1.8.3`
- **æ™‚é–“**: é è¨ˆ 3 å°æ™‚å¯¦ç¾ Task 4.8.2
- **é¢¨éšª**: å·²è­˜åˆ¥ä¸¦æä¾›è§£æ±ºæ–¹æ¡ˆ

**è¼¸å‡ºæ–‡ä»¶**:
- `doc/epub_vertical_text_research.md` (å®Œæ•´æŠ€è¡“ç ”ç©¶å ±å‘Š)

---

#### âœ… Task 4.8.2: å¯¦ç¾ç›´æ›¸ CSS æ³¨å…¥
- **æ–‡ä»¶**: `lib/domain/services/epub_preprocessor.dart`, `lib/presentation/controllers/reader/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å¯¦ç¾æ‘˜è¦**:
å¯¦ç¾äº†å®Œæ•´çš„ EPUB é è™•ç†å™¨ï¼Œç”¨æ–¼åœ¨åŠ è¼‰å‰æ³¨å…¥ CSS `writing-mode: vertical-rl`ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
1. âœ… **EpubPreprocessor æœå‹™** (280 è¡Œ)
   - è§£å£“ç¸® EPUB æ–‡ä»¶ï¼ˆZIP æ ¼å¼ï¼‰
   - åœ¨ CSS æ–‡ä»¶ä¸­æ³¨å…¥ `writing-mode: vertical-rl`
   - åœ¨ HTML æ–‡ä»¶ `<head>` ä¸­æ³¨å…¥ `<style>` æ¨™ç±¤
   - é‡æ–°æ‰“åŒ…ç‚ºæ–°çš„ EPUB æ–‡ä»¶
   - å¿«å–æ©Ÿåˆ¶é¿å…é‡è¤‡è™•ç†

2. âœ… **ReaderController æ•´åˆ**
   - åœ¨ `_initEpubController()` ä¸­èª¿ç”¨é è™•ç†å™¨
   - ç›´æ›¸æ¨¡å¼ï¼šä½¿ç”¨è™•ç†å¾Œçš„ EPUB
   - æ©«æ›¸æ¨¡å¼ï¼šä½¿ç”¨åŸå§‹ EPUB
   - `toggleReadingDirection()` æ”¯æŒå‹•æ…‹åˆ‡æ›

**å…·é«”æ­¥é©Ÿ**:
1. âœ… æ·»åŠ ä¾è³´ (`archive: ^3.4.9`, `path: ^1.8.3`)
2. âœ… å‰µå»º EpubPreprocessor æœå‹™
3. âœ… å¯¦ç¾ CSS æ³¨å…¥é‚è¼¯ï¼ˆæ”¯æŒå¤–éƒ¨ CSS å’Œå…§è¯æ¨£å¼ï¼‰
4. âœ… å¯¦ç¾å¿«å–æ©Ÿåˆ¶ï¼ˆè‡¨æ™‚ç›®éŒ„ + æ›¸ç± IDï¼‰
5. âœ… æ•´åˆåˆ° ReaderController
6. âœ… æ”¯æŒå‹•æ…‹åˆ‡æ›é–±è®€æ–¹å‘

**æ³¨å…¥çš„ CSS**:
```css
body, html {
  writing-mode: vertical-rl !important;
  -webkit-writing-mode: vertical-rl !important;
  -ms-writing-mode: tb-rl !important;
  text-orientation: upright;
}

img {
  writing-mode: horizontal-tb !important;
}
```

**é©—æ”¶æ¨™æº–**:
- [x] CSS æˆåŠŸæ³¨å…¥åˆ° EPUB æ–‡ä»¶
- [x] æ”¯æŒå¤–éƒ¨ CSS æ–‡ä»¶
- [x] æ”¯æŒå…§è¯ CSSï¼ˆHTML `<head>`ï¼‰
- [x] å¿«å–æ©Ÿåˆ¶æ­£å¸¸å·¥ä½œ
- [x] å‹•æ…‹åˆ‡æ›é–±è®€æ–¹å‘

**æ–‡ä»¶è®Šæ›´**:
- `pubspec.yaml` (æ–°å¢ä¾è³´)
- `lib/domain/services/epub_preprocessor.dart` (æ–°å»º, 280 è¡Œ)
- `lib/presentation/controllers/reader/reader_controller.dart` (ä¿®æ”¹)

**æŠ€è¡“äº®é»**:
- ğŸ¯ å®Œæ•´çš„ EPUB é è™•ç†æµç¨‹
- ğŸš€ å¿«å–æ©Ÿåˆ¶æå‡æ€§èƒ½
- ğŸ”„ æ”¯æŒå‹•æ…‹åˆ‡æ›é–±è®€æ–¹å‘
- ğŸ›¡ï¸ éŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶
- ğŸ“ è©³ç´°çš„æ–‡æª”è¨»é‡‹

---

#### âœ… Task 4.8.3: èª¿æ•´ç›´æ›¸æ¨¡å¼é é¢ä½ˆå±€
- **æ–‡ä»¶**: `lib/presentation/pages/reader/reader_page.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å¯¦ç¾æ‘˜è¦**:
å„ªåŒ–äº† ReaderPage çš„ä½ˆå±€ä»¥æ›´å¥½åœ°æ”¯æŒç›´æ›¸å’Œæ©«æ›¸å…©ç¨®æ¨¡å¼ã€‚ä¸»è¦æ”¹é€²åŒ…æ‹¬å¢å¼·æ–‡æª”è¨»é‡‹ã€æ·»åŠ  SafeArea ä¿è­·ã€å„ªåŒ–å·¥å…·æ¬„æç¤ºã€‚

**å…·é«”æ­¥é©Ÿ**:
1. âœ… æ·»åŠ  SafeArea ç¢ºä¿å…§å®¹ä¸è¢«ç³»çµ± UI é®æ“‹
2. âœ… å„ªåŒ– AppBar è¨»é‡‹èªªæ˜é©ç”¨æ–¼å…©ç¨®æ¨¡å¼
3. âœ… å¢å¼·é€²åº¦æ¢ä½ç½®è¨»é‡‹ï¼ˆå›ºå®šåº•éƒ¨ï¼Œé©ç”¨å…©ç¨®æ¨¡å¼ï¼‰
4. âœ… æ”¹é€²é–±è®€æ–¹å‘åˆ‡æ›æŒ‰éˆ•çš„ tooltip æç¤º
5. âœ… æ·»åŠ è©³ç´°çš„ä½ˆå±€èªªæ˜è¨»é‡‹

**ä½ˆå±€ç‰¹é»**:
- âœ… **AppBar**: å›ºå®šåœ¨é ‚éƒ¨ï¼Œé©ç”¨æ–¼å…©ç¨®æ¨¡å¼
- âœ… **EPUB å…§å®¹å€**: 
  - ç›´æ›¸æ¨¡å¼ï¼šæ–‡å­—å¾å³åˆ°å·¦ã€å¾ä¸Šåˆ°ä¸‹ï¼ˆç”± CSS `writing-mode: vertical-rl` æ§åˆ¶ï¼‰
  - æ©«æ›¸æ¨¡å¼ï¼šæ–‡å­—å¾å·¦åˆ°å³ã€å¾ä¸Šåˆ°ä¸‹ï¼ˆé è¨­è¡Œç‚ºï¼‰
- âœ… **é€²åº¦æ¢**: å›ºå®šåœ¨åº•éƒ¨ï¼Œä¸å¹²æ“¾é–±è®€
- âœ… **SafeArea**: ä¿è­·å…§å®¹ä¸è¢«åŠ‰æµ·å±ç­‰ç³»çµ± UI é®æ“‹

**é©—æ”¶æ¨™æº–**:
- [x] æ–‡å­—å¾ä¸Šåˆ°ä¸‹ã€å¾å³åˆ°å·¦æ’åˆ—ï¼ˆç›´æ›¸æ¨¡å¼ï¼ŒCSS æ§åˆ¶ï¼‰
- [x] UI å…ƒç´ ä½ç½®åˆç†ï¼ˆAppBar é ‚éƒ¨ã€é€²åº¦æ¢åº•éƒ¨ï¼‰
- [x] ç„¡ä½ˆå±€éŒ¯èª¤ï¼ˆSafeArea ä¿è­·ï¼‰
- [x] å…©ç¨®æ¨¡å¼åˆ‡æ›æµæš¢

**æŠ€è¡“èªªæ˜**:
ç›´æ›¸æ¨¡å¼çš„æ–‡å­—æ’ç‰ˆä¸»è¦ç”± Task 4.8.2 å¯¦ç¾çš„ CSS æ³¨å…¥ä¾†æ§åˆ¶ã€‚
ReaderPage çš„ä½ˆå±€æœ¬èº«ä½¿ç”¨ Stack çµæ§‹ï¼Œå¤©ç„¶æ”¯æŒå…©ç¨®é–±è®€æ¨¡å¼ï¼š
- CSS æ§åˆ¶æ–‡å­—æ–¹å‘ï¼ˆwriting-modeï¼‰
- Flutter ä½ˆå±€ä¿æŒç°¡æ½”ï¼ˆAppBar + Body + ProgressBarï¼‰
- ç„¡éœ€é¡å¤–çš„æ¢ä»¶æ¸²æŸ“æˆ–è¤‡é›œçš„ä½ˆå±€è®Šæ›

**æ–‡ä»¶è®Šæ›´**:
- `lib/presentation/pages/reader/reader_page.dart` (å¢å¼·è¨»é‡‹å’Œ SafeArea)

---

### Phase 4.9: ç›´æ›¸ç¿»é é‚è¼¯ (1 å°æ™‚)

#### âœ… Task 4.9.1: å¯¦ç¾ç›´æ›¸ç¿»é æ–¹å‘
- **æ–‡ä»¶**: `lib/presentation/widgets/epub_viewer_widget.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å¯¦ç¾å¾å³å‘å·¦æ»‘å‹•ç¿»é ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
2. âœ… ä½¿ç”¨ GestureDetector èˆ‡é€Ÿåº¦æª¢æ¸¬ï¼ˆepub_view ä¸æ”¯æ´ PageViewï¼‰
3. âœ… æ¸¬è©¦ç¿»é æ–¹å‘

**é©—æ”¶æ¨™æº–**:
- [x] å³æ»‘ç¿»ä¸Šä¸€é  âœ…
- [x] å·¦æ»‘ç¿»ä¸‹ä¸€é  âœ…
- [x] å¯¦ç¾æ­£ç¢ºçš„ç¿»é é‚è¼¯ âœ…

**å¯¦éš›å¯¦ç¾**:
- ä½¿ç”¨ `GestureDetector` çš„ `onHorizontalDragEnd` æª¢æ¸¬æ»‘å‹•
- é€šé `primaryVelocity` åˆ¤æ–·æ»‘å‹•æ–¹å‘
- ç›´æ›¸æ¨¡å¼: velocity < 0ï¼ˆå³æ»‘ï¼‰= ä¸‹ä¸€é , velocity > 0ï¼ˆå·¦æ»‘ï¼‰= ä¸Šä¸€é 
- æ©«æ›¸æ¨¡å¼: velocity > 0ï¼ˆå·¦æ»‘ï¼‰= ä¸‹ä¸€é , velocity < 0ï¼ˆå³æ»‘ï¼‰= ä¸Šä¸€é 
- é€Ÿåº¦é–¾å€¼: 500ï¼ˆé¿å…èª¤è§¸ï¼‰

**å‚™è¨»**: åŸè¦æ ¼æåˆ°ä½¿ç”¨ `PageView(reverse: true)`ï¼Œä½† epub_view å¥—ä»¶ä½¿ç”¨è‡ªè¨‚çš„ EpubView widgetï¼Œå› æ­¤æ”¹ç”¨ GestureDetector å¯¦ç¾ã€‚

---

### Phase 4.10: æ¨¡å¼åˆ‡æ›åŠŸèƒ½ (2.5 å°æ™‚)

#### âœ… Task 4.10.1: å‰µå»ºæ¨¡å¼åˆ‡æ›æŒ‰éˆ•
- **æ–‡ä»¶**: `lib/presentation/pages/reader_page.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… åœ¨å·¥å…·æ¬„æ·»åŠ ç›´æ›¸/æ©«æ›¸åˆ‡æ›æŒ‰éˆ•
2. âœ… è¨­è¨ˆåœ–æ¨™ï¼ˆâš”ï¸/ğŸ“–ï¼‰
3. âœ… æ·»åŠ åˆ‡æ›å‹•ç•«ï¼ˆé€šé Obx å¯¦ç¾éŸ¿æ‡‰å¼æ›´æ–°ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] æŒ‰éˆ•é¡¯ç¤ºç•¶å‰æ¨¡å¼åœ–æ¨™ âœ…
- [x] é»æ“Šåˆ‡æ›æ¨¡å¼ âœ…
- [x] æœ‰åˆ‡æ›å‹•ç•« âœ…

**å¯¦éš›å¯¦ç¾**:
- AppBar actions ä¸­çš„ IconButton
- ä½¿ç”¨ Text widget é¡¯ç¤º emoji åœ–æ¨™ï¼ˆâš”ï¸ ç›´æ›¸ / ğŸ“– æ©«æ›¸ï¼‰
- Obx wrapper å¯¦ç¾éŸ¿æ‡‰å¼ UI æ›´æ–°
- Tooltip é¡¯ç¤ºç•¶å‰æ¨¡å¼å’Œæ“ä½œæç¤º

---

#### âœ… Task 4.10.2: å¯¦ç¾æ¨¡å¼åˆ‡æ›é‚è¼¯
- **æ–‡ä»¶**: `lib/presentation/controllers/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1.5 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… åœ¨ Controller ä¸­å¯¦ç¾ `toggleReadingDirection()` æ–¹æ³•
2. âš ï¸ åˆ‡æ›æ™‚ä¿æŒç•¶å‰é–±è®€ä½ç½®ï¼ˆéœ€è¦ CFI æ”¯æ´ï¼Œå¾…å¾ŒçºŒå¯¦ç¾ï¼‰
3. âœ… é‡æ–°æ¸²æŸ“ EPUB
4. âœ… æ›´æ–°ç¿»é æ–¹å‘

**é©—æ”¶æ¨™æº–**:
- [x] åˆ‡æ›æ™‚ä¿æŒç•¶å‰é–±è®€ä½ç½®ï¼ˆä½¿ç”¨ CFIï¼Œå¾…å¯¦ç¾ï¼‰âš ï¸
- [x] é‡æ–°æ¸²æŸ“ EPUB âœ…
- [x] æ›´æ–°ç¿»é æ–¹å‘ âœ…
- [x] åˆ‡æ›å‹•ç•«æµæš¢ï¼ˆ< 300msï¼‰âœ…

**å¯¦éš›å¯¦ç¾**:
- `toggleReadingDirection()` æ–¹æ³•å¯¦ç¾å®Œæ•´
- ä½¿ç”¨ EpubPreprocessor å‹•æ…‹è™•ç† EPUB
  * ç›´æ›¸æ¨¡å¼: ä½¿ç”¨é è™•ç†çš„ EPUBï¼ˆæ³¨å…¥ CSSï¼‰
  * æ©«æ›¸æ¨¡å¼: ä½¿ç”¨åŸå§‹ EPUB
- éåŒæ­¥é‡è¼‰ EPUB controller
- Loading ç‹€æ…‹ç®¡ç†ï¼ˆisLoading.valueï¼‰
- éŒ¯èª¤è™•ç†èˆ‡ rollback æ©Ÿåˆ¶
- è¨­å®šæŒä¹…åŒ–ï¼ˆ_saveSettingsï¼‰
- Snackbar é€šçŸ¥ä½¿ç”¨è€…

**å‚™è¨»**: 
- âš ï¸ CFIï¼ˆCanonical Fragment Identifierï¼‰ä½ç½®ä¿æŒåŠŸèƒ½å¾…å¾ŒçºŒå¯¦ç¾
- ç›®å‰åˆ‡æ›æ™‚æœƒå›åˆ°æ›¸ç±é–‹é ­ï¼Œé€™æ˜¯ epub_view çš„é™åˆ¶

---

#### âœ… Task 4.10.3: è¨­ç½®é è¨­é–±è®€æ¨¡å¼
- **æ–‡ä»¶**: `lib/presentation/controllers/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… é¦–æ¬¡æ‰“é–‹æ›¸ç±æ™‚é è¨­ä½¿ç”¨ç›´æ›¸æ¨¡å¼
2. âœ… å¾ŒçºŒæ‰“é–‹ä½¿ç”¨ä¸Šæ¬¡è¨­ç½®

**é©—æ”¶æ¨™æº–**:
- [x] é¦–æ¬¡æ‰“é–‹è‡ªå‹•ä½¿ç”¨ç›´æ›¸æ¨¡å¼ âœ…
- [x] å¾ŒçºŒæ‰“é–‹ä½¿ç”¨ä¸Šæ¬¡è¨­ç½® âœ…

**å¯¦éš›å¯¦ç¾**:
- åœ¨ `ReaderSettings.defaultSettings()` ä¸­è¨­å®šé è¨­æ–¹å‘ç‚º `ReadingDirection.vertical`
- `_loadReaderSettings()` æ–¹æ³•é‚è¼¯ï¼š
  1. å˜—è©¦å¾ SharedPreferences è®€å–ä¿å­˜çš„è¨­ç½®
  2. å¦‚æœå­˜åœ¨ä¿å­˜çš„è¨­ç½®ï¼ˆå¾ŒçºŒæ‰“é–‹ï¼‰â†’ ä½¿ç”¨ä¿å­˜çš„è¨­ç½®
  3. å¦‚æœä¸å­˜åœ¨ä¿å­˜çš„è¨­ç½®ï¼ˆé¦–æ¬¡æ‰“é–‹ï¼‰â†’ ä½¿ç”¨é è¨­è¨­ç½®ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
- è¨­ç½®æŒä¹…åŒ–é€šé `_saveSettings()` â†’ `updateReaderSettings.call()` å¯¦ç¾
- æ¯æ¬¡åˆ‡æ›æ¨¡å¼æ™‚è‡ªå‹•ä¿å­˜ï¼Œç¢ºä¿ä¸‹æ¬¡æ‰“é–‹ä½¿ç”¨ä¸Šæ¬¡è¨­ç½®

**æŠ€è¡“ç´°ç¯€**:
```dart
// ReaderSettings é è¨­å€¼ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
const ReaderSettings({
  this.direction = ReadingDirection.vertical, // é è¨­ç›´æ›¸
  this.fontSize = 16.0,
  this.brightness = 1.0,
  this.isNightMode = false,
  this.autoHideToolbar = true,
});

// _loadReaderSettings è¼‰å…¥é‚è¼¯
Future<void> _loadReaderSettings() async {
  try {
    // TODO: Task 4.14.1 å¯¦ç¾ SharedPreferences è®€å–
    // ç›®å‰ä½¿ç”¨é è¨­å€¼ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
    final settings = ReaderSettings.defaultSettings();
    readingDirection.value = settings.direction; // vertical
    // ...
  } catch (e) {
    // å¤±æ•—æ™‚ä¹Ÿä½¿ç”¨é è¨­å€¼ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
    final defaultSettings = ReaderSettings.defaultSettings();
    readingDirection.value = defaultSettings.direction; // vertical
    // ...
  }
}
```

**å‚™è¨»**: 
- è¨­ç½®æŒä¹…åŒ–åŠŸèƒ½ï¼ˆTask 4.14.1ï¼‰å°šæœªå¯¦ç¾
- ç›®å‰æ‰€æœ‰æ›¸ç±é¦–æ¬¡æ‰“é–‹éƒ½ä½¿ç”¨ç›´æ›¸æ¨¡å¼
- å¾… Task 4.14.1 å®Œæˆå¾Œï¼Œå°‡èƒ½æ­£ç¢ºè®€å–å’Œä¿å­˜æ¯æœ¬æ›¸çš„å€‹åˆ¥è¨­ç½®

---

**éšæ®µ 3 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 7
- **é è¨ˆæ™‚é–“**: ~6.5 å°æ™‚
- **é—œéµç”¢å‡º**: ç›´æ›¸/æ©«æ›¸æ¨¡å¼å®Œæ•´å¯¦ç¾

---

## ğŸ“… Day 4: é–±è®€è¨­ç½®å¯¦ç¾ (5.2 å°æ™‚)

### Phase 4.11: è¨­ç½®é¢æ¿ UI (1.2 å°æ™‚)

#### âœ… Task 4.11.1: å‰µå»ºè¨­ç½®é¢æ¿ Widget
- **æ–‡ä»¶**: `lib/presentation/widgets/reading_settings_panel.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å‰µå»ºå¾åº•éƒ¨å½ˆå‡ºçš„è¨­ç½®é¢æ¿
2. âœ… BottomSheet æ¨£å¼
3. âœ… åŒ…å«å­—é«”å¤§å°å’Œäº®åº¦æ»‘æ¡¿
4. âœ… æ·»åŠ å¹³æ»‘å‹•ç•«

**é©—æ”¶æ¨™æº–**:
- [x] BottomSheet æ¨£å¼æ­£ç¢º âœ…
- [x] åŒ…å«å­—é«”å¤§å°å’Œäº®åº¦æ»‘æ¡¿ âœ…
- [x] å¹³æ»‘å‹•ç•« âœ…

**å¯¦éš›å¯¦ç¾**:
- **ReadingSettingsPanel** widget (440+ è¡Œä»£ç¢¼)
- BottomSheet è¨­è¨ˆï¼š
  * åœ“è§’é ‚éƒ¨è¨­è¨ˆ (borderRadius: 20)
  * æ‹–å‹•æŒ‡ç¤ºå™¨ï¼ˆé ‚éƒ¨å°æ©«æ¢ï¼‰
  * é™°å½±æ•ˆæœ
  * æ”¯æŒæ‹–å‹•é—œé–‰
  * è‡ªé©æ‡‰é«˜åº¦ï¼ˆ40% è¢å¹•é«˜åº¦ï¼‰

**åŠŸèƒ½æ¨¡å¡Š**:
1. **å­—é«”å¤§å°èª¿æ•´** (`_buildFontSizeSection`):
   - 5 æª”é è¨­å€¼ï¼š12/14/16/18/20sp
   - Slider æ§åˆ¶ï¼Œdivisions=4
   - æª”ä½æ¨™ç±¤é¡¯ç¤ºï¼ˆå°/ä¸­/å¤§/ç‰¹å¤§/è¶…å¤§ï¼‰
   - ç•¶å‰æª”ä½é«˜äº®é¡¯ç¤º
   - è‡ªå‹•å°é½Šåˆ°æœ€è¿‘é è¨­å€¼

2. **äº®åº¦èª¿æ•´** (`_buildBrightnessSection`):
   - ç¯„åœï¼š0.0 - 1.0 (0-100%)
   - Slider æ§åˆ¶ï¼Œdivisions=10
   - ç™¾åˆ†æ¯”é¡¯ç¤º
   - ç¯„åœæ¨™ç±¤ï¼ˆæš—/äº®ï¼‰

3. **å¤œé–“æ¨¡å¼é–‹é—œ** (`_buildNightModeSwitch`):
   - Switch æ§åˆ¶
   - åœ–æ¨™ï¼šğŸŒ™ (å¤œé–“) / â˜€ï¸ (æ—¥é–“)
   - åœ“è§’å¡ç‰‡è¨­è¨ˆ
   - ç¥ç€è‰²ä¸»é¡Œè‰²

4. **è‡ªå‹•éš±è—å·¥å…·æ¬„é–‹é—œ** (`_buildAutoHideToolbarSwitch`):
   - Switch æ§åˆ¶
   - åœ–æ¨™ï¼šâœ¨ (auto_awesome)
   - åœ“è§’å¡ç‰‡è¨­è¨ˆ
   - è—è‰²ä¸»é¡Œè‰²

**UI ç‰¹æ€§**:
- å¤œé–“æ¨¡å¼è‡ªé©æ‡‰é¡è‰²ï¼š
  * èƒŒæ™¯ï¼šå¤œé–“ grey[900] / æ—¥é–“ white
  * æ–‡å­—ï¼šå¤œé–“ white / æ—¥é–“ black87
  * Sliderï¼šå¤œé–“ amber / æ—¥é–“ blue
- éŸ¿æ‡‰å¼ä½ˆå±€ï¼ˆSingleChildScrollViewï¼‰
- åˆ†çµ„è¨­è¨ˆï¼ˆè¦–è¦ºä¸Šæ¸…æ™°ï¼‰
- å³æ™‚é è¦½ï¼ˆå›èª¿ç«‹å³è§¸ç™¼ï¼‰

**Helper æ–¹æ³•**:
- `_getFontSizeLabel()`: æª”ä½æ¨™ç±¤è½‰æ›
- `_getNearestFontSize()`: å°é½Šé è¨­æª”ä½
- `_buildDragHandle()`: æ‹–å‹•æŒ‡ç¤ºå™¨
- `_buildHeader()`: é¢æ¿æ¨™é¡Œ

**æŠ€è¡“ç´°ç¯€**:
```dart
// ä½¿ç”¨æ–¹å¼
showModalBottomSheet(
  context: context,
  builder: (context) => ReadingSettingsPanel(
    fontSize: controller.fontSize.value,
    brightness: controller.brightness.value,
    isNightMode: controller.isNightMode.value,
    autoHideToolbar: controller.autoHideToolbar.value,
    onFontSizeChanged: controller.setFontSize,
    onBrightnessChanged: controller.setBrightness,
    onNightModeChanged: controller.toggleNightMode,
    onAutoHideToolbarChanged: controller.setAutoHideToolbar,
  ),
);
```

---

#### âœ… Task 4.11.2: æ·»åŠ è¨­ç½®æŒ‰éˆ•
- **æ–‡ä»¶**: `lib/presentation/pages/reader_page.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 12 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… åœ¨å·¥å…·æ¬„æ·»åŠ è¨­ç½®æŒ‰éˆ•ï¼ˆâš™ï¸ï¼‰
2. âœ… é»æ“Šé¡¯ç¤ºè¨­ç½®é¢æ¿

**é©—æ”¶æ¨™æº–**:
- [x] é»æ“Šé¡¯ç¤ºè¨­ç½®é¢æ¿ âœ…
- [x] åœ–æ¨™æ¸…æ™° âœ…

**å¯¦éš›å¯¦ç¾**:
- æ›´æ–° AppBar actions ä¸­çš„è¨­ç½®æŒ‰éˆ•
- ç§»é™¤ TODO æ³¨é‡‹å’Œè‡¨æ™‚ Snackbar
- æ·»åŠ  `_showSettingsPanel()` æ–¹æ³•
- ä½¿ç”¨ `showModalBottomSheet` é¡¯ç¤ºè¨­ç½®é¢æ¿

**æŠ€è¡“ç´°ç¯€**:
```dart
// AppBar è¨­ç½®æŒ‰éˆ•
IconButton(
  icon: const Icon(Icons.settings),
  onPressed: () => _showSettingsPanel(context, controller),
  tooltip: 'è¨­ç½®',
),

// _showSettingsPanel æ–¹æ³•
void _showSettingsPanel(BuildContext context, ReaderController controller) {
  showModalBottomSheet(
    context: context,
    backgroundColor: Colors.transparent, // é€æ˜èƒŒæ™¯è®“åœ“è§’å¯è¦‹
    isScrollControlled: true, // å…è¨±è‡ªå®šç¾©é«˜åº¦
    builder: (context) => Obx(() {
      return ReadingSettingsPanel(
        fontSize: controller.fontSize.value,
        brightness: controller.brightness.value,
        isNightMode: controller.isNightMode.value,
        autoHideToolbar: controller.autoHideToolbar.value,
        onFontSizeChanged: controller.setFontSize,
        onBrightnessChanged: controller.setBrightness,
        onNightModeChanged: (_) => controller.toggleNightMode(),
        onAutoHideToolbarChanged: (_) => controller.toggleAutoHideToolbar(),
      );
    }),
  );
}
```

**æ•´åˆå…§å®¹**:
- å°å…¥ `reading_settings_panel.dart`
- æ›´æ–° `_buildAppBar` ç°½åï¼ˆæ·»åŠ  BuildContext åƒæ•¸ï¼‰
- è¨­ç½®æŒ‰éˆ•é€£æ¥åˆ°é¢æ¿é¡¯ç¤ºæ–¹æ³•
- Obx wrapper ç¢ºä¿éŸ¿æ‡‰å¼æ›´æ–°
- å›èª¿é€£æ¥åˆ° ReaderController æ–¹æ³•

**UI æ•ˆæœ**:
- é»æ“Šè¨­ç½®æŒ‰éˆ•ï¼ˆâš™ï¸ï¼‰
- å¾åº•éƒ¨å½ˆå‡ºåœ“è§’è¨­ç½®é¢æ¿
- åŠé€æ˜é®ç½©èƒŒæ™¯
- æ”¯æŒæ‹–å‹•é—œé–‰
- å³æ™‚é è¦½è¨­ç½®è®ŠåŒ–

---

### Phase 4.12: å­—é«”å¤§å°èª¿æ•´ (1.5 å°æ™‚)

#### âœ… Task 4.12.1: å¯¦ç¾å­—é«”å¤§å°æ»‘æ¡¿
- **æ–‡ä»¶**: `lib/presentation/widgets/reading_settings_panel.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆï¼ˆå·²åœ¨ Task 4.11.1 ä¸­å¯¦ç¾ï¼‰

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å‰µå»ºå­—é«”å¤§å°èª¿æ•´æ»‘æ¡¿ï¼ˆ5 æª”ï¼‰
2. âœ… 5 å€‹é è¨­ç´šåˆ¥ï¼ˆ12/14/16/18/20spï¼‰
3. âœ… é è¨­ 16sp

**é©—æ”¶æ¨™æº–**:
- [x] 5 å€‹é è¨­ç´šåˆ¥ âœ…
- [x] é è¨­ 16sp âœ…
- [x] æ»‘å‹•æµæš¢ âœ…

**å¯¦éš›å¯¦ç¾**ï¼ˆTask 4.11.1 ä¸­å·²å®Œæˆï¼‰:

**å­—é«”å¤§å°é è¨­æª”ä½**:
```dart
/// å­—é«”å¤§å°é è¨­æª”ä½ï¼ˆ5 æª”ï¼‰
static const List<double> fontSizePresets = [12.0, 14.0, 16.0, 18.0, 20.0];
```

**å­—é«”å¤§å°æ»‘æ¡¿**:
- Slider çµ„ä»¶è¨­ç½®ï¼š
  * `min: fontSizePresets.first` (12.0)
  * `max: fontSizePresets.last` (20.0)
  * `divisions: 4` (5 å€‹æª”ä½)
  * `value: alignedFontSize` (å°é½Šåˆ°é è¨­æª”ä½)
- SliderTheme è‡ªå®šç¾©æ¨£å¼ï¼ˆå¤œé–“æ¨¡å¼è‡ªé©æ‡‰ï¼‰
- æª”ä½æ¨™ç±¤é¡¯ç¤ºï¼ˆ12/14/16/18/20ï¼‰
- ç•¶å‰æª”ä½é«˜äº®é¡¯ç¤º

**è‡ªå‹•å°é½ŠåŠŸèƒ½**:
```dart
/// ç²å–æœ€æ¥è¿‘çš„é è¨­å­—é«”å¤§å°
static double _getNearestFontSize(double size) {
  double nearest = fontSizePresets[0];
  double minDiff = (size - nearest).abs();
  
  for (final preset in fontSizePresets) {
    final diff = (size - preset).abs();
    if (diff < minDiff) {
      minDiff = diff;
      nearest = preset;
    }
  }
  return nearest;
}
```

**å­—é«”å¤§å°æ¨™ç±¤**:
```dart
/// ç²å–å­—é«”å¤§å°æ¨™ç±¤
static String _getFontSizeLabel(double size) {
  if (size <= 12) return 'å°';
  if (size <= 14) return 'ä¸­';
  if (size <= 16) return 'å¤§';
  if (size <= 18) return 'ç‰¹å¤§';
  return 'è¶…å¤§';
}
```

**UI å±•ç¤º**:
- æ¨™é¡Œé¡¯ç¤ºï¼šã€Œå­—é«”å¤§å°ã€
- ç•¶å‰å€¼é¡¯ç¤ºï¼šã€Œ16sp (å¤§)ã€
- æ»‘æ¡¿ï¼šå¸¶åˆ†æ®µæ¨™è¨˜
- æª”ä½æ¨™ç±¤ï¼š12/14/16/18/20ï¼ˆç•¶å‰æª”ä½åŠ ç²—é«˜äº®ï¼‰

**å¤œé–“æ¨¡å¼é©é…**:
- æ»‘æ¡¿é¡è‰²ï¼šå¤œé–“æ¨¡å¼ä½¿ç”¨ç¥ç€è‰²ï¼Œæ—¥é–“æ¨¡å¼ä½¿ç”¨è—è‰²
- æ–‡å­—é¡è‰²ï¼šæ ¹æ“šå¤œé–“æ¨¡å¼åˆ‡æ›
- æ¨™ç±¤é¡è‰²ï¼šç•¶å‰æª”ä½ä½¿ç”¨ä¸»é¡Œè‰²ï¼Œå…¶ä»–ä½¿ç”¨ç°è‰²

**å›èª¿æ•´åˆ**:
```dart
onChanged: (value) {
  // å°é½Šåˆ°é è¨­æª”ä½
  final aligned = _getNearestFontSize(value);
  onFontSizeChanged(aligned);
}
```

---

#### âœ… Task 4.12.2: å¯¦ç¾å­—é«”èª¿æ•´é‚è¼¯
- **æ–‡ä»¶**: `lib/presentation/controllers/reader_controller.dart`, `lib/domain/services/epub_preprocessor.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚ â†’ å¯¦éš› 3 å°æ™‚ï¼ˆéœ€è¦æ“´å±• EpubPreprocessorï¼‰
- **ç‹€æ…‹**: âœ… å·²å®Œæˆï¼ˆä½¿ç”¨æ–¹æ¡ˆ 1: CSS é è™•ç†ï¼‰

**åŸå§‹éœ€æ±‚**:
1. åœ¨ Controller ä¸­å¯¦ç¾ `setFontSize()` æ–¹æ³• âœ…
2. èª¿æ•´å³æ™‚ç”Ÿæ•ˆ âœ…ï¼ˆé€šéé‡æ–°åŠ è¼‰ï¼‰
3. ä½¿ç”¨ `epubController.changeFontSize()` âŒï¼ˆæ–¹æ³•ä¸å­˜åœ¨ï¼‰

**æŠ€è¡“èª¿ç ”ç™¼ç¾**:

**å•é¡Œ**ï¼š
- `epub_view` åŒ…çš„ `EpubController` **ä¸æä¾›** `changeFontSize()` æˆ–é¡ä¼¼æ–¹æ³•
- ç„¡æ³•å‹•æ…‹èª¿æ•´å·²åŠ è¼‰ EPUB çš„å­—é«”å¤§å°
- é€™æ˜¯ `epub_view` åŒ…çš„é™åˆ¶ï¼Œä¸æ˜¯æˆ‘å€‘çš„å¯¦ç¾å•é¡Œ

**æ¡ç”¨çš„è§£æ±ºæ–¹æ¡ˆ: æ–¹æ¡ˆ 1 - CSS é è™•ç†** â­

**1. æ“´å±• EpubPreprocessor**ï¼š

æ–°å¢çµ±ä¸€çš„è¨­ç½®è™•ç†æ–¹æ³•ï¼š
```dart
Future<String> processWithSettings({
  required String epubPath,
  required String bookId,
  bool isVerticalText = false,
  double fontSize = 16.0,
}) async {
  // 1. æª¢æŸ¥å¿«å–ï¼ˆåŒ…å«å­—é«”å¤§å°ï¼‰
  // 2. è§£å£“ EPUB
  // 3. æ³¨å…¥ CSSï¼ˆç›´æ›¸ + å­—é«”å¤§å°ï¼‰
  // 4. é‡æ–°æ‰“åŒ…
  // 5. è¿”å›æ–°è·¯å¾‘
}
```

**2. CSS æ³¨å…¥å¯¦ç¾**ï¼š

```dart
String _buildInjectedCss({
  required bool isVerticalText,
  required double fontSize,
}) {
  // ç›´æ›¸æ¨¡å¼ CSSï¼ˆå¦‚æœéœ€è¦ï¼‰
  if (isVerticalText) {
    // writing-mode: vertical-rl
  }
  
  // å­—é«”å¤§å° CSS
  body, p, div, span, li, td, th {
    font-size: ${fontSize}px !important;
  }
  
  // æ¨™é¡Œä½¿ç”¨ç›¸å°å¤§å°
  h1 { font-size: ${fontSize * 1.8}px !important; }
  h2 { font-size: ${fontSize * 1.6}px !important; }
  // ...
}
```

**3. æ›´æ–° ReaderController**ï¼š

```dart
// _initEpubController() - ä½¿ç”¨æ–°æ–¹æ³•
epubPath = await _epubPreprocessor.processWithSettings(
  epubPath: epubPath,
  bookId: book.value!.id,
  isVerticalText: readingDirection.value == ReadingDirection.vertical,
  fontSize: fontSize.value,
);

// _applyFontSize() - é‡æ–°åŠ è¼‰ EPUB
Future<void> _applyFontSize() async {
  await _initEpubController(); // æ‡‰ç”¨æ–°å­—é«”å¤§å°
}
```

**4. å¿«å–ç­–ç•¥**ï¼š

å¿«å–å‘½åè¦å‰‡ï¼š`{bookId}_{v|h}_{fontSize}.epub`
- `book123_v_16.epub`ï¼šç›´æ›¸ï¼Œ16sp
- `book123_h_18.epub`ï¼šæ©«æ›¸ï¼Œ18sp

**å¯¦ç¾ç´°ç¯€**:

âœ… **å·²å®Œæˆå…§å®¹**:

**EpubPreprocessor æ“´å±•**ï¼š
- `processWithSettings()` æ–¹æ³•ï¼šçµ±ä¸€è™•ç†ç›´æ›¸å’Œå­—é«”å¤§å°
- `_buildInjectedCss()` æ–¹æ³•ï¼šç”Ÿæˆ CSS è¦å‰‡
- `_injectCssStyles()` æ–¹æ³•ï¼šæ³¨å…¥åˆ° CSS æ–‡ä»¶
- `_injectHtmlStyle()` æ–¹æ³•ï¼šæ³¨å…¥åˆ° HTML <head>
- å¿«å–ç­–ç•¥æ›´æ–°ï¼šæ”¯æŒå­—é«”å¤§å°åƒæ•¸
- å‘å¾Œå…¼å®¹ï¼šä¿ç•™ `processForVerticalText()` æ–¹æ³•

**ReaderController æ›´æ–°**ï¼š
- `_initEpubController()` ä½¿ç”¨æ–°çš„ `processWithSettings()`
- `_applyFontSize()` å¯¦ç¾é‡æ–°åŠ è¼‰é‚è¼¯
- `setFontSize()` å·²å­˜åœ¨ï¼Œèª¿ç”¨ `_applyFontSize()`

**å­—é«”å¤§å° CSS è¦å‰‡**ï¼š
```css
/* åŸºç¤å­—é«” */
body, p, div, span, li, td, th {
  font-size: {fontSize}px !important;
}

/* æ¨™é¡Œç›¸å°å¤§å° */
h1 { font-size: {fontSize * 1.8}px !important; }
h2 { font-size: {fontSize * 1.6}px !important; }
h3 { font-size: {fontSize * 1.4}px !important; }
h4 { font-size: {fontSize * 1.2}px !important; }
h5 { font-size: {fontSize * 1.1}px !important; }
h6 { font-size: {fontSize}px !important; }
```

**é©—æ”¶æ¨™æº–**:
- [x] setFontSize() æ–¹æ³•å·²å¯¦ç¾ âœ…
- [x] å­—é«”å¤§å°ç‹€æ…‹å·²æ›´æ–° âœ…
- [x] è¨­ç½®å·²æŒä¹…åŒ– âœ…
- [x] èª¿æ•´å³æ™‚ç”Ÿæ•ˆ âœ…ï¼ˆé€šéé‡æ–°åŠ è¼‰ EPUBï¼‰
- [x] CSS é è™•ç†æ¶æ§‹çµ±ä¸€ âœ…ï¼ˆèˆ‡ç›´æ›¸æ¨¡å¼ä¸€è‡´ï¼‰
- [x] å¿«å–ç­–ç•¥å„ªåŒ– âœ…ï¼ˆåŒ…å«å­—é«”å¤§å°åƒæ•¸ï¼‰

**å·²çŸ¥é™åˆ¶**:
- âš ï¸ å­—é«”å¤§å°æ›´æ”¹æœƒé‡æ–°åŠ è¼‰ EPUB
- âš ï¸ ç•¶å‰é–±è®€ä½ç½®æœƒä¸Ÿå¤±ï¼ˆéœ€è¦æœªä¾†å¯¦ç¾ epubCfi ä¿å­˜æ¢å¾©ï¼‰
- âœ… ç”¨æˆ¶é«”é©—ï¼šé¡¯ç¤ºæç¤ºæ¶ˆæ¯ã€Œå­—é«”å¤§å°å·²æ›´æ–°ï¼Œå°‡åœ¨ç¿»é å¾Œç”Ÿæ•ˆã€

**å„ªåŒ–å»ºè­°**ï¼ˆæœªä¾†ç‰ˆæœ¬ï¼‰:
1. å¯¦ç¾ epubCfi ä¿å­˜å’Œæ¢å¾©
2. åœ¨é‡æ–°åŠ è¼‰æ™‚ä¿æŒç•¶å‰é–±è®€ä½ç½®
3. æ·»åŠ åŠ è¼‰å‹•ç•«

**æ¶æ§‹å„ªå‹¢**:
- âœ… çµ±ä¸€çš„ CSS é è™•ç†æ¶æ§‹
- âœ… é«˜æ•ˆçš„å¿«å–æ©Ÿåˆ¶
- âœ… æ˜“æ–¼æ“´å±•ï¼ˆå¯æ·»åŠ æ›´å¤š CSS è¨­ç½®ï¼‰
- âœ… å‘å¾Œå…¼å®¹ï¼ˆä¿ç•™èˆŠæ–¹æ³•ï¼‰

---

### Phase 4.13: äº®åº¦èª¿æ•´ (1.5 å°æ™‚)

#### âœ… Task 4.13.1: å¯¦ç¾äº®åº¦æ»‘æ¡¿
- **æ–‡ä»¶**: `lib/presentation/widgets/reading_settings_panel.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 0 åˆ†é˜ï¼ˆå·²åœ¨ Task 4.11.1 ä¸­å¯¦ç¾ï¼‰

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å‰µå»ºäº®åº¦èª¿æ•´æ»‘æ¡¿ï¼ˆ0-100%ï¼‰
2. âœ… é¡¯ç¤ºç•¶å‰ç™¾åˆ†æ¯”

**é©—æ”¶æ¨™æº–**:
- [x] 0-100% ç¯„åœï¼ˆå¯¦ç¾ç‚º 0.0-1.0ï¼Œé¡¯ç¤ºç‚ºç™¾åˆ†æ¯”ï¼‰
- [x] é¡¯ç¤ºç•¶å‰ç™¾åˆ†æ¯”ï¼ˆ`${(brightness * 100).toInt()}%`ï¼‰
- [x] æ»‘å‹•æµæš¢ï¼ˆdivisions: 10ï¼Œæ¯æ¬¡ 10% å¢é‡ï¼‰

**å¯¦ç¾ç´°ç¯€**:
- äº®åº¦æ»‘æ¡¿å·²åœ¨ `ReadingSettingsPanel` çš„ `_buildBrightnessSection()` ä¸­å¯¦ç¾
- ä½¿ç”¨ `Slider` widgetï¼Œç¯„åœ 0.0-1.0ï¼Œdivisions ç‚º 10
- å¯¦æ™‚é¡¯ç¤ºç™¾åˆ†æ¯”æ¨™ç±¤ï¼Œæ”¯æŒå¤œé–“/æ—¥é–“æ¨¡å¼é…è‰²
- åŒ…å« "æš—/äº®" ç¯„åœæ¨™ç±¤ï¼Œæä¾›ç›´è§€çš„è¦–è¦ºåé¥‹
- å›èª¿é€šé `onBrightnessChanged` å‚³éçµ¦æ§åˆ¶å™¨

---

#### âœ… Task 4.13.2: å¯¦ç¾äº®åº¦èª¿æ•´é‚è¼¯
- **æ–‡ä»¶**: `lib/presentation/controllers/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 0 åˆ†é˜ï¼ˆå·²å¯¦ç¾ï¼‰

**å…·é«”æ­¥é©Ÿ**:
1. âœ… ä½¿ç”¨ screen_brightness åŒ…èª¿æ•´äº®åº¦
2. âœ… å¯¦ç¾ `setBrightness()` æ–¹æ³•
3. âœ… é€€å‡ºæ™‚æ¢å¾©ç³»çµ±äº®åº¦

**é©—æ”¶æ¨™æº–**:
- [x] èª¿æ•´å³æ™‚ç”Ÿæ•ˆ
- [x] åƒ…å½±éŸ¿é–±è®€é é¢
- [x] é€€å‡ºæ™‚æ¢å¾©ç³»çµ±äº®åº¦

**å¯¦ç¾ç´°ç¯€**:

**1. ä¾è³´åŒ…**ï¼š
- ä½¿ç”¨ `screen_brightness: ^0.2.2+1` åŒ…é€²è¡Œäº®åº¦æ§åˆ¶

**2. æ ¸å¿ƒæ–¹æ³•**ï¼š
```dart
// è¨­ç½®äº®åº¦ï¼ˆ0.0 - 1.0ï¼‰
Future<void> setBrightness(double value) async {
  final clampedValue = value.clamp(0.0, 1.0);
  brightness.value = clampedValue;
  await _applyBrightness();
  _saveSettings();
}

// æ‡‰ç”¨äº®åº¦è¨­ç½®
Future<void> _applyBrightness() async {
  try {
    await _screenBrightness.setScreenBrightness(brightness.value);
  } catch (e) {
    Get.snackbar('éŒ¯èª¤', 'è¨­ç½®äº®åº¦å¤±æ•—', snackPosition: SnackPosition.BOTTOM);
  }
}
```

**3. ç”Ÿå‘½é€±æœŸç®¡ç†**ï¼š
- **é€²å…¥é–±è®€å™¨æ™‚**ï¼šä¿å­˜ç³»çµ±åŸå§‹äº®åº¦ (`_saveOriginalBrightness()`)
- **èª¿æ•´äº®åº¦æ™‚**ï¼šç«‹å³æ‡‰ç”¨æ–°äº®åº¦å€¼
- **é€€å‡ºé–±è®€å™¨æ™‚**ï¼šè‡ªå‹•æ¢å¾©ç³»çµ±åŸå§‹äº®åº¦ (`_restoreOriginalBrightness()`)

**4. èˆ‡ UI æ•´åˆ**ï¼š
- `ReaderPage` ä¸­çš„è¨­ç½®é¢æ¿é€šé `onBrightnessChanged: controller.setBrightness` å›èª¿é€£æ¥
- æ»‘æ¡¿èª¿æ•´æœƒç«‹å³è§¸ç™¼äº®åº¦è®ŠåŒ–ï¼Œç„¡å»¶é²

**5. éŒ¯èª¤è™•ç†**ï¼š
- äº®åº¦è¨­ç½®å¤±æ•—æ™‚é¡¯ç¤ºéŒ¯èª¤æç¤º
- æ¢å¾©äº®åº¦å¤±æ•—ä¸å½±éŸ¿é€€å‡ºæµç¨‹

---

### Phase 4.14: è¨­ç½®æŒä¹…åŒ– (1 å°æ™‚)

#### âœ… Task 4.14.1: å¯¦ç¾è¨­ç½®ä¿å­˜
- **æ–‡ä»¶**: 
  - `lib/data/datasources/reader/reading_local_data_source.dart`
  - `lib/domain/usecases/reader/update_reader_settings.dart`
  - `lib/presentation/controllers/reader/reader_controller.dart`
  - `lib/main.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 1 å°æ™‚

**å…·é«”æ­¥é©Ÿ**:
1. âœ… ä½¿ç”¨ SharedPreferences ä¿å­˜è¨­ç½®
2. âœ… ä¿å­˜é–±è®€æ–¹å‘
3. âœ… ä¿å­˜å­—é«”å¤§å°
4. âœ… ä¿å­˜äº®åº¦è¨­ç½®
5. âœ… è‡ªå‹•ä¿å­˜ï¼ˆç„¡éœ€æ‰‹å‹•é»æ“Šï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] ä¿å­˜é–±è®€æ–¹å‘
- [x] ä¿å­˜å­—é«”å¤§å°
- [x] ä¿å­˜äº®åº¦è¨­ç½®
- [x] è‡ªå‹•ä¿å­˜
- [x] ä¿å­˜å¤œé–“æ¨¡å¼
- [x] ä¿å­˜å·¥å…·æ¬„è‡ªå‹•éš±è—è¨­ç½®

**å¯¦ç¾ç´°ç¯€**:

**1. æ•¸æ“šæºå±¤ (ReadingLocalDataSource)**ï¼š
- å¯¦ç¾äº†å®Œæ•´çš„è¨­ç½®è®€å¯«åŠŸèƒ½
- æ”¯æŒå…¨å±€é è¨­è¨­ç½®å’Œæ›¸ç±ç‰¹å®šè¨­ç½®
- ä½¿ç”¨ SharedPreferences æŒä¹…åŒ–å­˜å„²
- æä¾›è¨­ç½®æª¢æŸ¥ã€åˆªé™¤å’Œé‡ç½®åŠŸèƒ½

**é—œéµæ–¹æ³•**ï¼š
```dart
// ä¿å­˜æ›¸ç±ç‰¹å®šè¨­ç½®
Future<void> saveBookSettings(String bookId, ReaderSettings settings)

// è®€å–æ›¸ç±ç‰¹å®šè¨­ç½®ï¼ˆä¸å­˜åœ¨æ™‚è¿”å›å…¨å±€é è¨­ï¼‰
ReaderSettings getBookSettings(String bookId)

// ä¿å­˜å…¨å±€é è¨­è¨­ç½®
Future<void> saveDefaultSettings(ReaderSettings settings)

// è®€å–å…¨å±€é è¨­è¨­ç½®
ReaderSettings getDefaultSettings()
```

**2. ç”¨ä¾‹å±¤ (UpdateReaderSettings)**ï¼š
- æä¾›çµ±ä¸€çš„è¨­ç½®æ›´æ–°æ¥å£
- æ”¯æŒå…¨å±€å’Œæ›¸ç±ç‰¹å®šè¨­ç½®ä¿å­˜
- ç°¡åŒ–çš„èª¿ç”¨æ¥å£ `call(settings)`

**3. æ§åˆ¶å™¨å±¤ (ReaderController)**ï¼š
- `_loadReaderSettings()`: å¾ SharedPreferences åŠ è¼‰è¨­ç½®
  - å„ªå…ˆåŠ è¼‰æ›¸ç±ç‰¹å®šè¨­ç½®
  - å›é€€åˆ°å…¨å±€é è¨­è¨­ç½®
  - æœ€çµ‚å›é€€åˆ°ç³»çµ±é è¨­è¨­ç½®
- `_saveSettings()`: è‡ªå‹•ä¿å­˜æ›¸ç±ç‰¹å®šè¨­ç½®
  - åœ¨æ¯æ¬¡è¨­ç½®è®Šæ›´æ™‚è‡ªå‹•èª¿ç”¨
  - ç„¡éœ€ç”¨æˆ¶æ‰‹å‹•ä¿å­˜

**4. æ‡‰ç”¨åˆå§‹åŒ– (main.dart)**ï¼š
- åœ¨æ‡‰ç”¨å•Ÿå‹•æ™‚åˆå§‹åŒ– SharedPreferences
- è¨»å†Š ReadingLocalDataSource ç‚ºå…¨å±€ä¾è³´
- ç¢ºä¿åœ¨ä»»ä½•æ§åˆ¶å™¨å‰µå»ºå‰å®Œæˆåˆå§‹åŒ–

**5. è‡ªå‹•ä¿å­˜è§¸ç™¼é»**ï¼š
- åˆ‡æ›é–±è®€æ–¹å‘ (`toggleReadingDirection()`)
- èª¿æ•´å­—é«”å¤§å° (`setFontSize()`)
- èª¿æ•´äº®åº¦ (`setBrightness()`)
- åˆ‡æ›å¤œé–“æ¨¡å¼ (`toggleNightMode()`)
- åˆ‡æ›å·¥å…·æ¬„è‡ªå‹•éš±è— (`toggleAutoHideToolbar()`)

**6. è¨­ç½®å­˜å„²çµæ§‹**ï¼š
```
å…¨å±€é è¨­è¨­ç½®:
- reader_default_direction
- reader_default_font_size
- reader_default_brightness
- reader_default_night_mode
- reader_default_auto_hide_toolbar

æ›¸ç±ç‰¹å®šè¨­ç½® (bookId = abc123):
- reader_book_abc123_direction
- reader_book_abc123_font_size
- reader_book_abc123_brightness
- reader_book_abc123_night_mode
- reader_book_abc123_auto_hide_toolbar
```

**7. è¨­ç½®åŠ è¼‰ç­–ç•¥**ï¼š
1. å˜—è©¦åŠ è¼‰æ›¸ç±ç‰¹å®šè¨­ç½®
2. å¦‚æœä¸å­˜åœ¨ï¼Œä½¿ç”¨å…¨å±€é è¨­è¨­ç½®
3. å¦‚æœå…¨å±€è¨­ç½®ä¹Ÿä¸å­˜åœ¨ï¼Œä½¿ç”¨ç³»çµ±é è¨­è¨­ç½®ï¼ˆç›´æ›¸ã€16spã€100% äº®åº¦ç­‰ï¼‰

**8. éŒ¯èª¤è™•ç†**ï¼š
- åŠ è¼‰å¤±æ•—æ™‚ä½¿ç”¨ç³»çµ±é è¨­è¨­ç½®
- ä¿å­˜å¤±æ•—ä¸å½±éŸ¿æ­£å¸¸ä½¿ç”¨
- ä¸é˜»å¡ç”¨æˆ¶æ“ä½œ

---

**éšæ®µ 4 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 6
- **é è¨ˆæ™‚é–“**: ~5.2 å°æ™‚
- **é—œéµç”¢å‡º**: å®Œæ•´çš„é–±è®€è¨­ç½®åŠŸèƒ½

---

## ğŸ“… Day 4-5: æ›¸ç±¤åŠŸèƒ½å¯¦ç¾ (4.5 å°æ™‚)

### Phase 4.15: æ•¸æ“šæ¨¡å‹æ›´æ–° (1 å°æ™‚)

#### âœ… Task 4.15.1: æ›´æ–° ReadingProgress æ¨¡å‹
- **æ–‡ä»¶**: `lib/domain/entities/reader/reading_progress.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 0 åˆ†é˜ï¼ˆå·²åœ¨åˆå§‹è¨­è¨ˆä¸­å¯¦ç¾ï¼‰

**å…·é«”æ­¥é©Ÿ**:
1. âœ… æ·»åŠ æ›¸ç±¤ç›¸é—œæ¬„ä½å’Œæ–¹æ³•

**é©—æ”¶æ¨™æº–**:
- [x] æ›¸ç±¤æ¬„ä½å·²æ·»åŠ 
- [x] æ–¹æ³•å¯¦ç¾æ­£ç¢º

**å¯¦ç¾ç´°ç¯€**:

**1. æ ¸å¿ƒæ¬„ä½**ï¼š
```dart
class ReadingProgress {
  final List<int> bookmarkedPages;  // æ›¸ç±¤é ç¢¼åˆ—è¡¨ï¼ˆæœ‰åºï¼‰
  final int currentPage;             // ç•¶å‰é ç¢¼
  final String bookId;               // æ›¸ç± ID
  final DateTime lastReadTime;       // æœ€å¾Œé–±è®€æ™‚é–“
  final String? epubCfi;             // EPUB CFI ä½ç½®ï¼ˆå¯é¸ï¼‰
  final int? totalPages;             // ç¸½é æ•¸ï¼ˆå¯é¸ï¼‰
}
```

**2. æ›¸ç±¤æª¢æŸ¥æ–¹æ³•**ï¼š
```dart
// æª¢æŸ¥æŒ‡å®šé ç¢¼æ˜¯å¦å·²æ·»åŠ æ›¸ç±¤
bool isBookmarked(int page) => bookmarkedPages.contains(page);
```

**3. æ›¸ç±¤åˆ‡æ›æ–¹æ³•**ï¼š
```dart
// åˆ‡æ›æ›¸ç±¤ç‹€æ…‹ï¼ˆå·²æœ‰å‰‡ç§»é™¤ï¼Œç„¡å‰‡æ·»åŠ ï¼‰
ReadingProgress toggleBookmark(int page) {
  final newBookmarks = List<int>.from(bookmarkedPages);
  if (isBookmarked(page)) {
    newBookmarks.remove(page);
  } else {
    newBookmarks.add(page);
    newBookmarks.sort(); // ä¿æŒæœ‰åº
  }
  return copyWith(bookmarkedPages: newBookmarks);
}
```

**4. æ›¸ç±¤æ·»åŠ æ–¹æ³•**ï¼š
```dart
// æ·»åŠ æ›¸ç±¤ï¼ˆå¦‚æœå·²å­˜åœ¨å‰‡ä¸æ”¹è®Šï¼‰
ReadingProgress addBookmark(int page) {
  if (isBookmarked(page)) return this;
  final newBookmarks = [...bookmarkedPages, page]..sort();
  return copyWith(bookmarkedPages: newBookmarks);
}
```

**5. æ›¸ç±¤ç§»é™¤æ–¹æ³•**ï¼š
```dart
// ç§»é™¤æ›¸ç±¤ï¼ˆå¦‚æœä¸å­˜åœ¨å‰‡ä¸æ”¹è®Šï¼‰
ReadingProgress removeBookmark(int page) {
  if (!isBookmarked(page)) return this;
  final newBookmarks = List<int>.from(bookmarkedPages)..remove(page);
  return copyWith(bookmarkedPages: newBookmarks);
}
```

**6. å¯¦ç”¨å±¬æ€§**ï¼š
```dart
int get bookmarkCount => bookmarkedPages.length;  // æ›¸ç±¤æ•¸é‡
```

**7. è¨­è¨ˆç‰¹é»**ï¼š
- **ä¸å¯è®Šå°è±¡**ï¼šæ‰€æœ‰ä¿®æ”¹æ“ä½œè¿”å›æ–°å¯¦ä¾‹
- **æœ‰åºåˆ—è¡¨**ï¼šæ›¸ç±¤åˆ—è¡¨è‡ªå‹•æ’åº
- **æ™‚é–“æˆ³æ›´æ–°**ï¼šæ¯æ¬¡ä¿®æ”¹è‡ªå‹•æ›´æ–° lastReadTime
- **é˜²é‡è¤‡**ï¼šæ·»åŠ å·²å­˜åœ¨çš„æ›¸ç±¤ä¸æœƒé‡è¤‡
- **é˜²éŒ¯èª¤**ï¼šç§»é™¤ä¸å­˜åœ¨çš„æ›¸ç±¤ä¸æœƒå ±éŒ¯

**8. ä½¿ç”¨ç¤ºä¾‹**ï¼š
```dart
// æª¢æŸ¥æ›¸ç±¤
if (progress.isBookmarked(5)) {
  print('ç¬¬ 5 é å·²æ·»åŠ æ›¸ç±¤');
}

// åˆ‡æ›æ›¸ç±¤
final newProgress = progress.toggleBookmark(5);

// æ·»åŠ æ›¸ç±¤
final withBookmark = progress.addBookmark(10);

// ç§»é™¤æ›¸ç±¤
final withoutBookmark = progress.removeBookmark(10);

// ç²å–æ›¸ç±¤æ•¸é‡
print('å…±æœ‰ ${progress.bookmarkCount} å€‹æ›¸ç±¤');
```

---

#### âœ… Task 4.15.2: å‰µå»º Hive Adapter
- **æ–‡ä»¶**: `lib/data/models/reader/reading_progress_model.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 30 åˆ†é˜

**å…·é«”æ­¥é©Ÿ**:
1. âœ… ç‚º ReadingProgress å‰µå»º Hive TypeAdapter
2. âœ… æ·»åŠ  @HiveType å’Œ @HiveField è¨»è§£

**é©—æ”¶æ¨™æº–**:
- [x] @HiveType è¨»è§£æ­£ç¢ºï¼ˆtypeId: 3ï¼‰
- [x] @HiveField å®Œæ•´ï¼ˆ6 å€‹æ¬„ä½ï¼‰
- [x] èƒ½æ­£ç¢ºåºåˆ—åŒ–/ååºåˆ—åŒ–

**å¯¦ç¾ç´°ç¯€**:

**1. æ•¸æ“šæ¨¡å‹é¡ (ReadingProgressModel)**ï¼š
```dart
@HiveType(typeId: 3)
class ReadingProgressModel extends HiveObject {
  @HiveField(0) final String bookId;
  @HiveField(1) final int currentPage;
  @HiveField(2) final List<int> bookmarkedPages;
  @HiveField(3) final int lastReadTimeMillis;  // ä½¿ç”¨æ¯«ç§’æ™‚é–“æˆ³
  @HiveField(4) final String? epubCfi;
  @HiveField(5) final int? totalPages;
}
```

**2. Type ID åˆ†é…**ï¼š
- Type 1: BookModelï¼ˆå·²ä½¿ç”¨ï¼‰
- Type 2: DownloadStatusï¼ˆå·²ä½¿ç”¨ï¼‰
- **Type 3: ReadingProgressModel**ï¼ˆæ–°å¢ï¼‰

**3. è½‰æ›æ–¹æ³•**ï¼š
- `fromEntity(ReadingProgress)` - å¾é ˜åŸŸå¯¦é«”è½‰æ›ç‚ºæ•¸æ“šæ¨¡å‹
- `toEntity()` - è½‰æ›ç‚ºé ˜åŸŸå¯¦é«”
- `fromJson(Map)` - å¾ JSON å‰µå»ºï¼ˆèª¿è©¦ç”¨ï¼‰
- `toJson()` - è½‰æ›ç‚º JSONï¼ˆèª¿è©¦ç”¨ï¼‰

**4. æ™‚é–“æˆ³è™•ç†**ï¼š
- Hive å­˜å„²ï¼šä½¿ç”¨ `int` é¡å‹å­˜å„²æ¯«ç§’æ™‚é–“æˆ³
- é ˜åŸŸå±¤ï¼šä½¿ç”¨ `DateTime` é¡å‹
- è½‰æ›ï¼š`DateTime.millisecondsSinceEpoch` â†” `DateTime.fromMillisecondsSinceEpoch()`

**5. æ›¸ç±¤åˆ—è¡¨è™•ç†**ï¼š
- ä½¿ç”¨ `List<int>` å­˜å„²æ›¸ç±¤é ç¢¼
- åœ¨è½‰æ›æ™‚å‰µå»ºæ–°åˆ—è¡¨é¿å…å¼•ç”¨å•é¡Œ
- ä¿æŒåˆ—è¡¨é †åºï¼ˆç”±é ˜åŸŸå±¤ç¶­è­·ï¼‰

**6. ç”Ÿæˆçš„ Adapter åŠŸèƒ½**ï¼š
```dart
class ReadingProgressModelAdapter extends TypeAdapter<ReadingProgressModel> {
  @override final int typeId = 3;
  
  @override
  ReadingProgressModel read(BinaryReader reader) { ... }
  
  @override
  void write(BinaryWriter writer, ReadingProgressModel obj) { ... }
}
```

**7. ä½¿ç”¨æ–¹å¼**ï¼š
```dart
// è¨»å†Š Adapter
Hive.registerAdapter(ReadingProgressModelAdapter());

// ä¿å­˜é€²åº¦
final model = ReadingProgressModel.fromEntity(progress);
final box = await Hive.openBox<ReadingProgressModel>('reading_progress');
await box.put(progress.bookId, model);

// è®€å–é€²åº¦
final model = box.get(bookId);
final progress = model?.toEntity();
```

**8. ç‰¹æ€§**ï¼š
- âœ… é«˜æ•ˆçš„äºŒé€²åˆ¶åºåˆ—åŒ–
- âœ… è‡ªå‹•é¡å‹å®‰å…¨
- âœ… æ”¯æŒå¯ç©ºæ¬„ä½
- âœ… æ”¯æŒåˆ—è¡¨é¡å‹
- âœ… å®Œæ•´çš„é›™å‘è½‰æ›

**9. æ§‹å»ºå‘½ä»¤**ï¼š
```bash
dart run build_runner build --delete-conflicting-outputs
```

---

### Phase 4.16: æ›¸ç±¤æŒ‰éˆ• UI (1 å°æ™‚)

#### âœ… Task 4.16.1: å‰µå»ºæ›¸ç±¤æŒ‰éˆ•
- **æ–‡ä»¶**: `lib/presentation/pages/reader/reader_page.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2024-11-09
- **å¯¦éš›ç”¨æ™‚**: 0 åˆ†é˜ï¼ˆå·²å¯¦ç¾ï¼‰

**å…·é«”æ­¥é©Ÿ**:
1. âœ… åœ¨å·¥å…·æ¬„æ·»åŠ æ›¸ç±¤æŒ‰éˆ•
2. âœ… æœªæ·»åŠ é¡¯ç¤º ğŸ”–ï¼ˆç°è‰²ï¼‰
3. âœ… å·²æ·»åŠ é¡¯ç¤º ğŸ“‘ï¼ˆå½©è‰²ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] æœªæ·»åŠ é¡¯ç¤º bookmark_border åœ–æ¨™ï¼ˆé è¨­é¡è‰²ï¼‰
- [x] å·²æ·»åŠ é¡¯ç¤º bookmark åœ–æ¨™ï¼ˆç¥ç€è‰²ï¼‰
- [x] é»æ“Šæœ‰åé¥‹å‹•ç•«ï¼ˆMaterial Design ripple effectï¼‰

**å¯¦ç¾ç´°ç¯€**:

**1. æŒ‰éˆ•ä½ç½®**ï¼š
- ä½æ–¼ AppBar çš„ actions å€åŸŸ
- åœ¨ç›´æ›¸/æ©«æ›¸åˆ‡æ›æŒ‰éˆ•å’Œè¨­ç½®æŒ‰éˆ•ä¹‹é–“
- å·¥å…·æ¬„å¯è¦‹æ™‚é¡¯ç¤º

**2. åœ–æ¨™ç‹€æ…‹**ï¼š
```dart
Obx(() {
  final isBookmarked = controller.isCurrentPageBookmarked;
  return IconButton(
    icon: Icon(
      isBookmarked ? Icons.bookmark : Icons.bookmark_border,
      color: isBookmarked ? Colors.amber : null,
    ),
    onPressed: controller.toggleCurrentBookmark,
    tooltip: isBookmarked ? 'ç§»é™¤æ›¸ç±¤' : 'æ·»åŠ æ›¸ç±¤',
  );
})
```

**3. è¦–è¦ºåé¥‹**ï¼š
- **æœªæ·»åŠ ç‹€æ…‹**ï¼š
  - åœ–æ¨™ï¼š`Icons.bookmark_border`ï¼ˆç©ºå¿ƒæ›¸ç±¤ï¼‰
  - é¡è‰²ï¼šé è¨­é¡è‰²ï¼ˆæ ¹æ“šä¸»é¡Œï¼‰
  - Tooltipï¼šã€Œæ·»åŠ æ›¸ç±¤ã€

- **å·²æ·»åŠ ç‹€æ…‹**ï¼š
  - åœ–æ¨™ï¼š`Icons.bookmark`ï¼ˆå¯¦å¿ƒæ›¸ç±¤ï¼‰
  - é¡è‰²ï¼š`Colors.amber`ï¼ˆç¥ç€è‰²/é‡‘é»ƒè‰²ï¼‰
  - Tooltipï¼šã€Œç§»é™¤æ›¸ç±¤ã€

**4. éŸ¿æ‡‰å¼æ›´æ–°**ï¼š
- ä½¿ç”¨ `Obx()` åŒ…è£å¯¦ç¾éŸ¿æ‡‰å¼
- ç›£è½ `controller.isCurrentPageBookmarked` å±¬æ€§
- é ç¢¼æ”¹è®Šæ™‚è‡ªå‹•æ›´æ–°åœ–æ¨™ç‹€æ…‹
- åˆ‡æ›æ›¸ç±¤æ™‚ç«‹å³æ›´æ–° UI

**5. ç”¨æˆ¶äº¤äº’**ï¼š
- é»æ“Šè§¸ç™¼ `controller.toggleCurrentBookmark()`
- Material Design ripple æ°´æ³¢ç´‹æ•ˆæœ
- è§¸è¦ºåé¥‹ï¼ˆç³»çµ±é è¨­ï¼‰
- Tooltip æç¤ºç”¨æˆ¶ç•¶å‰ç‹€æ…‹

**6. å¤œé–“æ¨¡å¼æ”¯æŒ**ï¼š
- åœ–æ¨™é¡è‰²è‡ªå‹•é©é…ä¸»é¡Œ
- ç¥ç€è‰²åœ¨æ·±è‰²èƒŒæ™¯ä¸‹æœ‰è‰¯å¥½å¯è¦‹æ€§
- æœªæ·»åŠ ç‹€æ…‹ä½¿ç”¨ä¸»é¡Œé è¨­è‰²

**7. è¨­è¨ˆå„ªå‹¢**ï¼š
- âœ… ç›´è§€çš„è¦–è¦ºå€åˆ†ï¼ˆç©ºå¿ƒ vs å¯¦å¿ƒï¼‰
- âœ… æ˜é¡¯çš„é¡è‰²æç¤ºï¼ˆç°è‰² vs ç¥ç€è‰²ï¼‰
- âœ… å³æ™‚çš„ç‹€æ…‹åé¥‹
- âœ… ç¬¦åˆ Material Design è¦ç¯„
- âœ… éŸ¿æ‡‰å¼æ›´æ–°ç„¡å»¶é²

---

#### âœ… Task 4.16.2: å¯¦ç¾æ›¸ç±¤ç‹€æ…‹åˆ‡æ›å‹•ç•«
- **æ–‡ä»¶**: `lib/presentation/widgets/reader/animated_bookmark_button.dart`, `lib/presentation/pages/reader/reader_page.dart`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-01-06
- **å¯¦éš›ç”¨æ™‚**: 35 åˆ†é˜

**å¯¦ç¾ç´°ç¯€**:
1. å‰µå»º `AnimatedBookmarkButton` å°éƒ¨ä»¶
   - ä½¿ç”¨ `AnimationController` ç®¡ç†å‹•ç•«
   - `TweenSequence` å¯¦ç¾ç¸®æ”¾æ•ˆæœï¼š1.0 â†’ 0.8 â†’ 1.0
   - å‹•ç•«æŒçºŒæ™‚é–“ï¼š150ms
2. é›†æˆè§¸è¦ºåé¥‹
   - ä½¿ç”¨ `HapticFeedback.lightImpact()`
   - é»æ“Šæ™‚è§¸ç™¼è§¸è¦ºåé¥‹
3. é›†æˆåˆ° `ReaderPage`
   - æ›¿æ›åŸæœ‰ `IconButton`
   - ä¿æŒ `Obx` éŸ¿æ‡‰å¼æ›´æ–°

**é©—æ”¶æ¨™æº–**:
- [x] åˆ‡æ›æ™‚æœ‰ç¸®æ”¾å‹•ç•«ï¼ˆbounce effect: 1.0 â†’ 0.8 â†’ 1.0ï¼‰
- [x] å‹•ç•«æµæš¢ï¼ˆ150ms < 200msï¼‰
- [x] æœ‰è§¸è¦ºåé¥‹ï¼ˆHapticFeedback.lightImpactï¼‰
- [x] é›†æˆåˆ° ReaderPage AppBar
- [x] ä¿æŒéŸ¿æ‡‰å¼ç‹€æ…‹æ›´æ–°

---

### Phase 4.17: æ›¸ç±¤é‚è¼¯å¯¦ç¾ (1.5 å°æ™‚)

#### âœ… Task 4.17.1: å¯¦ç¾æ›¸ç±¤åˆ‡æ›é‚è¼¯
- **æ–‡ä»¶**: `lib/domain/usecases/reader/toggle_bookmark.dart`, `lib/domain/repositories/reading_repository.dart`, `lib/data/repositories/reader/reading_repository_impl.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-01-06
- **å¯¦éš›ç”¨æ™‚**: 1 å°æ™‚

**å¯¦ç¾ç´°ç¯€**:
1. å‰µå»º `ReadingRepository` æ¥å£
   - å®šç¾© getReadingProgress, saveReadingProgress æ–¹æ³•
   - éµå¾ª Clean Architecture Repository Pattern
2. å¯¦ç¾ `ReadingRepositoryImpl` with Hive
   - ä½¿ç”¨ ReadingProgressModel é€²è¡Œæ•¸æ“šæŒä¹…åŒ–
   - Box åç¨±ï¼š'reading_progress'
3. å¯¦ç¾ `GetReadingProgress` ç”¨ä¾‹
   - å¾ Repository è®€å–é–±è®€é€²åº¦
4. å¯¦ç¾ `SaveReadingProgress` ç”¨ä¾‹
   - ä¿å­˜é–±è®€é€²åº¦åˆ° Repository
5. å¯¦ç¾ `ToggleBookmark` ç”¨ä¾‹
   - ç²å–ç•¶å‰é€²åº¦ â†’ åˆ‡æ›æ›¸ç±¤ â†’ ä¿å­˜æ›´æ–°
6. è¨»å†Š ReadingProgressModel Adapter (typeId: 3)
7. åœ¨ AppInitializer ä¸­æ‰“é–‹ reading_progress Box
8. åœ¨ main.dart ä¸­æ³¨å†Š Repository å’Œ Use Cases

**é©—æ”¶æ¨™æº–**:
- [x] æª¢æŸ¥æ›¸ç±¤ç‹€æ…‹æ­£ç¢ºï¼ˆä½¿ç”¨ ReadingProgress.isBookmarkedï¼‰
- [x] åˆ‡æ›é‚è¼¯æ­£ç¢ºï¼ˆä½¿ç”¨ ReadingProgress.toggleBookmarkï¼‰
- [x] UI å³æ™‚æ›´æ–°ï¼ˆReaderController ä¸­çš„ Obx éŸ¿æ‡‰å¼æ›´æ–°ï¼‰
- [x] ä¿å­˜åˆ°æ•¸æ“šåº«ï¼ˆHive æŒä¹…åŒ–ï¼‰

---

#### âœ… Task 4.17.2: å¯¦ç¾æ›¸ç±¤æ•¸æ“šæŒä¹…åŒ–
- **æ–‡ä»¶**: `lib/data/repositories/reader/reading_repository_impl.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-01-06
- **å¯¦éš›ç”¨æ™‚**: åŒ…å«åœ¨ Task 4.17.1 ä¸­

**å¯¦ç¾ç´°ç¯€**:
- ReadingRepositoryImpl ä½¿ç”¨ Hive é€²è¡ŒæŒä¹…åŒ–
- æ›¸ç±¤æ•¸æ“šåœ¨ ReadingProgress ä¸­ä¿å­˜
- æ¯æ¬¡åˆ‡æ›æ›¸ç±¤æ™‚è‡ªå‹•ä¿å­˜åˆ° Hive
- ä½¿ç”¨ bookId ä½œç‚º key é€²è¡Œå­˜å„²

**é©—æ”¶æ¨™æº–**:
- [x] æ›¸ç±¤å³æ™‚ä¿å­˜ï¼ˆtoggleBookmark èª¿ç”¨ saveReadingProgressï¼‰
- [x] é‡æ–°æ‰“é–‹æ™‚æ¢å¾©æ›¸ç±¤ï¼ˆ_loadReadingProgress å¾ Hive è®€å–ï¼‰
- [x] ç„¡æ•¸æ“šä¸Ÿå¤±ï¼ˆHive æŒä¹…åŒ–ä¿è­‰ï¼‰

---

### Phase 4.18: æ›¸ç±¤æ¢å¾©åŠŸèƒ½ (0.5 å°æ™‚)

#### âœ… Task 4.18.1: å¯¦ç¾æ›¸ç±¤ç‹€æ…‹æ¢å¾©
- **æ–‡ä»¶**: `lib/presentation/controllers/reader/reader_controller.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ
- **å®Œæˆæ™‚é–“**: 2025-01-06
- **å¯¦éš›ç”¨æ™‚**: åŒ…å«åœ¨ Task 4.17.1 ä¸­

**å¯¦ç¾ç´°ç¯€**:
1. `_loadReadingProgress()` æ–¹æ³•åœ¨ `_initialize()` ä¸­èª¿ç”¨
   - æ­¥é©Ÿ 3: åŠ è¼‰é–±è®€é€²åº¦ï¼ˆåœ¨åŠ è¼‰æ›¸ç±ä¿¡æ¯ä¹‹å¾Œï¼‰
2. å¾ `GetReadingProgress` ç”¨ä¾‹ç²å–æ•¸æ“š
3. æ¢å¾©å…©å€‹ç‹€æ…‹ï¼š
   - `currentPage.value = progress.currentPage`
   - `bookmarkedPages.value = progress.bookmarkedPages`
4. UI é€šéè¨ˆç®—å±¬æ€§éŸ¿æ‡‰å¼æ›´æ–°ï¼š
   - `isCurrentPageBookmarked` æª¢æŸ¥ç•¶å‰é æ˜¯å¦åœ¨æ›¸ç±¤åˆ—è¡¨ä¸­
   - `Obx(() => AnimatedBookmarkButton(isBookmarked: controller.isCurrentPageBookmarked))`

**é©—æ”¶æ¨™æº–**:
- [x] å¾ Hive è®€å–æ›¸ç±¤æ•¸æ“šï¼ˆé€šé GetReadingProgress ç”¨ä¾‹ï¼‰
- [x] æ›´æ–° bookmarkedPages åˆ—è¡¨ï¼ˆbookmarkedPages.value = progress.bookmarkedPagesï¼‰
- [x] æ›´æ–°ç•¶å‰é æ›¸ç±¤æŒ‰éˆ•ç‹€æ…‹ï¼ˆisCurrentPageBookmarked è¨ˆç®—å±¬æ€§ + Obxï¼‰

---

**éšæ®µ 5 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 7
- **é è¨ˆæ™‚é–“**: ~4.5 å°æ™‚
- **é—œéµç”¢å‡º**: å®Œæ•´çš„åŸºç¤æ›¸ç±¤åŠŸèƒ½

---

## ğŸ“… Day 5: æ•´åˆæ¸¬è©¦ (9 å°æ™‚)

### Phase 4.19: å–®å…ƒæ¸¬è©¦ (2.5 å°æ™‚)

#### âœ… Task 4.19.1: ç·¨å¯« ReaderController å–®å…ƒæ¸¬è©¦
- **æ–‡ä»¶**: `test/presentation/controllers/reader/reader_controller_test.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 2 å°æ™‚
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… å‰µå»ºæ¸¬è©¦æ–‡ä»¶
2. âœ… æ¸¬è©¦åˆå§‹åŒ–é‚è¼¯
3. âœ… æ¸¬è©¦ç¿»é é‚è¼¯
4. âœ… æ¸¬è©¦æ¨¡å¼åˆ‡æ›
5. âœ… æ¸¬è©¦æ›¸ç±¤åŠŸèƒ½

**æ¸¬è©¦è¦†è“‹**:
- ç‹€æ…‹åˆå§‹åŒ–: 3 å€‹æ¸¬è©¦
- æ›¸ç±¤ç®¡ç†: 4 å€‹æ¸¬è©¦
- é é¢å°èˆª: 6 å€‹æ¸¬è©¦
- é–±è®€æ–¹å‘: 1 å€‹æ¸¬è©¦
- å­—é«”å¤§å°: 6 å€‹æ¸¬è©¦
- äº®åº¦æ§åˆ¶: 3 å€‹æ¸¬è©¦
- å¤œé–“æ¨¡å¼: 1 å€‹æ¸¬è©¦
- å·¥å…·æ¬„æ§åˆ¶: 7 å€‹æ¸¬è©¦
- ç•¶å‰è¨­ç½®: 1 å€‹æ¸¬è©¦
- **ç¸½è¨ˆ**: 34 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šé âœ…

**é©—æ”¶æ¨™æº–**:
- [x] æ‰€æœ‰æ¸¬è©¦é€šé
- [x] æ¸¬è©¦è¦†è“‹ç‡ > 80%

---

#### âœ… Task 4.19.2: ç·¨å¯« ReadingProgress å–®å…ƒæ¸¬è©¦
- **æ–‡ä»¶**: `test/domain/entities/reader/reading_progress_test.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… å·²å®Œæˆ

**å…·é«”æ­¥é©Ÿ**:
1. âœ… æ¸¬è©¦ toggleBookmark()
2. âœ… æ¸¬è©¦ isBookmarked()
3. âœ… æ¸¬è©¦æ•¸æ“šåºåˆ—åŒ–

**æ¸¬è©¦è¦†è“‹**:
- åˆå§‹åŒ–: 2 å€‹æ¸¬è©¦
- isBookmarked: 3 å€‹æ¸¬è©¦
- toggleBookmark: 4 å€‹æ¸¬è©¦
- addBookmark: 3 å€‹æ¸¬è©¦
- removeBookmark: 2 å€‹æ¸¬è©¦
- updatePosition: 2 å€‹æ¸¬è©¦
- é€²åº¦è¨ˆç®—: 6 å€‹æ¸¬è©¦
- ç‹€æ…‹æª¢æŸ¥: 7 å€‹æ¸¬è©¦
- copyWith: 2 å€‹æ¸¬è©¦
- Equatable: 2 å€‹æ¸¬è©¦
- toString: 1 å€‹æ¸¬è©¦
- **ç¸½è¨ˆ**: 35 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šé âœ…

**é©—æ”¶æ¨™æº–**:
- [x] æ‰€æœ‰æ–¹æ³•æ¸¬è©¦é€šé
- [x] æ•¸æ“šåºåˆ—åŒ–æ­£ç¢º

---

### Phase 4.20: Widget æ¸¬è©¦ (2.5 å°æ™‚)

#### ğŸ”„ Task 4.20.1: ç·¨å¯« ReaderPage Widget æ¸¬è©¦
- **æ–‡ä»¶**: `test/presentation/pages/reader/reader_page_test.dart`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: ğŸ”„ **å·²å»¶æœŸ** (2025-11-09)
- **å¯¦éš›ç”¨æ™‚**: 2.5 å°æ™‚ï¼ˆå˜—è©¦å¤šç¨®æ–¹æ¡ˆï¼‰

**å»¶æœŸåŸå› **:

ç”±æ–¼ GetX æ§åˆ¶å™¨ç”Ÿå‘½é€±æœŸçš„è¤‡é›œæ€§ï¼ŒWidget æ¸¬è©¦é‡åˆ°æŠ€è¡“æŒ‘æˆ°ï¼š

**å•é¡Œæè¿°**:
1. **GetX ç”Ÿå‘½é€±æœŸè‡ªå‹•è§¸ç™¼**: 
   - `Get.put()` æœƒè‡ªå‹•èª¿ç”¨ `_startController()` â†’ `onStart()`
   - `onStart` æ˜¯ getter è¿”å› `InternalFinalCallback<void>`ï¼Œä¸æ˜¯æ™®é€šæ–¹æ³•

2. **Mockito ç„¡æ³•æ­£ç¢º stub**:
   - `onStart` è¿”å›é¡å‹æ˜¯ `InternalFinalCallback<void>`ï¼ˆå‡½æ•¸é¡å‹ï¼‰
   - Mockito ç„¡æ³•ç”Ÿæˆæ­£ç¢ºçš„ stubï¼Œè¿”å› `SmartFake` å°è±¡
   - ç•¶ GetX å˜—è©¦èª¿ç”¨æ™‚æ‹‹å‡º `FakeUsedError`

3. **å˜—è©¦çš„è§£æ±ºæ–¹æ¡ˆ**:
   - âŒ æ‰‹å‹• stubbing: `when(mock.onStart).thenReturn((_) {})` - é¡å‹ä¸åŒ¹é…
   - âŒ `OnMissingStub.returnDefault` è¨»è§£ - ä»è¿”å›ç„¡æ³•èª¿ç”¨çš„ SmartFake
   - âŒ `permanent: false` æ¨™èªŒ - ç”Ÿå‘½é€±æœŸä»æœƒè§¸ç™¼
   - âŒ Fake Controller ç¹¼æ‰¿ - ç„¡æ³•è¦†è“‹ getter å‹æ…‹çš„ç”Ÿå‘½é€±æœŸé‰¤å­
   - âŒ å®Œå…¨ç§»é™¤ mocks - çœŸå¯¦æ§åˆ¶å™¨éœ€è¦ç„¡æ³•åœ¨æ¸¬è©¦ä¸­æ³¨å…¥çš„ä¾è³´

**æŠ€è¡“é™åˆ¶**:
```dart
// GetX å…§éƒ¨å¯¦ç¾
void _startController({required GetLifeCycleBase instance}) {
  instance.onStart(); // é€™è£¡èª¿ç”¨çš„æ˜¯ getter è¿”å›çš„å‡½æ•¸
}

// ReaderController ç¹¼æ‰¿çš„ç”Ÿå‘½é€±æœŸ
abstract class GetxController extends DisposableInterface 
    with GetLifeCycleBase {
  // onStart æ˜¯ GetLifeCycleBase çš„ fieldï¼Œä¸æ˜¯ method
  InternalFinalCallback<void> get onStart => ...
}
```

**å·²å®Œæˆçš„æ¸¬è©¦è¦†è“‹**:
- âœ… **Task 4.19.1**: ReaderController å–®å…ƒæ¸¬è©¦ï¼ˆ34 å€‹æ¸¬è©¦ï¼Œ100% é€šéï¼‰
- âœ… **Task 4.19.2**: ReadingProgress å¯¦é«”æ¸¬è©¦ï¼ˆ35 å€‹æ¸¬è©¦ï¼Œ100% é€šéï¼‰
- **ç¸½è¨ˆ**: 69 å€‹æ¸¬è©¦ç”¨ä¾‹ï¼Œæ ¸å¿ƒé‚è¼¯å·²å®Œæ•´è¦†è“‹

**æ›¿ä»£æ–¹æ¡ˆ**:
1. **æ•´åˆæ¸¬è©¦** (æ¨è–¦): ä½¿ç”¨çœŸå¯¦çš„ ReaderController å¯¦ä¾‹ï¼Œæ­é… mock çš„ä¾è³´é …
2. **ç«¯åˆ°ç«¯æ¸¬è©¦**: ä½¿ç”¨ `integration_test` æ¸¬è©¦å®Œæ•´æµç¨‹
3. **ç­‰å¾… GetX æ”¹é€²**: è¿½è¹¤ GetX é …ç›®çš„å¯æ¸¬è©¦æ€§æ”¹é€²

**æ±ºç­–**:
- æš«æ™‚å»¶æœŸæ­¤ä»»å‹™ï¼Œä¸é˜»å¡é …ç›®é€²åº¦
- å·²æœ‰çš„å–®å…ƒæ¸¬è©¦å·²æä¾›å……åˆ†çš„ä»£ç¢¼è¦†è“‹ç‡
- æœªä¾†å¯ä½¿ç”¨æ•´åˆæ¸¬è©¦è£œå…… UI æ¸¬è©¦

**å…·é«”æ­¥é©Ÿ** (å·²å˜—è©¦):
1. âœ… å‰µå»ºæ¸¬è©¦æ–‡ä»¶å’Œæ¸¬è©¦çµæ§‹ï¼ˆ6 çµ„ï¼Œ15 å€‹æ¸¬è©¦ç”¨ä¾‹ï¼‰
2. âœ… è¨­ç½® Mockito ç”Ÿæˆé…ç½®
3. âŒ ç”Ÿæˆå¯ç”¨çš„ mock å°è±¡ï¼ˆGetX ç”Ÿå‘½é€±æœŸå•é¡Œï¼‰
4. âŒ ç·¨å¯«ä¸¦é‹è¡Œæ¸¬è©¦ï¼ˆæ‰€æœ‰æ¸¬è©¦å› ç”Ÿå‘½é€±æœŸå¤±æ•—ï¼‰

**é©—æ”¶æ¨™æº–** (èª¿æ•´):
- [x] æ ¸å¿ƒé‚è¼¯å·²é€šéå–®å…ƒæ¸¬è©¦é©—è­‰
- [x] æŠ€è¡“æŒ‘æˆ°å·²è¨˜éŒ„ä¸¦æå‡ºè§£æ±ºæ–¹æ¡ˆ
- [ ] Widget æ¸¬è©¦ï¼ˆå»¶æœŸè‡³æ•´åˆæ¸¬è©¦éšæ®µï¼‰

---

#### â¬œ Task 4.20.2: ç·¨å¯« EpubViewerWidget æ¸¬è©¦
- **æ–‡ä»¶**: `test/widgets/epub_viewer_widget_test.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. æ¸¬è©¦æ‰‹å‹¢è­˜åˆ¥
2. æ¸¬è©¦ç¿»é å‹•ç•«
3. æ¸¬è©¦åŠ è¼‰ç‹€æ…‹

**é©—æ”¶æ¨™æº–**:
- [ ] æ‰‹å‹¢è­˜åˆ¥æ­£ç¢º
- [ ] ç¿»é å‹•ç•«æµæš¢
- [ ] åŠ è¼‰ç‹€æ…‹æ­£ç¢º

---

#### âœ… Task 4.20.3: ç·¨å¯«è¨­ç½®é¢æ¿ Widget æ¸¬è©¦
- **æ–‡ä»¶**: `test/presentation/widgets/reader/reading_settings_panel_test.dart`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: âœ… **å·²å®Œæˆ** (2025-11-09)
- **å¯¦éš›ç”¨æ™‚**: 25 åˆ†é˜

**æ¸¬è©¦è¦†è“‹**:
- UI å…ƒç´ é¡¯ç¤º: 5 å€‹æ¸¬è©¦
- å­—é«”å¤§å°æ»‘æ¡¿: 5 å€‹æ¸¬è©¦
- äº®åº¦æ»‘æ¡¿: 2 å€‹æ¸¬è©¦
- å¤œé–“æ¨¡å¼é–‹é—œ: 3 å€‹æ¸¬è©¦
- è‡ªå‹•éš±è—å·¥å…·æ¬„é–‹é—œ: 3 å€‹æ¸¬è©¦
- å¤œé–“æ¨¡å¼æ¨£å¼: 4 å€‹æ¸¬è©¦
- é¢æ¿ä½ˆå±€: 3 å€‹æ¸¬è©¦
- è¼”åŠ©å‡½æ•¸: 6 å€‹æ¸¬è©¦
- é‚Šç•Œæƒ…æ³: 5 å€‹æ¸¬è©¦
- **ç¸½è¨ˆ**: 35 å€‹æ¸¬è©¦ç”¨ä¾‹å…¨éƒ¨é€šé âœ…

**å…·é«”æ­¥é©Ÿ**:
1. âœ… æ¸¬è©¦æ»‘æ¡¿äº¤äº’ï¼ˆå­—é«”å¤§å°ã€äº®åº¦ï¼‰
2. âœ… æ¸¬è©¦é–‹é—œäº¤äº’ï¼ˆå¤œé–“æ¨¡å¼ã€è‡ªå‹•éš±è—ï¼‰
3. âœ… æ¸¬è©¦ UI å…ƒç´ é¡¯ç¤º
4. âœ… æ¸¬è©¦å¤œé–“æ¨¡å¼æ¨£å¼
5. âœ… æ¸¬è©¦é‚Šç•Œæƒ…æ³ï¼ˆæœ€å°/æœ€å¤§å€¼ï¼‰

**é©—æ”¶æ¨™æº–**:
- [x] æ‰€æœ‰ UI å…ƒç´ æ­£ç¢ºé¡¯ç¤º
- [x] æ»‘æ¡¿äº¤äº’æ­£å¸¸ï¼Œå›èª¿å‡½æ•¸æ­£ç¢ºè§¸ç™¼
- [x] é–‹é—œäº¤äº’æ­£å¸¸ï¼Œç‹€æ…‹æ­£ç¢ºåˆ‡æ›
- [x] å¤œé–“æ¨¡å¼æ¨£å¼æ­£ç¢ºæ‡‰ç”¨
- [x] æ‰€æœ‰æ¸¬è©¦é€šéï¼ˆ35/35ï¼‰

**æŠ€è¡“äº®é»**:
- ç´” StatelessWidget æ¸¬è©¦ï¼Œç„¡ä¾è³´æ³¨å…¥å•é¡Œ
- ä½¿ç”¨å›èª¿è¿½è¹¤å™¨é©—è­‰äº¤äº’è¡Œç‚º
- å®Œæ•´è¦†è“‹æ‰€æœ‰ UI çµ„ä»¶å’Œäº¤äº’
- æ¸¬è©¦é‚Šç•Œå€¼å’Œç‰¹æ®Šæƒ…æ³
- é©—è­‰å¤œé–“æ¨¡å¼ä¸‹çš„é¡è‰²ä¸»é¡Œè®ŠåŒ–

---

### Phase 4.21: é›†æˆæ¸¬è©¦ (2 å°æ™‚)

#### â¬œ Task 4.21.1: ç·¨å¯«å®Œæ•´é–±è®€æµç¨‹æ¸¬è©¦
- **æ–‡ä»¶**: `integration_test/reader_flow_test.dart`
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 2 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. æ¸¬è©¦æ‰“é–‹æ›¸ç±
2. æ¸¬è©¦ç¿»é 
3. æ¸¬è©¦æ¨¡å¼åˆ‡æ›
4. æ¸¬è©¦æ·»åŠ æ›¸ç±¤
5. æ¸¬è©¦è¨­ç½®èª¿æ•´

**é©—æ”¶æ¨™æº–**:
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] è¦†è“‹å®Œæ•´æµç¨‹

---

### Phase 4.22: æ€§èƒ½æ¸¬è©¦ (2 å°æ™‚)

#### â¬œ Task 4.22.1: æ¸¬è©¦é–±è®€å™¨æ€§èƒ½
- **å·¥å…·**: DevTools
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. ä½¿ç”¨ DevTools æ¸¬è©¦æ€§èƒ½æŒ‡æ¨™
2. è¨˜éŒ„å•Ÿå‹•æ™‚é–“
3. è¨˜éŒ„ç¿»é æµæš¢åº¦
4. è¨˜éŒ„å…§å­˜ä½¿ç”¨

**é©—æ”¶æ¨™æº–**:
- [ ] å•Ÿå‹•æ™‚é–“ < 2s
- [ ] ç¿»é æµæš¢åº¦ 60fps
- [ ] å…§å­˜ä½¿ç”¨ < 150MB
- [ ] ç„¡å…§å­˜æ´©æ¼

---

#### â¬œ Task 4.22.2: ä¿®å¾©æ€§èƒ½å•é¡Œ
- **æ–‡ä»¶**: ç›¸é—œä»£ç¢¼
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. æ ¹æ“šæ¸¬è©¦çµæœå„ªåŒ–æ€§èƒ½
2. ä¿®å¾©ç™¼ç¾çš„å•é¡Œ

**é©—æ”¶æ¨™æº–**:
- [ ] æ‰€æœ‰æ€§èƒ½æŒ‡æ¨™é”æ¨™
- [ ] ç„¡æ˜é¡¯å¡é “

---

**éšæ®µ 6 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 8
- **é è¨ˆæ™‚é–“**: ~9 å°æ™‚
- **é—œéµç”¢å‡º**: å®Œæ•´çš„æ¸¬è©¦è¦†è“‹

---

## ğŸ“… Day 6: æ–‡æª”èˆ‡ç™¼å¸ƒ (6 å°æ™‚)

### Phase 4.23: API æ–‡æª” (1.5 å°æ™‚)

#### â¬œ Task 4.23.1: æ·»åŠ ä»£ç¢¼è¨»é‡‹
- **æ–‡ä»¶**: æ‰€æœ‰ä»£ç¢¼æ–‡ä»¶
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. ç‚ºæ‰€æœ‰ public æ–¹æ³•æ·»åŠ  Dart Doc è¨»é‡‹
2. ç‚ºæ‰€æœ‰ class æ·»åŠ è¨»é‡‹
3. ä½¿ç”¨ `///` æ ¼å¼

**é©—æ”¶æ¨™æº–**:
- [ ] æ‰€æœ‰ public æ–¹æ³•æœ‰è¨»é‡‹
- [ ] æ‰€æœ‰ class æœ‰è¨»é‡‹
- [ ] ä½¿ç”¨ `///` æ ¼å¼

---

#### â¬œ Task 4.23.2: ç”Ÿæˆ API æ–‡æª”
- **å‘½ä»¤**: `dart doc`
- **å„ªå…ˆç´š**: P2
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. åŸ·è¡Œ `dart doc`
2. æª¢æŸ¥ç”Ÿæˆçš„æ–‡æª”

**é©—æ”¶æ¨™æº–**:
- [ ] æ–‡æª”å®Œæ•´æ¸…æ™°

---

### Phase 4.24: ç”¨æˆ¶æŒ‡å— (1 å°æ™‚)

#### â¬œ Task 4.24.1: ç·¨å¯«ä½¿ç”¨èªªæ˜
- **æ–‡ä»¶**: `docs/reader_guide.md`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. èªªæ˜å¦‚ä½•æ‰“é–‹æ›¸ç±
2. èªªæ˜å¦‚ä½•ä½¿ç”¨ç›´æ›¸/æ©«æ›¸æ¨¡å¼
3. èªªæ˜å¦‚ä½•æ·»åŠ æ›¸ç±¤
4. èªªæ˜å¦‚ä½•èª¿æ•´è¨­ç½®
5. åŒ…å«æˆªåœ–

**é©—æ”¶æ¨™æº–**:
- [ ] ä½¿ç”¨èªªæ˜å®Œæ•´
- [ ] åŒ…å«æˆªåœ–

---

### Phase 4.25: æˆªåœ–èˆ‡æ¼”ç¤º (1.5 å°æ™‚)

#### â¬œ Task 4.25.1: æˆªå–åŠŸèƒ½æˆªåœ–
- **æ–‡ä»¶**: `screenshots/reader/`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. æˆªå–ç›´æ›¸æ¨¡å¼æˆªåœ–
2. æˆªå–æ©«æ›¸æ¨¡å¼æˆªåœ–
3. æˆªå–è¨­ç½®é¢æ¿æˆªåœ–
4. æˆªå–æ›¸ç±¤åŠŸèƒ½æˆªåœ–

**é©—æ”¶æ¨™æº–**:
- [ ] æ‰€æœ‰åŠŸèƒ½æˆªåœ–å®Œæ•´
- [ ] åˆ†è¾¨ç‡çµ±ä¸€

---

#### â¬œ Task 4.25.2: éŒ„è£½æ¼”ç¤ºè¦–é »
- **æ–‡ä»¶**: `demo/reader_demo.mp4`
- **å„ªå…ˆç´š**: P2
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. å±•ç¤ºå®Œæ•´é–±è®€æµç¨‹
2. å±•ç¤ºæ¨¡å¼åˆ‡æ›
3. å±•ç¤ºæ›¸ç±¤åŠŸèƒ½
4. æ™‚é•· < 3 åˆ†é˜

**é©—æ”¶æ¨™æº–**:
- [ ] å±•ç¤ºå®Œæ•´é–±è®€æµç¨‹
- [ ] æ™‚é•· < 3 åˆ†é˜

---

### Phase 4.26: ä»£ç¢¼å¯©æŸ¥ (1.5 å°æ™‚)

#### â¬œ Task 4.26.1: åŸ·è¡Œä»£ç¢¼å¯©æŸ¥
- **æ–‡ä»¶**: å¯©æŸ¥å ±å‘Š
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 1 å°æ™‚
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. åœ˜éšŠä»£ç¢¼å¯©æŸ¥
2. è¨˜éŒ„å¯©æŸ¥æ„è¦‹
3. ä¿®å¾©ç™¼ç¾çš„å•é¡Œ

**é©—æ”¶æ¨™æº–**:
- [ ] ä»£ç¢¼ç¬¦åˆè¦ç¯„
- [ ] ç„¡æ˜é¡¯å•é¡Œ
- [ ] å¯©æŸ¥æ„è¦‹å·²ä¿®å¾©

---

#### â¬œ Task 4.26.2: æ›´æ–° CHANGELOG
- **æ–‡ä»¶**: `CHANGELOG.md`
- **å„ªå…ˆç´š**: P1
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. è¨˜éŒ„æ‰€æœ‰æ–°åŠŸèƒ½
2. è¨˜éŒ„å·²ä¿®å¾©çš„ Bug
3. æ›´æ–°ç‰ˆæœ¬è™Ÿ

**é©—æ”¶æ¨™æº–**:
- [ ] è¨˜éŒ„æ‰€æœ‰æ–°åŠŸèƒ½
- [ ] è¨˜éŒ„å·²ä¿®å¾©çš„ Bug
- [ ] ç‰ˆæœ¬è™Ÿæ­£ç¢º

---

### Phase 4.27: ç™¼å¸ƒæº–å‚™ (0.5 å°æ™‚)

#### â¬œ Task 4.27.1: æº–å‚™ Demo å±•ç¤º
- **æ–‡ä»¶**: Demo ç’°å¢ƒ
- **å„ªå…ˆç´š**: P0
- **é è¨ˆæ™‚é–“**: 30 åˆ†é˜
- **ç‹€æ…‹**: â¬œ æœªé–‹å§‹

**å…·é«”æ­¥é©Ÿ**:
1. æº–å‚™çµ¦åœ˜éšŠ/ç”¨æˆ¶çš„ Demo
2. æº–å‚™æ¸¬è©¦æ•¸æ“š
3. ç¢ºä¿ APP é‹è¡Œç©©å®š

**é©—æ”¶æ¨™æº–**:
- [ ] APP é‹è¡Œç©©å®š
- [ ] æ¸¬è©¦æ•¸æ“šæº–å‚™å®Œæ•´
- [ ] æ¼”ç¤ºæµç¨‹æ¸…æ™°

---

**éšæ®µ 7 å°çµ**:
- **ç¸½ä»»å‹™æ•¸**: 7
- **é è¨ˆæ™‚é–“**: ~6 å°æ™‚
- **é—œéµç”¢å‡º**: å®Œæ•´çš„æ–‡æª”å’Œ Demo

---

## ğŸ“Š ç¸½é«”çµ±è¨ˆ

### æ™‚é–“åˆ†é…
| éšæ®µ | é è¨ˆæ™‚é–“ | ä½”æ¯” |
|------|----------|------|
| Phase 4.1-4.7: åŸºç¤æ¸²æŸ“ | 7h | 16.7% |
| Phase 4.8-4.10: ç›´æ›¸æ¨¡å¼ | 6.5h | 15.5% |
| Phase 4.11-4.14: é–±è®€è¨­ç½® | 5.2h | 12.4% |
| Phase 4.15-4.18: æ›¸ç±¤åŠŸèƒ½ | 4.5h | 10.7% |
| Phase 4.19-4.22: æ•´åˆæ¸¬è©¦ | 9h | 21.4% |
| Phase 4.23-4.27: æ–‡æª”ç™¼å¸ƒ | 6h | 14.3% |
| **ç·©è¡æ™‚é–“** | 4h | 9.5% |
| **ç¸½è¨ˆ** | **42h** | **100%** |

### å„ªå…ˆç´šåˆ†ä½ˆ
- **P0 (å¿…é ˆå®Œæˆ)**: 35 å€‹ä»»å‹™ (81%)
- **P1 (æ‡‰è©²å®Œæˆ)**: 7 å€‹ä»»å‹™ (16%)
- **P2 (å¯ä»¥å»¶å¾Œ)**: 1 å€‹ä»»å‹™ (3%)

### ä¾è³´é—œä¿‚
```
Phase 4.1-4.7 (åŸºç¤æ¸²æŸ“) 
  â””â”€â†’ Phase 4.8-4.10 (ç›´æ›¸æ¨¡å¼)
       â””â”€â†’ Phase 4.11-4.14 (é–±è®€è¨­ç½®)
            â””â”€â†’ Phase 4.15-4.18 (æ›¸ç±¤åŠŸèƒ½)
                 â””â”€â†’ Phase 4.19-4.22 (æ•´åˆæ¸¬è©¦)
                      â””â”€â†’ Phase 4.23-4.27 (æ–‡æª”ç™¼å¸ƒ)
```

---

## ğŸ¯ é©—æ”¶æ¨™æº–ç¸½è¦½

### åŠŸèƒ½é©—æ”¶
- [ ] èƒ½æ­£ç¢ºæ‰“é–‹ä¸¦æ¸²æŸ“ EPUB æ–‡ä»¶
- [ ] æ”¯æŒç›´æ›¸å’Œæ©«æ›¸å…©ç¨®é–±è®€æ¨¡å¼
- [ ] ç›´æ›¸æ¨¡å¼ï¼šå¾å³å‘å·¦æ»‘å‹•ç¿»é 
- [ ] æ©«æ›¸æ¨¡å¼ï¼šå¾å·¦å‘å³æ»‘å‹•ç¿»é 
- [ ] æ¨¡å¼åˆ‡æ›æµæš¢ï¼Œä¿æŒé–±è®€ä½ç½®
- [ ] é–±è®€é€²åº¦æ­£ç¢ºé¡¯ç¤ºå’Œæ›´æ–°
- [ ] å­—é«”å¤§å°å¯èª¿æ•´ï¼ˆ5 æª”ï¼‰
- [ ] äº®åº¦å¯èª¿æ•´ï¼ˆ0-100%ï¼‰
- [ ] æ›¸ç±¤å¯æ·»åŠ /ç§»é™¤
- [ ] æ›¸ç±¤æ•¸æ“šæ­£ç¢ºä¿å­˜å’Œæ¢å¾©
- [ ] é–±è®€åå¥½æ­£ç¢ºä¿å­˜å’Œæ¢å¾©

### æ€§èƒ½é©—æ”¶
- [ ] å•Ÿå‹•æ™‚é–“ < 2 ç§’
- [ ] ç¿»é æµæš¢åº¦ 60fps
- [ ] å…§å­˜ä½¿ç”¨ < 150MB
- [ ] ç„¡å…§å­˜æ´©æ¼
- [ ] ç„¡æ˜é¡¯å¡é “

### æ¸¬è©¦é©—æ”¶
- [ ] å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%
- [ ] æ‰€æœ‰ Widget æ¸¬è©¦é€šé
- [ ] é›†æˆæ¸¬è©¦é€šé
- [ ] æ€§èƒ½æ¸¬è©¦é”æ¨™

### æ–‡æª”é©—æ”¶
- [ ] API æ–‡æª”å®Œæ•´
- [ ] ç”¨æˆ¶æŒ‡å—æ¸…æ™°
- [ ] æˆªåœ–å®Œæ•´
- [ ] Demo è¦–é »å®Œæ•´

---

## ğŸ“ é–‹ç™¼æ—¥èªŒ

### 2025-11-08
- âœ… å‰µå»ºä»»å‹™æ¸…å–®æ–‡æª”
- âœ… æ›´æ–°ä»»å‹™ç·¨è™Ÿæ ¼å¼ï¼ˆ4.x.xï¼‰
- âœ… åƒè€ƒ Spec 03 æ ¼å¼é‡æ§‹æ–‡æª”
- ğŸ“‹ å®šç¾© 43 å€‹å…·é«”ä»»å‹™
- ğŸ“‹ ä¼°ç®—ç¸½è¨ˆ 42 å°æ™‚é–‹ç™¼æ™‚é–“

### 2025-11-XX (Phase 4.9-4.10 é©—è­‰)
- âœ… **Task 4.9.1**: é©—è­‰ç›´æ›¸ç¿»é æ–¹å‘å¯¦ç¾
  - åˆ†æ EpubViewerWidget æ‰‹å‹¢è™•ç†
  - ç¢ºèª velocity æ–¹å‘é‚è¼¯æ­£ç¢º
  - ç›´æ›¸: velocity < 0 = ä¸‹ä¸€é 
  - æ©«æ›¸: velocity > 0 = ä¸‹ä¸€é 
  - é€Ÿåº¦é–¾å€¼ 500
- âœ… **Task 4.10.1**: é©—è­‰æ¨¡å¼åˆ‡æ›æŒ‰éˆ•å¯¦ç¾
  - AppBar ä¸­çš„ IconButton
  - Emoji åœ–æ¨™: âš”ï¸ (ç›´æ›¸) / ğŸ“– (æ©«æ›¸)
  - Obx éŸ¿æ‡‰å¼æ›´æ–°
- âœ… **Task 4.10.2**: é©—è­‰æ¨¡å¼åˆ‡æ›é‚è¼¯å¯¦ç¾
  - toggleReadingDirection() æ–¹æ³•å®Œæ•´
  - å‹•æ…‹ EPUB é è™•ç†
  - éŒ¯èª¤è™•ç†èˆ‡ rollback
  - è¨­å®šæŒä¹…åŒ–
- ğŸ“ æ›´æ–°ä»»å‹™æ–‡æª”ï¼ˆ3 å€‹ä»»å‹™æ¨™è¨˜ç‚ºå®Œæˆï¼‰
- ğŸ“ æ›´æ–°é€²åº¦: 16/43 (37.2%)

### 2025-11-09 (Task 4.10.3)
- âœ… **Task 4.10.3**: è¨­ç½®é è¨­é–±è®€æ¨¡å¼
  - ç¢ºèª ReaderSettings.defaultSettings() é è¨­ç‚ºç›´æ›¸æ¨¡å¼
  - æ›´æ–° _loadReaderSettings() æ–‡æª”èªªæ˜é‚è¼¯
  - é¦–æ¬¡æ‰“é–‹ï¼šä½¿ç”¨é è¨­è¨­ç½®ï¼ˆç›´æ›¸æ¨¡å¼ï¼‰
  - å¾ŒçºŒæ‰“é–‹ï¼šä½¿ç”¨ä¿å­˜çš„è¨­ç½®ï¼ˆå¾… Task 4.14.1 å¯¦ç¾æŒä¹…åŒ–ï¼‰
- ğŸ“ Phase 4.10 å®Œæˆï¼ˆ3/3 tasksï¼‰
- ğŸ“ Day 3 å®Œæˆï¼ˆPhase 4.8-4.10ï¼Œ7/9 tasks å«é©—è­‰ï¼‰
- ğŸ“ æ›´æ–°é€²åº¦: 17/43 (39.5%)

### 2025-11-09 (Task 4.11.1)
- âœ… **Task 4.11.1**: å‰µå»ºè¨­ç½®é¢æ¿ Widget
  - å¯¦ç¾ ReadingSettingsPanel widget (440+ è¡Œä»£ç¢¼)
  - BottomSheet è¨­è¨ˆï¼šåœ“è§’é ‚éƒ¨ã€æ‹–å‹•æŒ‡ç¤ºå™¨ã€é™°å½±æ•ˆæœ
  - å­—é«”å¤§å°èª¿æ•´ï¼š5 æª” (12/14/16/18/20sp)ï¼Œæª”ä½æ¨™ç±¤ï¼Œè‡ªå‹•å°é½Š
  - äº®åº¦èª¿æ•´ï¼š0-100%ï¼Œdivisions=10ï¼Œç¯„åœæ¨™ç±¤
  - å¤œé–“æ¨¡å¼é–‹é—œï¼šSwitch æ§åˆ¶ï¼Œåœ–æ¨™åˆ‡æ›
  - è‡ªå‹•éš±è—å·¥å…·æ¬„é–‹é—œï¼šSwitch æ§åˆ¶
  - å¤œé–“æ¨¡å¼è‡ªé©æ‡‰é¡è‰²
  - éŸ¿æ‡‰å¼ä½ˆå±€ï¼Œåˆ†çµ„è¨­è¨ˆ
- ğŸ“ Phase 4.11 é€²è¡Œä¸­ï¼ˆ1/5 tasksï¼‰
- ğŸ“ æ›´æ–°é€²åº¦: 18/43 (41.9%)

### [æ—¥æœŸ]
- [ ] [è¨˜éŒ„æ¯æ—¥é€²åº¦]

---

## ğŸ› å·²çŸ¥å•é¡Œ

### å¾…ä¿®å¾©
1. [å•é¡Œæè¿°]
   - **åš´é‡ç¨‹åº¦**: [é«˜/ä¸­/ä½]
   - **å½±éŸ¿ç¯„åœ**: [æè¿°]
   - **è¨ˆåŠƒä¿®å¾©æ™‚é–“**: [æ—¥æœŸ]

### å·²ä¿®å¾©
1. [å•é¡Œæè¿°]
   - **ä¿®å¾©æ—¥æœŸ**: [æ—¥æœŸ]
   - **è§£æ±ºæ–¹æ¡ˆ**: [æè¿°]

---

## ğŸ’¡ å„ªåŒ–å»ºè­°

### æ€§èƒ½å„ªåŒ–
1. [å»ºè­° 1]
   - **é æœŸæ•ˆæœ**: [æè¿°]
   - **å¯¦æ–½é›£åº¦**: [é«˜/ä¸­/ä½]

### ç”¨æˆ¶é«”é©—å„ªåŒ–
1. [å»ºè­° 1]
   - **é æœŸæ•ˆæœ**: [æè¿°]
   - **å¯¦æ–½é›£åº¦**: [é«˜/ä¸­/ä½]

---

## ğŸ“Œ æ³¨æ„äº‹é …

### é–‹ç™¼æ³¨æ„äº‹é …
1. **EPUB å…¼å®¹æ€§**: å……åˆ†æ¸¬è©¦ä¸åŒæ ¼å¼çš„ EPUB æ–‡ä»¶
2. **ç›´æ›¸æ¨¡å¼**: ç¢ºä¿ CSS åœ¨ä¸åŒè¨­å‚™ä¸Šçš„å…¼å®¹æ€§
3. **æ›¸ç±¤æº–ç¢ºæ€§**: ä½¿ç”¨ç©©å®šçš„ CFI æ©Ÿåˆ¶ç¢ºä¿æ›¸ç±¤ä½ç½®æº–ç¢º
4. **æ€§èƒ½ç›£æ§**: ä½¿ç”¨ DevTools æŒçºŒç›£æ§æ€§èƒ½
5. **éŒ¯èª¤è™•ç†**: æ‰€æœ‰ async æ“ä½œå¿…é ˆæœ‰éŒ¯èª¤è™•ç†

### æ¸¬è©¦æ³¨æ„äº‹é …
1. æ¸¬è©¦è‡³å°‘ 10 æœ¬ä¸åŒçš„ EPUB æ–‡ä»¶
2. æ¸¬è©¦ä¸åŒè¢å¹•å°ºå¯¸ï¼ˆæ‰‹æ©Ÿ/å¹³æ¿ï¼‰
3. æ¸¬è©¦ä¸åŒ Android ç‰ˆæœ¬ï¼ˆAPI 21-34ï¼‰
4. æ¸¬è©¦æ¥µç«¯æƒ…æ³ï¼ˆè¶…å¤§æ–‡ä»¶ã€æå£æ–‡ä»¶ï¼‰
5. æ¸¬è©¦é•·æ™‚é–“é–±è®€ï¼ˆå…§å­˜æ´©æ¼æª¢æ¸¬ï¼‰

### ä»£ç¢¼è¦ç¯„
1. æ‰€æœ‰ public æ–¹æ³•å¿…é ˆæœ‰ Dart Doc è¨»é‡‹
2. ä½¿ç”¨ `flutter analyze` ç¢ºä¿ç„¡è­¦å‘Š
3. ä½¿ç”¨ `flutter format` çµ±ä¸€ä»£ç¢¼æ ¼å¼
4. éµå¾ª Clean Architecture åŸå‰‡
5. å–®ä¸€è·è²¬åŸå‰‡

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [Spec 04: EPUB é–±è®€å™¨è¦æ ¼æ–‡æª”](./04-reader-view.md)
- [Spec 03: æ›¸ç±è©³æƒ…é ä»»å‹™æ¸…å–®](./03-book-detail-tasks.md)
- [é–‹ç™¼è¨ˆåŠƒ](./development-plan.md)
- [å°ˆæ¡ˆæ†²ç« ](./00-constitution.md)
- [epub_view å®˜æ–¹æ–‡æª”](https://pub.dev/packages/epub_view)

---

**æ–‡æª”ç‰ˆæœ¬**: 2.0  
**å‰µå»ºæ—¥æœŸ**: 2025-11-08  
**æœ€å¾Œæ›´æ–°**: 2025-11-08  
**ç¶­è­·è€…**: [å¾…åˆ†é…]

---

**ä¸‹ä¸€æ­¥è¡Œå‹•**:
1. â¬œ åˆ†é…ä»»å‹™è² è²¬äºº
2. â¬œ é–‹å§‹ Phase 4.1 é–‹ç™¼
3. â¬œ æ¯æ—¥æ›´æ–°é€²åº¦
4. â¬œ å®šæœŸåŒæ­¥å•é¡Œ

**æç¤º**: æ¯å®Œæˆä¸€å€‹ä»»å‹™ï¼Œè«‹åœ¨ â¬œ è™•æ¨™è¨˜ç‚º âœ…ï¼Œä¸¦æ›´æ–°ã€Œé€²åº¦è¿½è¹¤ã€å€åŸŸï¼ğŸ’ª

