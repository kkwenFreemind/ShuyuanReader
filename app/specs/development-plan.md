# 書苑閱讀器 - 完整開發計劃

**專案名稱**: ShuyuanReader (書苑閱讀器)  
**專案類型**: Android 電子書閱讀器 APP  
**開發方法**: Spec-Kit (規格驅動開發)  
**創建日期**: 2025-11-07  
**預計週期**: 10-16 週  
**狀態**: 📋 計劃中

---

## 📚 專案概述

### 核心價值主張
為經典愛好者提供一個**簡潔、高效、離線優先**的閱讀工具，讓用戶能夠：
- 📖 輕鬆瀏覽 100+ 本經典
- 💾 按需下載，節省流量和存儲
- ✈️ 完全離線閱讀
- 🎨 優質的閱讀體驗

### 技術架構
```
GitHub Repository (內容源)
  ├── catalog/books.json    ← 書籍元數據 (50KB)
  ├── covers/*.png          ← 100+ 封面圖片
  └── epub3/*.epub          ← 100+ 電子書文件
            ↓
      HTTPS 按需下載
            ↓
Android APP (智能緩存層)
  ├── Hive 數據庫           ← 書籍元數據 + 狀態
  ├── files/books/         ← 用戶下載的 EPUB
  └── cache/covers/        ← 自動緩存的封面
```

### 技術棧
- **框架**: Flutter 3.13+
- **語言**: Dart 3.0+
- **狀態管理**: GetX 4.6+
- **數據庫**: Hive 2.2+
- **網絡**: Dio 5.3+
- **閱讀器**: epub_view 3.1+

---

## 🎯 開發路線圖

### 整體時間規劃

```
📅 Phase 1: MVP 開發 (Week 1-6)
   └─ 基礎功能實現，達到可用狀態
   
📅 Phase 2: 功能增強 (Week 7-12)
   └─ 提升用戶體驗，增加高級功能
   
📅 Phase 3: 發布準備 (Week 13-16)
   └─ 打磨細節，準備上架 Google Play
```

### 里程碑定義

| 里程碑 | 時間點 | 定義 | 驗收標準 |
|--------|--------|------|----------|
| **M1: Foundation** | Week 2 | 專案搭建完成 | 空白 APP 能運行 |
| **M2: MVP** | Week 6 | 最小可用產品 | 能下載並閱讀書籍 |
| **M3: Beta** | Week 12 | Beta 版本 | 功能完整，可供測試 |
| **M4: Release** | Week 16 | 正式發布 | 上架 Google Play |

---

## 📋 Spec 總覽

### Phase 1: MVP 開發 (Week 1-6)

#### Spec 00: 專案設置與憲章 ✅

**時間**: 1 天  
**狀態**: ✅ 已完成 (2025-11-07)  
**文件**: `00-constitution.md`

**目標**:
- ✅ 建立專案憲章
- ✅ 定義開發規範
- ✅ 確立架構模式

**驗收標準**:
- ✅ 憲章文檔完整
- ✅ 團隊達成共識

---

#### Spec 01: 啟動畫面（Splash Screen）⬜

**時間**: 1 天  
**優先級**: P0  
**依賴**: Spec 00  
**文件**: `01-splash-screen.md` (待生成)

**目標**:
- 顯示 APP Logo 和名稱
- 初始化 Hive 數據庫
- 檢查網絡連接
- 3 秒後自動跳轉到書籍列表

**UI 預覽**:
```
┌─────────────────────────┐
│                         │
│      📚                 │
│   書苑閱讀器             │
│  ShuyuanReader          │
│                         │
│    Loading...           │
│      ━━━━━━━            │
│                         │
└─────────────────────────┘
```

**驗收標準**:
- [ ] Logo 和標題正確顯示
- [ ] 加載動畫流暢
- [ ] Hive 初始化成功
- [ ] 自動跳轉到 HomePage
- [ ] 測試通過（Unit + Widget）

**技術要點**:
- 使用 `Timer` 實現延遲跳轉
- 使用 `Hive.initFlutter()` 初始化數據庫
- 使用 `connectivity_plus` 檢測網絡

---

#### Spec 02: 書籍列表頁（Book List）⬜

**時間**: 3-4 天  
**優先級**: P0  
**依賴**: Spec 01  
**文件**: `02-book-list.md` (待生成)

**目標**:
- 從 GitHub 下載 `books.json`
- 解析並顯示書籍列表（GridView）
- 顯示封面、書名、作者
- 支持下拉刷新
- 錯誤處理（網絡失敗時使用緩存）

**UI 預覽**:
```
┌─────────────────────────────────┐
│  書苑閱讀器          🔍  ⚙️      │
├─────────────────────────────────┤
│  ┌──────┐  ┌──────┐  ┌──────┐ │
│  │ 📖  │  │ 📖  │  │ 📖  │ │
│  │封面1 │  │封面2 │  │封面3 │ │
│  │書名1 │  │書名2 │  │書名3 │ │
│  └──────┘  └──────┘  └──────┘ │
│                                 │
│  ┌──────┐  ┌──────┐  ┌──────┐ │
│  │ 📖  │  │ 📖  │  │ 📖  │ │
│  │書名4 │  │書名5 │  │書名6 │ │
│  └──────┘  └──────┘  └──────┘ │
└─────────────────────────────────┘
```

**驗收標準**:
- [ ] GridView 正確顯示書籍
- [ ] 封面圖片正確加載（或顯示佔位圖）
- [ ] 下拉刷新功能正常
- [ ] 網絡失敗時使用緩存
- [ ] 空狀態、錯誤狀態正確顯示
- [ ] 測試通過（Unit + Widget + Golden）

**技術要點**:
- 使用 `Dio` 下載 JSON
- 使用 `Hive` 緩存書籍數據
- 使用 `cached_network_image` 緩存封面
- 使用 `Shimmer` 顯示加載動畫
- 使用 GetX 進行狀態管理

---

#### Spec 03: 書籍詳情頁（Book Detail）⬜

**時間**: 2-3 天  
**優先級**: P0  
**依賴**: Spec 02  
**文件**: `03-book-detail.md` (待生成)

**目標**:
- 顯示書籍完整信息（封面、書名、作者、描述）
- 顯示下載狀態按鈕
  - 未下載：「下載」按鈕
  - 下載中：進度條 + 「暫停」按鈕
  - 已下載：「打開閱讀」按鈕
- 顯示文件大小和語言

**UI 預覽**:
```
┌─────────────────────────────────┐
│  ← 書籍詳情                      │
├─────────────────────────────────┤
│        ┌──────────┐             │
│        │  封面圖  │             │
│        └──────────┘             │
│                                 │
│     📚 一夢漫言                  │
│     ✍️ 千華寺繼任主持 見月老人    │
│     🌐 繁體中文                  │
│     💾 2.5 MB                   │
│                                 │
│  ┌─────────────────────────┐   │
│  │  📥 下載  (未下載)        │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

**驗收標準**:
- [ ] 書籍信息完整顯示
- [ ] 下載按鈕狀態正確切換
- [ ] 下載進度實時更新
- [ ] 點擊「打開閱讀」正確跳轉
- [ ] 測試通過（Unit + Widget + Integration）

**技術要點**:
- 使用 `Hero` 動畫實現封面過渡
- 使用 `Dio.download()` 實現文件下載
- 使用 `onReceiveProgress` 監聽下載進度
- 下載完成後更新 Hive 數據

---

#### Spec 04: EPUB 閱讀器（Reader View）⬜

**時間**: 8-10 天（採用 Readium Kotlin 混合方案）  
**優先級**: P0  
**依賴**: Spec 03  
**文件**: `04-reader-readium-integration.md`

**目標**:
- **✨ 採用 Readium Kotlin Toolkit 3.1.2 作為閱讀核心**
- **✨ 使用 Platform Channel 連接 Flutter 與 Readium**
- 打開並渲染 EPUB 文件
- **⭐ 支持直書/橫書閱讀模式切換**
- **⭐ 預設使用直書模式（經典書籍傳統閱讀方式）**
- 直書模式：文字從上到下、從右到左排列，**從右向左滑動翻到下一頁**（傳統書籍翻頁方式）
- 橫書模式：文字從左到右、從上到下排列，**從左向右滑動翻到下一頁**（現代書籍翻頁方式）
- 顯示閱讀進度
- 基本的字體調整
- 亮度調整
- **⭐ 記住用戶偏好的閱讀方向**
- **⭐ 基礎書籤功能（添加/移除當前頁書籤）**

**UI 預覽**:

**架構設計** - Platform Channel 混合方案:
```
┌─────────────────────────────────────────┐
│          Flutter UI Layer               │
│  ┌───────────────────────────────┐     │
│  │  ReaderPage Widget            │     │
│  │  - 閱讀器控制 UI              │     │
│  │  - 設置面板                   │     │
│  │  - 進度條                     │     │
│  └───────────────────────────────┘     │
│              ↕ MethodChannel            │
├─────────────────────────────────────────┤
│       Android Native Layer              │
│  ┌───────────────────────────────┐     │
│  │  Readium Kotlin Toolkit       │     │
│  │  - readium-shared (數據模型)  │     │
│  │  - readium-streamer (解析)    │     │
│  │  - readium-navigator (渲染)   │     │
│  └───────────────────────────────┘     │
└─────────────────────────────────────────┘
```

**直書模式（預設）** - 傳統經典書籍閱讀方式:
```
┌─────────────────────────────────┐
│  ← 一夢漫言    ⚔️ 📖   ⚙️  🔖   │
├─────────────────────────────────┤
│  序  │  遊  │  於  │  余         │
│  章  │  居  │  庚  │             │
│  一  │  金  │  午  │             │
│  第  │  陵  │  歲  │             │
│     │  ...  │  ,   │             │
│     │      │      │             │
│  ━━━━━━━━━━━━━━━━━━━ 15%        │
│      第 5 頁 / 共 30 頁  📑      │
│      ⬅️ 向左滑 = 下一頁          │
└─────────────────────────────────┘
```
**註**: 
- 📑 = 已添加書籤（點擊可移除）
- 翻頁：**從右向左滑動** = 下一頁（模擬傳統紙書從右翻到左）

**橫書模式（可切換）** - 現代書籍閱讀方式:
```
┌─────────────────────────────────┐
│  ← 一夢漫言    📖 ⚔️   ⚙️  🔖   │
├─────────────────────────────────┤
│  第一章 序                       │
│                                 │
│  余於庚午歲，遊居金陵...          │
│  ...                            │
│                                 │
│  ━━━━━━━━━━━━━━━━━━━ 15%        │
│      第 5 頁 / 共 30 頁  📑      │
│      ➡️ 向右滑 = 下一頁          │
└─────────────────────────────────┘
```
**註**: 
- 📑 = 已添加書籤（點擊可移除）
- 翻頁：**從左向右滑動** = 下一頁（現代閱讀習慣）

**驗收標準**:
- [ ] **⭐ Readium Kotlin Toolkit 集成成功**
- [ ] **⭐ Platform Channel 通訊正常（Flutter ↔ Kotlin）**
- [ ] EPUB 文件正確渲染（專業級品質）
- [ ] **⭐ 預設使用直書模式開啟書籍**
- [ ] **⭐ 直書模式：從右向左滑動翻到下一頁（傳統閱讀習慣）**
- [ ] **⭐ 橫書模式：從左向右滑動翻到下一頁（現代閱讀習慣）**
- [ ] **⭐ 閱讀方向切換按鈕正常工作**
- [ ] 進度條實時更新
- [ ] 字體大小可調整
- [ ] 亮度可調整
- [ ] **⭐ 閱讀方向偏好正確保存和恢復**
- [ ] **⭐ 書籤按鈕顯示當前頁書籤狀態（已添加/未添加）**
- [ ] **⭐ 點擊書籤按鈕可添加/移除書籤**
- [ ] **⭐ 書籤數據正確保存到 Hive**
- [ ] **⭐ 重新打開書籍時書籤狀態正確恢復**
- [ ] 測試通過（Widget + Integration）

**技術要點**:
- **✨ 使用 Readium Kotlin Toolkit 3.1.2**
  - `readium-shared`: 核心數據模型
  - `readium-streamer`: EPUB 解析和內容提取
  - `readium-navigator`: 閱讀器渲染核心
- **✨ 使用 Platform Channel（MethodChannel）實現 Flutter ↔ Kotlin 通訊**
  - Flutter 側：`EpubReaderChannel` 類
  - Kotlin 側：`ReadiumBridge` 類
  - 方法：`openEpub`, `setDirection`, `setFontSize`, `toggleBookmark` 等
- **⭐ Readium 原生支持直書/橫書切換（`ReadingProgression`）**
- **⭐ 直書模式：`ReadingProgression.RTL`（從右向左）**
- **⭐ 橫書模式：`ReadingProgression.LTR`（從左向右）**
- 使用 `SharedPreferences` 保存閱讀方向偏好
- **⭐ 使用 Hive 保存書籤數據（`List<Locator>` 存儲書籤位置）**
- **⭐ 實現書籤按鈕 UI 狀態切換（未添加 🔖 / 已添加 📑）**
- 處理 EPUB 解析錯誤

**核心數據模型**:
```dart
// Flutter 側
enum ReadingDirection {
  vertical,    // 直書（預設）- 從右向左滑動翻頁
  horizontal,  // 橫書 - 從左向右滑動翻頁
}

class EpubReaderChannel {
  static const platform = MethodChannel('com.shuyuan.reader/epub');
  
  Future<void> openEpub(String filePath) async {
    await platform.invokeMethod('openEpub', {'path': filePath});
  }
  
  Future<void> setReadingDirection(ReadingDirection direction) async {
    await platform.invokeMethod('setDirection', {
      'direction': direction == ReadingDirection.vertical ? 'rtl' : 'ltr'
    });
  }
  
  Future<void> toggleBookmark() async {
    await platform.invokeMethod('toggleBookmark');
  }
}

// 基礎書籤功能
class BookProgress {
  final String bookId;
  final int currentPage;
  final List<String> bookmarkedLocators;  // Readium Locator JSON 列表
  // ...
  
  bool isBookmarked(String locator) => bookmarkedLocators.contains(locator);
  
  void toggleBookmark(String locator) {
    if (isBookmarked(locator)) {
      bookmarkedLocators.remove(locator);
    } else {
      bookmarkedLocators.add(locator);
    }
  }
}
```

```kotlin
// Kotlin 側
class ReadiumBridge(private val activity: MainActivity) : MethodCallHandler {
    private var publication: Publication? = null
    private var navigator: EpubNavigatorFragment? = null
    
    override fun onMethodCall(call: MethodCall, result: Result) {
        when (call.method) {
            "openEpub" -> {
                val path = call.argument<String>("path")
                openEpub(path, result)
            }
            "setDirection" -> {
                val direction = call.argument<String>("direction")
                setReadingDirection(direction, result)
            }
            "toggleBookmark" -> {
                toggleBookmark(result)
            }
        }
    }
    
    private fun setReadingDirection(direction: String, result: Result) {
        val progression = when (direction) {
            "rtl" -> ReadingProgression.RTL  // 直書
            "ltr" -> ReadingProgression.LTR  // 橫書
            else -> ReadingProgression.LTR
        }
        navigator?.readingProgression = progression
        result.success(true)
    }
}
```

**書籤功能範圍**:
- ✅ 添加/移除當前頁書籤
- ✅ 顯示當前頁書籤狀態
- ✅ 保存書籤到 Hive（使用 Readium Locator）
- ✅ 恢復書籤狀態
- ❌ 書籤列表頁面（延後到 Spec 08）
- ❌ 書籤搜索（延後到 Spec 08）
- ❌ 書籤分類（延後到 Spec 08）
- ❌ 從書籤列表跳轉（延後到 Spec 08）

**Readium Kotlin 方案優勢**:
- ✅ **專業級 EPUB 渲染品質**（100+ 應用使用）
- ✅ **原生直書/橫書支持**（`ReadingProgression.RTL/LTR`）
- ✅ **成熟穩定**（Readium 基金會長期維護）
- ✅ **完整 EPUB3 支持**（Reflow, Fixed Layout, Media Overlays）
- ✅ **精確分頁**（基於 WebView 渲染）
- ✅ **書籤位置精確**（使用 Locator 而非頁碼）
- ✅ **高性能**（優化的資源加載和緩存）

**開發計劃**（詳見 `04-reader-readium-integration.md`）:
- **Phase 4.1**: 環境準備（1 週）
  - 添加 Readium Kotlin 依賴
  - 學習 Readium API
  - 搭建 Platform Channel
- **Phase 4.2**: 基礎閱讀器（2 週）
  - 實現 EPUB 打開和渲染
  - 實現分頁和翻頁
  - 實現進度追蹤
- **Phase 4.3**: 直書/橫書切換（1 週）
  - 實現閱讀方向切換
  - 保存用戶偏好
  - UI 優化
- **Phase 4.4**: 書籤功能（1 週）
  - 實現書籤添加/移除
  - 保存書籤到 Hive
  - 書籤狀態顯示
- **Phase 4.5**: 優化與測試（1 週）
  - 性能優化
  - 錯誤處理
  - 完整測試

---

#### Spec 05: 離線模式與錯誤處理 ⬜

**時間**: 2-3 天  
**優先級**: P0  
**依賴**: Spec 02, 03, 04  
**文件**: `05-offline-error-handling.md` (待生成)

**目標**:
- 實現 books.json 緩存
- 檢測網絡狀態
- 離線時從緩存加載
- 全局錯誤處理
- 用戶友好的錯誤提示

**驗收標準**:
- [ ] 飛行模式下能查看已緩存的書籍列表
- [ ] 網絡錯誤時顯示友好提示
- [ ] 支持重試機制
- [ ] 無網絡時下載按鈕顯示為灰色
- [ ] 測試通過（Unit + Integration）

**技術要點**:
- 使用 `connectivity_plus` 監聽網絡狀態
- 使用 `SharedPreferences` 緩存 JSON
- 實現全局錯誤處理器
- 使用 SnackBar 顯示錯誤

---

### Phase 2: 功能增強 (Week 7-12)

#### Spec 06: 搜索與過濾 ⬜

**時間**: 2-3 天  
**優先級**: P1  
**依賴**: Spec 02  
**文件**: `06-search-filter.md` (待生成)

**目標**:
- 搜索書名和作者
- 過濾已下載/未下載
- 過濾語言
- 排序（書名、作者、下載時間）

**UI 預覽**:
```
┌─────────────────────────────────┐
│  🔍 [搜索書名或作者...]    🎛️   │
├─────────────────────────────────┤
│  找到 15 個結果                  │
│                                 │
│  ┌──────┐  ┌──────┐            │
│  │金剛經│  │心經  │            │
│  └──────┘  └──────┘            │
└─────────────────────────────────┘
```

**驗收標準**:
- [ ] 實時搜索結果
- [ ] 過濾即時生效
- [ ] 搜索無結果提示
- [ ] 清除搜索按鈕
- [ ] 測試通過

---

#### Spec 07: 下載管理器 ⬜

**時間**: 3-4 天  
**優先級**: P1  
**依賴**: Spec 03  
**文件**: `07-download-manager.md` (待生成)

**目標**:
- 支持多任務下載（最多 3 個並發）
- 顯示下載隊列
- 支持暫停/恢復/取消
- 顯示下載速度和剩餘時間
- 下載完成通知

**UI 預覽**:
```
┌─────────────────────────────────┐
│  下載管理        清空已完成      │
├─────────────────────────────────┤
│  📥 正在下載 (2)                 │
│  ┌─────────────────────────┐   │
│  │ 📖 金剛經               │   │
│  │ ━━━━━━━━━━━━━━━ 65%    │   │
│  │ 1.2MB/2.5MB  500KB/s   │   │
│  │        ⏸️ 暫停  ❌ 取消  │   │
│  └─────────────────────────┘   │
└─────────────────────────────────┘
```

**驗收標準**:
- [ ] 下載隊列實時更新
- [ ] 進度條平滑動畫
- [ ] 下載速度實時顯示
- [ ] 暫停/恢復功能正常
- [ ] 完成通知彈出
- [ ] 測試通過

---

#### Spec 08: 閱讀進度與書籤管理 ⬜

**時間**: 3-4 天  
**優先級**: P1  
**依賴**: Spec 04  
**文件**: `08-progress-bookmarks.md` (待生成)

**目標**:
- 自動保存閱讀位置
- 打開書籍時恢復位置
- **書籤列表頁面（Spec 04 提供基礎添加/移除功能）**
- **書籤搜索與過濾**
- **書籤分類（可選）**
- 跳轉到書籤位置

**驗收標準**:
- [ ] 閱讀位置自動保存
- [ ] 重新打開書籍恢復到上次位置
- [ ] 書籤列表正確顯示所有書籤
- [ ] 從列表可跳轉到對應書籤位置
- [ ] 書籤搜索功能正常
- [ ] 測試通過

**註**: Spec 04 已實現基礎書籤添加/移除功能，本 Spec 專注於書籤管理和進階功能

---

#### Spec 09: 閱讀設置與主題 ⬜

**時間**: 2-3 天  
**優先級**: P1  
**依賴**: Spec 04  
**文件**: `09-settings-themes.md` (待生成)

**目標**:
- 字體大小、類型、行距調整
- 主題切換（日間/夜間/護眼/復古）
- 設置持久化

**UI 預覽**:
```
┌─────────────────────────────────┐
│  ☀️ 日間     🌙 夜間            │
│  🌱 護眼     📜 復古            │
└─────────────────────────────────┘
```

**驗收標準**:
- [ ] 主題實時切換
- [ ] 字體大小實時預覽
- [ ] 設置正確保存和加載
- [ ] 測試通過

---

#### Spec 10: 本地書庫管理 ⬜

**時間**: 2-3 天  
**優先級**: P1  
**依賴**: Spec 03  
**文件**: `10-local-library.md` (待生成)

**目標**:
- "已下載" Tab
- 顯示下載時間、文件大小
- 刪除書籍功能
- 存儲空間統計

**驗收標準**:
- [ ] 已下載列表正確顯示
- [ ] 刪除功能正常
- [ ] 存儲空間計算正確
- [ ] 測試通過

---

#### Spec 11: 目錄導航 ⬜

**時間**: 2 天  
**優先級**: P2  
**依賴**: Spec 04  
**文件**: `11-toc-navigation.md` (待生成)

**目標**:
- 顯示章節目錄
- 跳轉到指定章節
- 顯示當前章節進度

**驗收標準**:
- [ ] 目錄正確顯示
- [ ] 跳轉功能正常
- [ ] 當前章節高亮
- [ ] 測試通過

---

#### Spec 12: 高亮與筆記 ⬜

**時間**: 3-4 天  
**優先級**: P2  
**依賴**: Spec 04  
**文件**: `12-highlight-notes.md` (待生成)

**目標**:
- 選中文字顯示菜單
- 添加高亮（多種顏色）
- 添加筆記
- 高亮/筆記列表

**驗收標準**:
- [ ] 文字選擇功能正常
- [ ] 高亮正確顯示
- [ ] 筆記功能正常
- [ ] 列表正確顯示
- [ ] 測試通過

---

### Phase 3: 發布準備 (Week 13-16)

#### Spec 13: 性能優化 ⬜

**時間**: 1 週  
**優先級**: P1  
**依賴**: 所有前置 Spec  
**文件**: `13-performance-optimization.md` (待生成)

**目標**:
- 圖片優化（緩存、懶加載）
- 列表優化（分頁）
- 內存監控
- 動畫優化（60fps）

**驗收標準**:
- [ ] 啟動時間 < 3 秒
- [ ] 頁面切換 < 300ms
- [ ] 動畫 60fps
- [ ] 無內存洩漏
- [ ] 測試通過

---

#### Spec 14: 多語言支持 ⬜

**時間**: 2-3 天  
**優先級**: P2  
**依賴**: 所有前置 Spec  
**文件**: `14-i18n.md` (待生成)

**目標**:
- 繁體中文（默認）
- 簡體中文
- 英文

**驗收標準**:
- [ ] 所有文字可翻譯
- [ ] 語言切換正常
- [ ] 測試通過

---

#### Spec 15: 設置與關於頁面 ⬜

**時間**: 2 天  
**優先級**: P1  
**依賴**: 所有前置 Spec  
**文件**: `15-settings-about.md` (待生成)

**目標**:
- 關於頁面（版本號、開發者）
- 隱私政策頁面
- 免責聲明
- 清除緩存
- 存儲空間顯示

**驗收標準**:
- [ ] 所有頁面正確顯示
- [ ] 清除緩存功能正常
- [ ] 存儲空間計算正確
- [ ] 測試通過

---

#### Spec 16: 完整測試與修復 ⬜

**時間**: 1 週  
**優先級**: P0  
**依賴**: 所有前置 Spec  
**文件**: `16-full-testing.md` (待生成)

**目標**:
- 不同設備測試
- 不同 Android 版本測試
- 網絡異常測試
- Bug 修復

**驗收標準**:
- [ ] 至少 5 台設備測試通過
- [ ] API 21-34 測試通過
- [ ] 所有已知 Bug 修復
- [ ] 測試覆蓋率 > 80%

---

#### Spec 17: 應用打包與發布 ⬜

**時間**: 3-4 天  
**優先級**: P0  
**依賴**: Spec 16  
**文件**: `17-release.md` (待生成)

**目標**:
- 設計應用圖標
- 準備商店截圖
- 生成簽名密鑰
- 編譯 Release 版本
- 上傳到 Google Play

**驗收標準**:
- [ ] 應用圖標符合規範
- [ ] 截圖符合規範
- [ ] Release APK/AAB 生成成功
- [ ] Google Play 資料完整
- [ ] 內部測試通過
- [ ] 正式發布

---

## 📊 開發進度儀表板

| Spec | 功能 | 時間 | 優先級 | 狀態 | 測試 | Golden | 截圖 | 完成日期 |
|------|------|------|--------|------|------|--------|------|----------|
| 00 | 專案設置 | 1d | P0 | ✅ | - | - | ✅ | 2025-11-07 |
| 01 | 啟動畫面 | 1d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 02 | 書籍列表 | 3-4d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 03 | 書籍詳情 | 2-3d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 04 | 閱讀器 (Readium Kotlin 混合方案) | 8-10d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 05 | 離線模式 | 2-3d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 06 | 搜索過濾 | 2-3d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 07 | 下載管理 | 3-4d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 08 | 進度書籤 | 3-4d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 09 | 設置主題 | 2-3d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 10 | 本地書庫 | 2-3d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 11 | 目錄導航 | 2d | P2 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 12 | 高亮筆記 | 3-4d | P2 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 13 | 性能優化 | 5d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 14 | 多語言 | 2-3d | P2 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 15 | 設置頁面 | 2d | P1 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 16 | 完整測試 | 5d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |
| 17 | 打包發布 | 3-4d | P0 | ⬜ | ⬜ | ⬜ | ⬜ | - |

**圖例**:
- ✅ 已完成
- 🔄 進行中
- ⬜ 未開始
- ❌ 已取消

**統計**:
- 總 Spec 數: 18 個
- 已完成: 1 個 (5.6%)
- 進行中: 0 個
- 未開始: 17 個 (94.4%)

---

## 🎯 關鍵里程碑

### M1: Foundation (Week 2)

**目標**: 專案搭建完成

**包含 Spec**:
- ✅ Spec 00: 專案設置
- ⬜ Spec 01: 啟動畫面

**驗收標準**:
- [ ] Flutter 專案創建成功
- [ ] 依賴安裝完成
- [ ] 專案結構符合 Clean Architecture
- [ ] 空白 APP 能在真機運行
- [ ] CI/CD 配置完成

**預計完成**: 2025-11-10

---

### M2: MVP (Week 6)

**目標**: 最小可用產品

**包含 Spec**:
- ⬜ Spec 02: 書籍列表
- ⬜ Spec 03: 書籍詳情
- ⬜ Spec 04: 閱讀器
- ⬜ Spec 05: 離線模式

**驗收標準**:
- [ ] 用戶能瀏覽書籍列表
- [ ] 用戶能下載並閱讀 EPUB
- [ ] 離線模式正常工作
- [ ] 無嚴重 Bug
- [ ] 至少 3 台設備測試通過

**預計完成**: 2025-12-20

---

### M3: Beta (Week 12)

**目標**: Beta 版本

**包含 Spec**:
- ⬜ Spec 06-12: 所有增強功能

**驗收標準**:
- [ ] 所有 P0 和 P1 功能完成
- [ ] 測試覆蓋率 > 80%
- [ ] 性能達標
- [ ] 可供內部測試

**預計完成**: 2026-01-31

---

### M4: Release (Week 16)

**目標**: 正式發布

**包含 Spec**:
- ⬜ Spec 13-17: 優化和發布

**驗收標準**:
- [ ] 所有功能完成
- [ ] 內部測試通過（1 週）
- [ ] Google Play 商店資料完整
- [ ] 隱私政策和免責聲明完成
- [ ] 正式上架

**預計完成**: 2026-02-28

---

## 📈 時間估算

### Phase 1: MVP 開發

| Week | Spec | 預計工時 | 累計工時 |
|------|------|----------|----------|
| 1 | Spec 00-01 | 16h | 16h |
| 2-3 | Spec 02 | 28h | 44h |
| 3-4 | Spec 03 | 20h | 64h |
| 4-5 | Spec 04 (Readium Kotlin 混合方案) | 60h | 108h |
| 6 | Spec 05 | 20h | 128h |

**總計**: 144 小時 (約 6 週 @ 24h/週)

### Phase 2: 功能增強

| Week | Spec | 預計工時 | 累計工時 |
|------|------|----------|----------|
| 7 | Spec 06 | 20h | 132h |
| 7-8 | Spec 07 | 28h | 160h |
| 9 | Spec 08 | 28h | 188h |
| 10 | Spec 09 | 20h | 208h |
| 10-11 | Spec 10 | 20h | 228h |
| 11 | Spec 11 | 16h | 244h |
| 12 | Spec 12 | 28h | 272h |

**總計**: 160 小時 (約 6 週 @ 25h/週)

### Phase 3: 發布準備

| Week | Spec | 預計工時 | 累計工時 |
|------|------|----------|----------|
| 13 | Spec 13 | 40h | 312h |
| 14 | Spec 14 | 20h | 340h |
| 14 | Spec 15 | 16h | 356h |
| 15 | Spec 16 | 40h | 396h |
| 16 | Spec 17 | 28h | 424h |

**總計**: 144 小時 (約 4 週 @ 35h/週)

### 整體統計

- **總工時**: 448 小時
- **總週數**: 16 週
- **平均週工時**: 28 小時
- **建議週工時**: 20-30 小時（兼職）

---

## 🔄 依賴關係圖

```
Spec 00 (專案設置) ✅
  └─→ Spec 01 (啟動畫面)
       └─→ Spec 02 (書籍列表)
            ├─→ Spec 03 (書籍詳情)
            │    ├─→ Spec 04 (閱讀器)
            │    │    ├─→ Spec 05 (離線模式)
            │    │    │    └─→ [Phase 1 完成] ✓
            │    │    ├─→ Spec 08 (進度書籤)
            │    │    ├─→ Spec 09 (設置主題)
            │    │    ├─→ Spec 11 (目錄導航)
            │    │    └─→ Spec 12 (高亮筆記)
            │    └─→ Spec 07 (下載管理)
            │         └─→ Spec 10 (本地書庫)
            └─→ Spec 06 (搜索過濾)

所有 Phase 1-2 完成
  └─→ Spec 13 (性能優化)
       ├─→ Spec 14 (多語言)
       ├─→ Spec 15 (設置頁面)
       └─→ Spec 16 (完整測試)
            └─→ Spec 17 (打包發布)
                 └─→ [專案完成] 🎉
```

---

## ⚠️ 風險評估與應對

### 技術風險

#### 🔴 高風險

**風險 1: EPUB 解析複雜度（已降低）**
- **描述**: ~~EPUB 格式複雜，可能遇到解析失敗~~；**使用 Readium Kotlin 專業方案**
- **影響**: ~~閱讀器無法正常工作~~；**Readium 已支持 100+ 應用，成熟穩定**
- **概率**: 低（原：中）
- **應對**:
  - ✅ **使用業界標準 Readium Kotlin Toolkit**
  - ✅ **原生支持直書/橫書（`ReadingProgression`）**
  - ✅ **完整 EPUB3 支持，包括固定版面和媒體疊加**
  - ✅ **基於 Locator 的精確書籤定位**
  - 對常見 EPUB 進行充分測試（**特別測試繁體中文經典書籍**）
  - 準備降級方案（顯示錯誤提示）

**風險 2: 網絡下載不穩定**
- **描述**: GitHub 下載速度慢或失敗
- **影響**: 用戶體驗差
- **概率**: 高
- **應對**:
  - 實現重試機制（最多 3 次）
  - 增加超時時間
  - 考慮使用 CDN（如 jsDelivr）
  - 實現斷點續傳（Phase 2）

#### 🟠 中風險

**風險 3: 內存溢出**
- **描述**: 大型 EPUB 文件或圖片導致 OOM
- **影響**: APP 崩潰
- **概率**: 中
- **應對**:
  - 圖片使用 `memCacheWidth/Height` 限制
  - EPUB 使用流式解析
  - 添加內存監控

**風險 4: 設備兼容性**
- **描述**: 不同 Android 版本/設備表現不一致
- **影響**: 部分用戶無法使用
- **概率**: 中
- **應對**:
  - 支持 API 21+ (覆蓋 95%+ 設備)
  - 在多台設備測試
  - 使用 Firebase Crashlytics 監控崩潰

#### 🟢 低風險

**風險 5: Hive 數據遷移**
- **描述**: 未來版本升級時數據結構變化
- **影響**: 用戶數據丟失
- **概率**: 低
- **應對**:
  - 使用 Hive 的 Migration 機制
  - 預留版本號字段
  - 定期備份

### 資源風險

#### 🟠 中風險

**風險 6: 開發時間不足**
- **描述**: 實際開發時間超出估算
- **影響**: 延遲發布
- **概率**: 中
- **應對**:
  - 嚴格按照 Spec 開發，避免功能蔓延
  - 優先完成 P0 和 P1 功能
  - P2 功能可延後到下個版本
  - 預留 20% 緩衝時間

**風險 7: 測試資源不足**
- **描述**: 沒有足夠設備進行測試
- **影響**: Bug 無法及時發現
- **概率**: 低
- **應對**:
  - 使用 Android Studio 模擬器
  - 使用 Firebase Test Lab
  - 招募內部測試者

### 外部風險

#### 🟢 低風險

**風險 8: Google Play 審核不通過**
- **描述**: APP 不符合 Google Play 政策
- **影響**: 無法上架
- **概率**: 低
- **應對**:
  - 仔細閱讀 Google Play 政策
  - 確保隱私政策完整
  - 先進行內部測試軌道

**風險 9: GitHub 倉庫不可用**
- **描述**: GitHub 服務中斷或倉庫刪除
- **影響**: 無法下載書籍
- **概率**: 極低
- **應對**:
  - 使用 GitHub CDN
  - 準備鏡像倉庫
  - 離線模式降級

---

## 📚 資源需求

### 人力資源

| 角色 | 人數 | 技能要求 | 投入時間 |
|------|------|----------|----------|
| Flutter 開發 | 1 | Flutter, Dart, GetX | 全職 (16 週) |
| UI/UX 設計師 | 1 | 移動端設計 | 兼職 (2 週) |
| 測試工程師 | 1 | 移動端測試 | 兼職 (2 週) |

### 設備資源

| 設備 | 數量 | 用途 |
|------|------|------|
| Android 手機 (低端) | 1 | 性能測試 |
| Android 手機 (中端) | 1 | 日常開發測試 |
| Android 手機 (高端) | 1 | 兼容性測試 |
| Android 平板 | 1 | 平板適配（可選）|

### 軟件資源

| 軟件 | 費用 | 用途 |
|------|------|------|
| Android Studio | 免費 | 開發環境 |
| VS Code | 免費 | 代碼編輯 |
| Figma | 免費 | UI 設計 |
| Google Play Developer | $25 | 發布 APP |
| Firebase (Spark Plan) | 免費 | 崩潰監控（可選）|

**總費用**: ~$25 USD

---

## 🎓 學習與培訓

### 必需技能

#### Flutter 基礎
- [ ] Dart 語言基礎
- [ ] Flutter Widget 系統
- [ ] 狀態管理（GetX）
- [ ] 路由導航

**學習資源**:
- [Flutter 官方文檔](https://flutter.dev/docs)
- [Dart 語言指南](https://dart.dev/guides)

#### 本地存儲
- [ ] Hive 數據庫
- [ ] SharedPreferences
- [ ] 文件系統操作

**學習資源**:
- [Hive 官方文檔](https://docs.hivedb.dev/)

#### 網絡請求
- [ ] Dio 使用
- [ ] RESTful API
- [ ] 錯誤處理

**學習資源**:
- [Dio 官方文檔](https://pub.dev/packages/dio)

### 進階技能

#### 性能優化
- [ ] 內存管理
- [ ] 圖片優化
- [ ] 動畫優化

#### 測試
- [ ] 單元測試
- [ ] Widget 測試
- [ ] 集成測試

**學習資源**:
- [Flutter 測試文檔](https://flutter.dev/docs/testing)

---

## 📞 溝通計劃

### 每日站會（可選）

**時間**: 每天上午 10:00  
**時長**: 15 分鐘  
**內容**:
- 昨天完成了什麼
- 今天計劃做什麼
- 遇到什麼阻礙

### 每週回顧

**時間**: 每週五下午  
**時長**: 1 小時  
**內容**:
- 本週進度回顧
- 下週計劃
- 問題討論
- 經驗分享

### 里程碑評審

**時間**: 每個里程碑完成後  
**時長**: 2 小時  
**內容**:
- Demo 展示
- 驗收標準檢查
- 問題總結
- 計劃調整

---

## 🔧 工具鏈

### 開發工具
- **IDE**: Android Studio / VS Code
- **版本控制**: Git / GitHub
- **CI/CD**: GitHub Actions
- **包管理**: pub.dev

### 測試工具
- **單元測試**: flutter test
- **集成測試**: integration_test
- **UI 測試**: Golden Tests
- **設備測試**: Firebase Test Lab（可選）

### 監控工具
- **崩潰監控**: Firebase Crashlytics（可選）
- **分析工具**: Firebase Analytics（可選）
- **性能監控**: Flutter DevTools

### 文檔工具
- **API 文檔**: Dart Doc
- **規格文檔**: Markdown
- **設計稿**: Figma

---

## 🎉 成功標準

### MVP 成功標準 (M2)

- ✅ 功能完整性: 所有 P0 功能完成
- ✅ 穩定性: 無嚴重 Bug
- ✅ 性能: 啟動 < 3s，動畫 60fps
- ✅ 測試: 至少 3 台設備測試通過
- ✅ 用戶反饋: 至少 5 位用戶試用並給出正面反饋

### Beta 成功標準 (M3)

- ✅ 功能豐富性: 所有 P0 和 P1 功能完成
- ✅ 測試覆蓋率: > 80%
- ✅ 性能達標: 無內存洩漏，流暢運行
- ✅ 用戶體驗: 界面美觀，交互友好
- ✅ 內部測試: 至少 10 位用戶測試 1 週

### Release 成功標準 (M4)

- ✅ 功能完善: 所有計劃功能完成
- ✅ 質量保證: 無已知嚴重 Bug
- ✅ 合規性: 符合 Google Play 政策
- ✅ 文檔完整: 隱私政策、免責聲明、用戶指南
- ✅ 上架成功: Google Play 審核通過並發布

---

## 📝 下一步行動

### 立即執行

1. ✅ **已完成**: 專案憲章 (`/speckit.constitution`)
2. ✅ **已完成**: 開發計劃 (`/speckit.plan`)
3. ⬜ **下一步**: 執行 `/speckit.specify 01 splash-screen`
4. ⬜ **然後**: 開始實現 Spec 01

### 本週目標

- [ ] 完成 Spec 01 規格文檔
- [ ] 開始實現 Spec 01
- [ ] 設置開發環境
- [ ] 創建 Flutter 專案

### 本月目標

- [ ] 完成 M1: Foundation
- [ ] 完成 Spec 01-02
- [ ] 建立 CI/CD 流程

---

## 📌 附錄

### A. 專案文件清單

```
app/
├── specs/
│   ├── 00-constitution.md         ✅ 已完成
│   ├── development-plan.md        ✅ 已完成
│   ├── 01-splash-screen.md        ⬜ 待生成
│   ├── 02-book-list.md            ⬜ 待生成
│   ├── ...                        ⬜ 待生成
│   └── tasks/
│       ├── spec-01-tasks.md       ⬜ 待生成
│       └── ...
│
├── design/
│   ├── mockups/
│   ├── wireframes/
│   └── screenshots/
│
└── lib/
    ├── core/
    ├── data/
    ├── domain/
    └── presentation/
```

### B. 參考資源

- [Spec-Kit 官方文檔](https://github.com/github/spec-kit)
- [Flutter 官方文檔](https://flutter.dev/docs)
- [Dart 語言指南](https://dart.dev/guides)
- [Material Design 3](https://m3.material.io/)
- [Google Play 發布指南](https://support.google.com/googleplay/android-developer/answer/9859152)

### C. 聯繫方式

- **專案倉庫**: https://github.com/kkwenFreemind/ShuyuanReader
- **問題反饋**: GitHub Issues
- **開發者**: [待填寫]

---

**計劃版本**: 1.0  
**創建日期**: 2025-11-07  
**最後更新**: 2025-11-07  
**狀態**: 📋 已發布，待執行

---

**記住**: 這是一個活文檔，會隨著專案進展不斷更新。保持靈活，及時調整，但始終遵循 Spec-Kit 的核心原則！🚀
